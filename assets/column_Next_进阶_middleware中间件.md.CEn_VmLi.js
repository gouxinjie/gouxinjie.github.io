import{_ as n,C as e,c as l,o as t,j as i,G as p,aQ as h,a as k}from"./chunks/framework.DEi4YP2n.js";const r="/assets/middleware-1.D1kwLYqE.png",d="/assets/middleware-2.yV9n3yl5.png",m=JSON.parse('{"title":"middleware ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼","description":"","frontmatter":{},"headers":[],"relativePath":"column/Next/è¿›é˜¶/middlewareä¸­é—´ä»¶.md","filePath":"column/Next/è¿›é˜¶/middlewareä¸­é—´ä»¶.md","lastUpdated":1766561977000}'),E={name:"column/Next/è¿›é˜¶/middlewareä¸­é—´ä»¶.md"};function g(o,s,c,y,u,F){const a=e("ArticleMetadata");return t(),l("div",null,[s[0]||(s[0]=i("h1",{id:"middleware-ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼",tabindex:"-1"},[k("middleware ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼ "),i("a",{class:"header-anchor",href:"#middleware-ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼","aria-label":'Permalink to "middleware ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼"'},"â€‹")],-1)),p(a),s[1]||(s[1]=h(`<nav class="table-of-contents"><ul><li><a href="#_1-ä»€ä¹ˆæ˜¯-middleware">1. ä»€ä¹ˆæ˜¯ Middlewareï¼Ÿ</a></li><li><a href="#_2-middleware-çš„æ–‡ä»¶ä½ç½®">2. Middleware çš„æ–‡ä»¶ä½ç½®</a></li><li><a href="#_3-å¸¸è§åœºæ™¯">3. å¸¸è§åœºæ™¯</a><ul><li><a href="#_1-æƒé™æ§åˆ¶-é‰´æƒ">(1) æƒé™æ§åˆ¶ / é‰´æƒ</a></li><li><a href="#_2-å›½é™…åŒ–-è·¯ç”±é‡å†™">(2) å›½é™…åŒ– / è·¯ç”±é‡å†™</a></li><li><a href="#_3-a-b-æµ‹è¯•">(3) A/B æµ‹è¯•</a></li><li><a href="#_4-é˜²ç›—é“¾-è®¿é—®æ§åˆ¶">(4) é˜²ç›—é“¾ / è®¿é—®æ§åˆ¶</a></li></ul></li><li><a href="#_4-middleware-çš„é™åˆ¶">4. Middleware çš„é™åˆ¶</a></li></ul></nav><div class="warning custom-block"><p class="custom-block-title">æ³¨æ„äº‹é¡¹ï¼</p><p>ä» Next.js 16 å¼€å§‹ï¼Œä¸­é—´ä»¶Middlewareæ›´åä¸ºä»£ç†ï¼ˆProxyï¼‰ï¼Œä»¥æ›´å¥½åœ°ä½“ç°å…¶ç”¨é€”ã€‚å…¶åŠŸèƒ½ä¿æŒä¸å˜ã€‚</p></div><h2 id="_1-ä»€ä¹ˆæ˜¯-middleware" tabindex="-1">1. ä»€ä¹ˆæ˜¯ Middlewareï¼Ÿ <a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯-middleware" aria-label="Permalink to &quot;1. ä»€ä¹ˆæ˜¯ Middlewareï¼Ÿ&quot;">â€‹</a></h2><ul><li><strong>Middleware</strong> æ˜¯è¿è¡Œåœ¨ <strong>è¯·æ±‚åˆ°è¾¾è·¯ç”±ä¹‹å‰</strong> çš„ä¸€ä¸ªå‡½æ•°ã€‚</li><li>å®ƒä½äº <strong>ç”¨æˆ·è¯·æ±‚</strong> å’Œ <strong>è·¯ç”±å¤„ç†å™¨</strong> ä¹‹é—´ï¼Œå¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œ <strong>æ‹¦æˆªã€ä¿®æ”¹ã€é‡å®šå‘ã€é‰´æƒ</strong> ç­‰æ“ä½œã€‚</li><li>æœ¬è´¨ä¸Šæ˜¯è¿è¡Œåœ¨ <strong>Edge Runtime</strong>ï¼ˆè½»é‡ã€æ—  Node.js APIï¼Œä»… Web APIï¼‰ã€‚</li></ul><h2 id="_2-middleware-çš„æ–‡ä»¶ä½ç½®" tabindex="-1">2. Middleware çš„æ–‡ä»¶ä½ç½® <a class="header-anchor" href="#_2-middleware-çš„æ–‡ä»¶ä½ç½®" aria-label="Permalink to &quot;2. Middleware çš„æ–‡ä»¶ä½ç½®&quot;">â€‹</a></h2><ul><li>å¿…é¡»æ”¾åœ¨é¡¹ç›®<strong>æ ¹ç›®å½•</strong>çš„ <code>middleware.ts</code> æˆ– <code>middleware.js</code> æ–‡ä»¶ä¸­ã€‚</li><li>ä½œç”¨èŒƒå›´å–å†³äºä½ åœ¨ <code>matcher</code> ä¸­å®šä¹‰çš„è·¯å¾„ã€‚</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>project/</span></span>
<span class="line"><span> â”œâ”€â”€ app/</span></span>
<span class="line"><span> â”œâ”€â”€ middleware.ts   ğŸ‘ˆ å…¨å±€ Middleware</span></span>
<span class="line"><span> â””â”€â”€ package.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_3-å¸¸è§åœºæ™¯" tabindex="-1">3. å¸¸è§åœºæ™¯ <a class="header-anchor" href="#_3-å¸¸è§åœºæ™¯" aria-label="Permalink to &quot;3. å¸¸è§åœºæ™¯&quot;">â€‹</a></h2><h3 id="_1-æƒé™æ§åˆ¶-é‰´æƒ" tabindex="-1">(1) <strong>æƒé™æ§åˆ¶ / é‰´æƒ</strong> <a class="header-anchor" href="#_1-æƒé™æ§åˆ¶-é‰´æƒ" aria-label="Permalink to &quot;(1) **æƒé™æ§åˆ¶ / é‰´æƒ**&quot;">â€‹</a></h3><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { NextResponse } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next/server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { NextRequest } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next/server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> middleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NextRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ‰“å°è¯·æ±‚è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;è¯·æ±‚è·¯å¾„:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, request.nextUrl.pathname);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä¾‹å­ï¼šæœªç™»å½•å°±é‡å®šå‘åˆ° /auth/signin</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isLoggedIn</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.cookies.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;next-auth.session-token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æ˜¯å¦ç™»å½•:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, isLoggedIn);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isLoggedIn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.nextUrl.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/dashboard&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NextResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/auth/signin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, request.url));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // é»˜è®¤æ”¾è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NextResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åŒ¹é…è§„åˆ™ï¼šåªåœ¨ /dashboard ä¸‹ç”Ÿæ•ˆ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  matcher: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/dashboard/:path*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><code>matcher: [&quot;/dashboard/:path*&quot;]</code> è¡¨ç¤º <code>/dashboard</code> ä¸‹çš„æ‰€æœ‰è·¯å¾„ï¼ŒåŒ…æ‹¬ï¼š <code>/dashboard</code>ã€<code>/dashboard/about</code>ã€<code>/dashboard/blog/123</code> ç­‰ã€‚éƒ½ä¼šè§¦å‘ <code>middleware</code> å‡½æ•°ã€‚</p><p>ä¸Šé¢çš„ä»£ç å«ä¹‰ï¼šå¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œå¹¶ä¸”è¯·æ±‚è·¯å¾„ä»¥ <code>/dashboard</code> å¼€å¤´ï¼Œå°±é‡å®šå‘åˆ° <code>/auth/signin</code>ã€‚</p><p><strong>å¦‚å›¾æœªç™»å½•ï¼š</strong></p><p><img src="`+r+'" alt="æœªç™»å½•é‡å®šå‘" loading="lazy"></p><p><strong>å¦‚å›¾å·²ç™»å½•ï¼š</strong></p><p><img src="'+d+`" alt="å·²ç™»å½•" loading="lazy"></p><h3 id="_2-å›½é™…åŒ–-è·¯ç”±é‡å†™" tabindex="-1">(2) <strong>å›½é™…åŒ– / è·¯ç”±é‡å†™</strong> <a class="header-anchor" href="#_2-å›½é™…åŒ–-è·¯ç”±é‡å†™" aria-label="Permalink to &quot;(2) **å›½é™…åŒ– / è·¯ç”±é‡å†™**&quot;">â€‹</a></h3><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> middleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NextRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pathname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.nextUrl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¦‚æœè·¯å¾„æ²¡æœ‰è¯­è¨€å‰ç¼€ï¼Œé‡å†™åˆ°é»˜è®¤è¯­è¨€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/en&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/zh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.nextUrl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    url.pathname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`/en\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pathname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NextResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rewrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NextResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_3-a-b-æµ‹è¯•" tabindex="-1">(3) <strong>A/B æµ‹è¯•</strong> <a class="header-anchor" href="#_3-a-b-æµ‹è¯•" aria-label="Permalink to &quot;(3) **A/B æµ‹è¯•**&quot;">â€‹</a></h3><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> middleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NextRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NextResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç®€å•éšæœºåˆ†æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">random</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NextResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rewrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/experiment-a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, request.url));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NextResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rewrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/experiment-b&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, request.url));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-é˜²ç›—é“¾-è®¿é—®æ§åˆ¶" tabindex="-1">(4) <strong>é˜²ç›—é“¾ / è®¿é—®æ§åˆ¶</strong> <a class="header-anchor" href="#_4-é˜²ç›—é“¾-è®¿é—®æ§åˆ¶" aria-label="Permalink to &quot;(4) **é˜²ç›—é“¾ / è®¿é—®æ§åˆ¶**&quot;">â€‹</a></h3><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> middleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NextRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> referer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;referer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (referer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">referer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;yourdomain.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NextResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ç¦æ­¢è®¿é—®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { status: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">403</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NextResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_4-middleware-çš„é™åˆ¶" tabindex="-1">4. Middleware çš„é™åˆ¶ <a class="header-anchor" href="#_4-middleware-çš„é™åˆ¶" aria-label="Permalink to &quot;4. Middleware çš„é™åˆ¶&quot;">â€‹</a></h2><ul><li>è¿è¡Œåœ¨ <strong>Edge Runtime</strong>ï¼Œä¸æ”¯æŒ <code>fs</code>ã€<code>net</code> ç­‰ Node.js APIã€‚</li><li><strong>æ‰§è¡Œæ—¶é—´éå¸¸çŸ­</strong>ï¼Œé€‚åˆè½»é‡é€»è¾‘ã€‚</li><li><strong>ä¸èƒ½ç›´æ¥ä¿®æ”¹å“åº”ä½“</strong>ï¼ˆåªèƒ½ <code>rewrite</code>ã€<code>redirect</code>ã€<code>next</code>ï¼‰ã€‚</li><li>å¦‚æœé€»è¾‘å¤æ‚ï¼Œåº”è¯¥æ”¾åœ¨ <strong>API Route æˆ– Server Action</strong> é‡Œå¤„ç†ã€‚</li></ul>`,24))])}const A=n(E,[["render",g]]);export{m as __pageData,A as default};
