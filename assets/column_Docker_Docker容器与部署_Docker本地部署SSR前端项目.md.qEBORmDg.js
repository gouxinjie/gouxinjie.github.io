import{_ as i,C as e,c as l,o as p,j as a,G as r,aQ as t,a as h}from"./chunks/framework.DEi4YP2n.js";const k="/assets/docker-ssr.BPIBVdMa.png",y=JSON.parse('{"title":"Docker 本地部署 SSR 前端项目实战指南","description":"","frontmatter":{},"headers":[],"relativePath":"column/Docker/Docker容器与部署/Docker本地部署SSR前端项目.md","filePath":"column/Docker/Docker容器与部署/Docker本地部署SSR前端项目.md","lastUpdated":1766709137000}'),c={name:"column/Docker/Docker容器与部署/Docker本地部署SSR前端项目.md"};function o(d,s,E,g,b,u){const n=e("ArticleMetadata");return p(),l("div",null,[s[0]||(s[0]=a("h1",{id:"docker-本地部署-ssr-前端项目实战指南",tabindex:"-1"},[h("Docker 本地部署 SSR 前端项目实战指南 "),a("a",{class:"header-anchor",href:"#docker-本地部署-ssr-前端项目实战指南","aria-label":'Permalink to "Docker 本地部署 SSR 前端项目实战指南"'},"​")],-1)),r(n),s[1]||(s[1]=t('<nav class="table-of-contents"><ul><li><a href="#_1-项目技术栈">1. 项目技术栈</a></li><li><a href="#_2-项目目录结构">2. 项目目录结构</a></li><li><a href="#_3-核心配置文件详解">3. 核心配置文件详解</a><ul><li><a href="#_3-1-dockerfile-多阶段构建">3.1 Dockerfile (多阶段构建)</a></li><li><a href="#_3-2-docker-compose-yml-编排与网络">3.2 docker-compose.yml (编排与网络)</a></li><li><a href="#_3-3-next-config-ts-构建配置">3.3 next.config.ts (构建配置)</a></li></ul></li><li><a href="#_4-为什么容器内不需要-nginx">4. 为什么容器内不需要 Nginx？</a></li><li><a href="#_5-部署步骤">5. 部署步骤</a></li></ul></nav><p><img src="'+k+`" alt="docker-ssr" loading="lazy"></p><p>这篇文档详细介绍如何将基于 Next.js 的银企直连前置机管理系统(我本地的项目)容器化，并在本地使用 <code>Docker</code> 进行部署。</p><h2 id="_1-项目技术栈" tabindex="-1">1. 项目技术栈 <a class="header-anchor" href="#_1-项目技术栈" aria-label="Permalink to &quot;1. 项目技术栈&quot;">​</a></h2><p>本项目采用现代化的 SSR (服务端渲染) 架构，主要技术栈如下：</p><ul><li><strong>核心框架</strong>: <a href="https://nextjs.org/" target="_blank" rel="noreferrer">Next.js 15</a> (App Router 架构) - 提供服务端渲染、API 路由和文件系统路由。</li><li><strong>前端库</strong>: <a href="https://react.dev/" target="_blank" rel="noreferrer">React 18</a> - 构建用户界面。</li><li><strong>UI 组件库</strong>: <a href="https://ant.design/" target="_blank" rel="noreferrer">Ant Design 5</a> - 企业级 React 组件库。</li><li><strong>样式方案</strong>: <a href="https://tailwindcss.com/" target="_blank" rel="noreferrer">Tailwind CSS 4</a> &amp; Sass - 原子化 CSS 与预处理器结合。</li><li><strong>数据库交互</strong>: <a href="https://github.com/sidorares/node-mysql2" target="_blank" rel="noreferrer">MySQL2</a> - Node.js 的 MySQL 驱动。</li><li><strong>认证方案</strong>: <a href="https://next-auth.js.org/" target="_blank" rel="noreferrer">NextAuth.js</a> - 完整的身份验证解决方案。</li><li><strong>包管理工具</strong>: pnpm - 高效的包管理器。</li></ul><div class="tip custom-block"><p class="custom-block-title">提示</p><p>数据库用的是我本地安装的 MySQL，里面已有各种数据，省略了数据库相关的建库和建表。</p></div><h2 id="_2-项目目录结构" tabindex="-1">2. 项目目录结构 <a class="header-anchor" href="#_2-项目目录结构" aria-label="Permalink to &quot;2. 项目目录结构&quot;">​</a></h2><p>项目的核心结构基于 Next.js App Router：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>yqzl/</span></span>
<span class="line"><span>├── app/                  # 应用主入口 (App Router)</span></span>
<span class="line"><span>│   ├── api/              # 后端 API 接口定义</span></span>
<span class="line"><span>│   ├── auth/             # 认证相关页面</span></span>
<span class="line"><span>│   ├── components/       # 公共组件 (Sidebar, ConditionalLayout 等)</span></span>
<span class="line"><span>│   ├── dashboard/        # 仪表盘页面</span></span>
<span class="line"><span>│   ├── documents/        # 文档管理模块</span></span>
<span class="line"><span>│   └── lib/              # 核心工具库 (如 mysql 数据库连接)</span></span>
<span class="line"><span>├── public/               # 静态资源</span></span>
<span class="line"><span>├── types/                # TypeScript 类型定义</span></span>
<span class="line"><span>├── Dockerfile            # Docker 构建描述文件</span></span>
<span class="line"><span>├── docker-compose.yml    # 容器编排配置</span></span>
<span class="line"><span>├── next.config.ts        # Next.js 配置文件</span></span>
<span class="line"><span>└── .env                  # 环境变量 (敏感信息)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="_3-核心配置文件详解" tabindex="-1">3. 核心配置文件详解 <a class="header-anchor" href="#_3-核心配置文件详解" aria-label="Permalink to &quot;3. 核心配置文件详解&quot;">​</a></h2><h3 id="_3-1-dockerfile-多阶段构建" tabindex="-1">3.1 Dockerfile (多阶段构建) <a class="header-anchor" href="#_3-1-dockerfile-多阶段构建" aria-label="Permalink to &quot;3.1 Dockerfile (多阶段构建)&quot;">​</a></h3><p>为了优化镜像体积和构建效率，我们使用了 Docker 的多阶段构建 (Multi-stage build) 功能。</p><ul><li><strong>Stage 1: deps</strong>: 仅复制 <code>package.json</code> 和 <code>pnpm-lock.yaml</code> 并安装依赖。利用 Docker 缓存层，只要依赖不变，此阶段会被缓存。</li><li><strong>Stage 2: builder</strong>: 复制源码并运行 <code>pnpm build</code> 进行编译。</li><li><strong>Stage 3: runner</strong>: 生产运行环境。基于 <code>node:20-alpine</code>，仅复制构建产物 (<code>.next</code> 文件夹、<code>public</code> 文件夹) 和必要的 <code>node_modules</code>。</li></ul><p><strong>dockerfile 完整配置</strong>:</p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 基础镜像</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:20-alpine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm install -g pnpm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 依赖安装阶段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deps</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> package.json pnpm-lock.yaml ./</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm install --frozen-lockfile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 编译构建阶段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=deps /app/node_modules ./node_modules</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . .</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 提示：如果 build 报错，记得在 next.config.ts 中暂时关闭 ESLint 检查</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 运行阶段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> runner</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NODE_ENV production</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 关键配置：允许从外部访问容器内的 3000 端口</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HOSTNAME </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/public ./public</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/.next ./.next</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/node_modules ./node_modules</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/package.json ./package.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pnpm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_3-2-docker-compose-yml-编排与网络" tabindex="-1">3.2 docker-compose.yml (编排与网络) <a class="header-anchor" href="#_3-2-docker-compose-yml-编排与网络" aria-label="Permalink to &quot;3.2 docker-compose.yml (编排与网络)&quot;">​</a></h3><p>此文件定义了如何运行应用服务，特别是解决了<strong>容器连接宿主机数据库</strong>的问题。</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      dockerfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">yqzl-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3000:3000&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    env_file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.env</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 这里重写 MYSQL_HOST，使其指向宿主机</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 在 Windows/Mac 的 Docker Desktop 中，host.docker.internal 指向宿主机</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MYSQL_HOST=host.docker.internal</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    extra_hosts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;host.docker.internal:host-gateway&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">always</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">yqzl-network</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ul><li><strong><code>host.docker.internal</code></strong>: 这是 Docker Desktop (Windows/Mac) 提供的特殊 DNS 名称，允许容器内部访问宿主机的网络服务 (如本地运行的 MySQL)。</li></ul><h3 id="_3-3-next-config-ts-构建配置" tabindex="-1">3.3 next.config.ts (构建配置) <a class="header-anchor" href="#_3-3-next-config-ts-构建配置" aria-label="Permalink to &quot;3.3 next.config.ts (构建配置)&quot;">​</a></h3><p>针对 Docker 环境，我们建议在构建时适当放宽检查，以避免因细微的 Lint 错误导致构建失败：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nextConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NextConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  eslint: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 忽略构建时的 ESLint 错误，确保能够生成镜像</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ignoreDuringBuilds: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  typescript: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ignoreBuildErrors: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_4-为什么容器内不需要-nginx" tabindex="-1">4. 为什么容器内不需要 Nginx？ <a class="header-anchor" href="#_4-为什么容器内不需要-nginx" aria-label="Permalink to &quot;4. 为什么容器内不需要 Nginx？&quot;">​</a></h2><p>在传统的 <code>SPA (Single Page Application)</code> 部署中，前端构建出的是静态 <code>HTML/CSS/JS</code> 文件，因此必须依赖 <code>Nginx 或 Apache</code> 这样的 <code>Web Server</code> 来提供文件服务。</p><p>但在 <strong>SSR (Next.js)</strong> 架构中，情况有所不同：</p><ol><li><strong>Node.js 自带服务</strong>: Next.js 生产环境 (<code>next start</code>) 启动的是一个全功能的 Node.js HTTP 服务器。它不仅能处理 API 请求、服务端渲染动态页面，也能高效地托管 <code>public</code> 和 <code>.next/static</code> 中的静态资源。</li><li><strong>架构解耦</strong>: 根据容器化的“单一职责原则”，应用容器应该只包含应用本身。</li><li><strong>反向代理通常在外层</strong>: 如果需要 Nginx (用于 SSL 终止、负载均衡、gzip 压缩等)，通常建议将其部署在容器<strong>外部</strong> (作为宿主机服务或另一个独立的 Nginx 容器)，作为整个系统的网关 (Gateway)，而不是塞进应用容器里。</li></ol><p>因此，直接在 Docker 中运行 <code>pnpm start</code> 是最简洁、高效且符合云原生理念的做法。</p><h2 id="_5-部署步骤" tabindex="-1">5. 部署步骤 <a class="header-anchor" href="#_5-部署步骤" aria-label="Permalink to &quot;5. 部署步骤&quot;">​</a></h2><ol><li><p><strong>准备环境</strong>:</p><ul><li>确保已安装 <a href="https://www.docker.com/products/docker-desktop/" target="_blank" rel="noreferrer">Docker Desktop for Windows</a>。</li><li>确保本地 MySQL 服务已启动，且用户权限允许远程连接 (或至少允许 Docker 网段连接)。</li></ul></li><li><p><strong>配置环境</strong>:</p><ul><li>确保项目根目录存在 <code>.env</code> 文件，且包含正确的数据库凭证。</li></ul></li><li><p><strong>启动部署</strong>: 在项目根目录打开 PowerShell 或终端，运行：</p><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">compose up </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">build</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>-d</code>: 后台运行。</li><li><code>--build</code>: 强制重新构建镜像 (确保代码变更为最新)。</li></ul></li><li><p><strong>访问应用</strong>: 打开浏览器访问 <code>http://localhost:3000</code>。</p></li><li><p><strong>查看日志</strong>: 如果遇到问题，查看容器日志：</p><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">compose logs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-f</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>停止服务</strong>:</p><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">compose down</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol>`,30))])}const D=i(c,[["render",o]]);export{y as __pageData,D as default};
