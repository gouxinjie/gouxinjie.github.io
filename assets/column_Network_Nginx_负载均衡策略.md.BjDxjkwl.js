import{_ as n,C as e,c as l,o as p,j as i,G as t,aQ as h,a as r}from"./chunks/framework.DEi4YP2n.js";const k="/assets/nginx-7.uUVYVFzV.png",m=JSON.parse('{"title":"Nginx 负载均衡策略","description":"","frontmatter":{},"headers":[],"relativePath":"column/Network/Nginx/负载均衡策略.md","filePath":"column/Network/Nginx/负载均衡策略.md","lastUpdated":1759999524000}'),d={name:"column/Network/Nginx/负载均衡策略.md"};function g(o,s,c,b,E,u){const a=e("ArticleMetadata");return p(),l("div",null,[s[0]||(s[0]=i("h1",{id:"nginx-负载均衡策略",tabindex:"-1"},[i("strong",null,"Nginx 负载均衡策略"),r(),i("a",{class:"header-anchor",href:"#nginx-负载均衡策略","aria-label":'Permalink to "**Nginx 负载均衡策略**"'},"​")],-1)),t(a),s[1]||(s[1]=h(`<nav class="table-of-contents"><ul><li><a href="#_1-基础负载均衡配置">1. 基础负载均衡配置</a></li><li><a href="#_2-核心负载均衡策略">2. 核心负载均衡策略</a><ul><li><a href="#_2-1-轮询-round-robin">2.1 轮询（Round Robin）</a></li><li><a href="#_2-2-加权轮询-weighted-round-robin">2.2 加权轮询（Weighted Round Robin）</a></li><li><a href="#_2-3-最少连接-least-connections">2.3 最少连接（Least Connections）</a></li><li><a href="#_2-4-ip-哈希-ip-hash">2.4 IP 哈希（IP Hash）</a></li><li><a href="#_2-5-响应时间优先-least-time">2.5 响应时间优先（Least Time）</a></li><li><a href="#_2-6-随机负载均衡-random">2.6 随机负载均衡（Random）</a></li></ul></li><li><a href="#_3-高级配置技巧">3. 高级配置技巧</a><ul><li><a href="#_3-1-健康检查">3.1 健康检查</a></li><li><a href="#_3-2-备份服务器">3.2 备份服务器</a></li><li><a href="#_3-3-长连接优化">3.3 长连接优化</a></li><li><a href="#_3-4-分片负载均衡">3.4 分片负载均衡</a></li></ul></li><li><a href="#_4-策略选择决策指南">4. 策略选择决策指南</a></li><li><a href="#_5-可视化策略对比">5. 可视化策略对比</a></li><li><a href="#_6-性能监控建议">6. 性能监控建议</a></li><li><a href="#_7-常见问题解决方案">7. 常见问题解决方案</a></li></ul></nav><p><code>Nginx </code>作为高性能的反向代理服务器，提供了多种负载均衡算法，能有效分配客户端请求到后端服务器群集。</p><h2 id="_1-基础负载均衡配置" tabindex="-1"><strong>1. 基础负载均衡配置</strong> <a class="header-anchor" href="#_1-基础负载均衡配置" aria-label="Permalink to &quot;**1. 基础负载均衡配置**&quot;">​</a></h2><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 定义后端服务器群</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 10.0.0.1:80;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 10.0.0.2:80;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 10.0.0.3:80;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://backend;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_2-核心负载均衡策略" tabindex="-1"><strong>2. 核心负载均衡策略</strong> <a class="header-anchor" href="#_2-核心负载均衡策略" aria-label="Permalink to &quot;**2. 核心负载均衡策略**&quot;">​</a></h2><h3 id="_2-1-轮询-round-robin" tabindex="-1"><strong>2.1 轮询（Round Robin）</strong> <a class="header-anchor" href="#_2-1-轮询-round-robin" aria-label="Permalink to &quot;**2.1 轮询（Round Robin）**&quot;">​</a></h3><p><strong>默认策略</strong>，按顺序均匀分配请求</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 权重默认为1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>特点</strong>：</p><ul><li>简单公平的请求分配</li><li>不考虑服务器负载情况</li><li>适合服务器性能相近的场景</li></ul><h3 id="_2-2-加权轮询-weighted-round-robin" tabindex="-1"><strong>2.2 加权轮询（Weighted Round Robin）</strong> <a class="header-anchor" href="#_2-2-加权轮询-weighted-round-robin" aria-label="Permalink to &quot;**2.2 加权轮询（Weighted Round Robin）**&quot;">​</a></h3><p>根据服务器性能分配不同权重</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 处理3倍请求</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    server </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0.0.2</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>特点</strong>：</p><ul><li>高性能服务器可承担更多流量</li><li>权重比为请求分配比例（如 3:1）</li><li>需手动配置权重值</li></ul><h3 id="_2-3-最少连接-least-connections" tabindex="-1"><strong>2.3 最少连接（Least Connections）</strong> <a class="header-anchor" href="#_2-3-最少连接-least-connections" aria-label="Permalink to &quot;**2.3 最少连接（Least Connections）**&quot;">​</a></h3><p>优先选择当前连接数最少的服务器</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    least_conn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>特点</strong>：</p><ul><li>动态平衡服务器负载</li><li>适合长连接场景（如 WebSocket）</li><li>需要 Nginx 实时监控连接数</li></ul><h3 id="_2-4-ip-哈希-ip-hash" tabindex="-1"><strong>2.4 IP 哈希（IP Hash）</strong> <a class="header-anchor" href="#_2-4-ip-哈希-ip-hash" aria-label="Permalink to &quot;**2.4 IP 哈希（IP Hash）**&quot;">​</a></h3><p>基于客户端 IP 固定分配服务器</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ip_hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>特点</strong>：</p><ul><li>保持会话一致性（Session Persistence）</li><li>解决分布式会话问题</li><li>可能导致负载不均</li></ul><h3 id="_2-5-响应时间优先-least-time" tabindex="-1"><strong>2.5 响应时间优先（Least Time）</strong> <a class="header-anchor" href="#_2-5-响应时间优先-least-time" aria-label="Permalink to &quot;**2.5 响应时间优先（Least Time）**&quot;">​</a></h3><p>Nginx Plus 专属，基于响应时间和连接数</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    least_time </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">header; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或last_byte</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>特点</strong>：</p><ul><li>商业版 Nginx 独有功能</li><li>选择最快响应的服务器</li><li>需要服务器性能监控</li></ul><h3 id="_2-6-随机负载均衡-random" tabindex="-1"><strong>2.6 随机负载均衡（Random）</strong> <a class="header-anchor" href="#_2-6-随机负载均衡-random" aria-label="Permalink to &quot;**2.6 随机负载均衡（Random）**&quot;">​</a></h3><p>随机选择后端服务器</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    random;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>变种</strong>：带权重的随机</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    random </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">two; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 随机选2台后根据权重选择</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    server </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0.0.2</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_3-高级配置技巧" tabindex="-1"><strong>3. 高级配置技巧</strong> <a class="header-anchor" href="#_3-高级配置技巧" aria-label="Permalink to &quot;**3. 高级配置技巧**&quot;">​</a></h2><h3 id="_3-1-健康检查" tabindex="-1"><strong>3.1 健康检查</strong> <a class="header-anchor" href="#_3-1-健康检查" aria-label="Permalink to &quot;**3.1 健康检查**&quot;">​</a></h3><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> max_fails</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fail_timeout=30s;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>max_fails</code>：允许失败次数</li><li><code>fail_timeout</code>：故障服务器暂停服务时间</li></ul><h3 id="_3-2-备份服务器" tabindex="-1"><strong>3.2 备份服务器</strong> <a class="header-anchor" href="#_3-2-备份服务器" aria-label="Permalink to &quot;**3.2 备份服务器**&quot;">​</a></h3><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> backup; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 仅当主服务器不可用时启用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-3-长连接优化" tabindex="-1"><strong>3.3 长连接优化</strong> <a class="header-anchor" href="#_3-3-长连接优化" aria-label="Permalink to &quot;**3.3 长连接优化**&quot;">​</a></h3><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    keepalive </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保持的连接池大小</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-4-分片负载均衡" tabindex="-1"><strong>3.4 分片负载均衡</strong> <a class="header-anchor" href="#_3-4-分片负载均衡" aria-label="Permalink to &quot;**3.4 分片负载均衡**&quot;">​</a></h3><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 按URL路径分配到不同集群</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /video/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://video_backend;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /api/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://api_backend;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_4-策略选择决策指南" tabindex="-1"><strong>4. 策略选择决策指南</strong> <a class="header-anchor" href="#_4-策略选择决策指南" aria-label="Permalink to &quot;**4. 策略选择决策指南**&quot;">​</a></h2><table tabindex="0"><thead><tr><th>场景</th><th>推荐策略</th><th>原因</th></tr></thead><tbody><tr><td>常规 Web 应用</td><td>加权轮询</td><td>简单高效</td></tr><tr><td>会话依赖型应用</td><td>IP 哈希</td><td>保持会话一致</td></tr><tr><td>长连接服务</td><td>最少连接</td><td>平衡持久连接</td></tr><tr><td>静态资源分发</td><td>轮询</td><td>无状态请求</td></tr><tr><td>高可用集群</td><td>健康检查+备份</td><td>故障自动转移</td></tr><tr><td>商业版环境</td><td>响应时间优先</td><td>最优性能</td></tr></tbody></table><h2 id="_5-可视化策略对比" tabindex="-1"><strong>5. 可视化策略对比</strong> <a class="header-anchor" href="#_5-可视化策略对比" aria-label="Permalink to &quot;**5. 可视化策略对比**&quot;">​</a></h2><p><img src="`+k+`" alt="负载均衡策略对比" loading="lazy"></p><h2 id="_6-性能监控建议" tabindex="-1"><strong>6. 性能监控建议</strong> <a class="header-anchor" href="#_6-性能监控建议" aria-label="Permalink to &quot;**6. 性能监控建议**&quot;">​</a></h2><ol><li><p><strong>Nginx 状态模块</strong>：</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /nginx_status </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    stub_status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> on;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    allow </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.0.0.0/24;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    deny </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>关键指标</strong>：</p><ul><li>请求处理速率（Requests/sec）</li><li>后端服务器响应时间</li><li>活跃连接数</li></ul></li><li><p><strong>日志分析</strong>：</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">log_format </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">upstream_log </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remote_addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> - $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">upstream_addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> - $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">upstream_response_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h2 id="_7-常见问题解决方案" tabindex="-1"><strong>7. 常见问题解决方案</strong> <a class="header-anchor" href="#_7-常见问题解决方案" aria-label="Permalink to &quot;**7. 常见问题解决方案**&quot;">​</a></h2><p><strong>问题 1：会话不一致</strong><br> 👉 方案：使用<code>ip_hash</code>或引入 Redis 集中式会话存储</p><p><strong>问题 2：某台服务器过载</strong><br> 👉 方案：调整权重或启用<code>least_conn</code></p><p><strong>问题 3：健康检查不灵敏</strong><br> 👉 方案：减小<code>fail_timeout</code>值（如改为 10s）</p><p><strong>问题 4：DNS 缓存问题</strong><br> 👉 方案：在 upstream 中直接使用 IP 地址</p>`,56))])}const F=n(d,[["render",g]]);export{m as __pageData,F as default};
