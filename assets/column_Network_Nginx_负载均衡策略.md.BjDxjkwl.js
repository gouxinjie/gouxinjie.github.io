import{_ as n,C as e,c as l,o as p,j as i,G as t,aQ as h,a as r}from"./chunks/framework.DEi4YP2n.js";const k="/assets/nginx-7.uUVYVFzV.png",m=JSON.parse('{"title":"Nginx è´Ÿè½½å‡è¡¡ç­–ç•¥","description":"","frontmatter":{},"headers":[],"relativePath":"column/Network/Nginx/è´Ÿè½½å‡è¡¡ç­–ç•¥.md","filePath":"column/Network/Nginx/è´Ÿè½½å‡è¡¡ç­–ç•¥.md","lastUpdated":1759999524000}'),d={name:"column/Network/Nginx/è´Ÿè½½å‡è¡¡ç­–ç•¥.md"};function g(o,s,c,b,E,u){const a=e("ArticleMetadata");return p(),l("div",null,[s[0]||(s[0]=i("h1",{id:"nginx-è´Ÿè½½å‡è¡¡ç­–ç•¥",tabindex:"-1"},[i("strong",null,"Nginx è´Ÿè½½å‡è¡¡ç­–ç•¥"),r(),i("a",{class:"header-anchor",href:"#nginx-è´Ÿè½½å‡è¡¡ç­–ç•¥","aria-label":'Permalink to "**Nginx è´Ÿè½½å‡è¡¡ç­–ç•¥**"'},"â€‹")],-1)),t(a),s[1]||(s[1]=h(`<nav class="table-of-contents"><ul><li><a href="#_1-åŸºç¡€è´Ÿè½½å‡è¡¡é…ç½®">1. åŸºç¡€è´Ÿè½½å‡è¡¡é…ç½®</a></li><li><a href="#_2-æ ¸å¿ƒè´Ÿè½½å‡è¡¡ç­–ç•¥">2. æ ¸å¿ƒè´Ÿè½½å‡è¡¡ç­–ç•¥</a><ul><li><a href="#_2-1-è½®è¯¢-round-robin">2.1 è½®è¯¢ï¼ˆRound Robinï¼‰</a></li><li><a href="#_2-2-åŠ æƒè½®è¯¢-weighted-round-robin">2.2 åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robinï¼‰</a></li><li><a href="#_2-3-æœ€å°‘è¿æ¥-least-connections">2.3 æœ€å°‘è¿æ¥ï¼ˆLeast Connectionsï¼‰</a></li><li><a href="#_2-4-ip-å“ˆå¸Œ-ip-hash">2.4 IP å“ˆå¸Œï¼ˆIP Hashï¼‰</a></li><li><a href="#_2-5-å“åº”æ—¶é—´ä¼˜å…ˆ-least-time">2.5 å“åº”æ—¶é—´ä¼˜å…ˆï¼ˆLeast Timeï¼‰</a></li><li><a href="#_2-6-éšæœºè´Ÿè½½å‡è¡¡-random">2.6 éšæœºè´Ÿè½½å‡è¡¡ï¼ˆRandomï¼‰</a></li></ul></li><li><a href="#_3-é«˜çº§é…ç½®æŠ€å·§">3. é«˜çº§é…ç½®æŠ€å·§</a><ul><li><a href="#_3-1-å¥åº·æ£€æŸ¥">3.1 å¥åº·æ£€æŸ¥</a></li><li><a href="#_3-2-å¤‡ä»½æœåŠ¡å™¨">3.2 å¤‡ä»½æœåŠ¡å™¨</a></li><li><a href="#_3-3-é•¿è¿æ¥ä¼˜åŒ–">3.3 é•¿è¿æ¥ä¼˜åŒ–</a></li><li><a href="#_3-4-åˆ†ç‰‡è´Ÿè½½å‡è¡¡">3.4 åˆ†ç‰‡è´Ÿè½½å‡è¡¡</a></li></ul></li><li><a href="#_4-ç­–ç•¥é€‰æ‹©å†³ç­–æŒ‡å—">4. ç­–ç•¥é€‰æ‹©å†³ç­–æŒ‡å—</a></li><li><a href="#_5-å¯è§†åŒ–ç­–ç•¥å¯¹æ¯”">5. å¯è§†åŒ–ç­–ç•¥å¯¹æ¯”</a></li><li><a href="#_6-æ€§èƒ½ç›‘æ§å»ºè®®">6. æ€§èƒ½ç›‘æ§å»ºè®®</a></li><li><a href="#_7-å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ">7. å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ</a></li></ul></nav><p><code>Nginx </code>ä½œä¸ºé«˜æ€§èƒ½çš„åå‘ä»£ç†æœåŠ¡å™¨ï¼Œæä¾›äº†å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œèƒ½æœ‰æ•ˆåˆ†é…å®¢æˆ·ç«¯è¯·æ±‚åˆ°åç«¯æœåŠ¡å™¨ç¾¤é›†ã€‚</p><h2 id="_1-åŸºç¡€è´Ÿè½½å‡è¡¡é…ç½®" tabindex="-1"><strong>1. åŸºç¡€è´Ÿè½½å‡è¡¡é…ç½®</strong> <a class="header-anchor" href="#_1-åŸºç¡€è´Ÿè½½å‡è¡¡é…ç½®" aria-label="Permalink to &quot;**1. åŸºç¡€è´Ÿè½½å‡è¡¡é…ç½®**&quot;">â€‹</a></h2><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å®šä¹‰åç«¯æœåŠ¡å™¨ç¾¤</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 10.0.0.1:80;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 10.0.0.2:80;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 10.0.0.3:80;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://backend;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_2-æ ¸å¿ƒè´Ÿè½½å‡è¡¡ç­–ç•¥" tabindex="-1"><strong>2. æ ¸å¿ƒè´Ÿè½½å‡è¡¡ç­–ç•¥</strong> <a class="header-anchor" href="#_2-æ ¸å¿ƒè´Ÿè½½å‡è¡¡ç­–ç•¥" aria-label="Permalink to &quot;**2. æ ¸å¿ƒè´Ÿè½½å‡è¡¡ç­–ç•¥**&quot;">â€‹</a></h2><h3 id="_2-1-è½®è¯¢-round-robin" tabindex="-1"><strong>2.1 è½®è¯¢ï¼ˆRound Robinï¼‰</strong> <a class="header-anchor" href="#_2-1-è½®è¯¢-round-robin" aria-label="Permalink to &quot;**2.1 è½®è¯¢ï¼ˆRound Robinï¼‰**&quot;">â€‹</a></h3><p><strong>é»˜è®¤ç­–ç•¥</strong>ï¼ŒæŒ‰é¡ºåºå‡åŒ€åˆ†é…è¯·æ±‚</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æƒé‡é»˜è®¤ä¸º1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>ç®€å•å…¬å¹³çš„è¯·æ±‚åˆ†é…</li><li>ä¸è€ƒè™‘æœåŠ¡å™¨è´Ÿè½½æƒ…å†µ</li><li>é€‚åˆæœåŠ¡å™¨æ€§èƒ½ç›¸è¿‘çš„åœºæ™¯</li></ul><h3 id="_2-2-åŠ æƒè½®è¯¢-weighted-round-robin" tabindex="-1"><strong>2.2 åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robinï¼‰</strong> <a class="header-anchor" href="#_2-2-åŠ æƒè½®è¯¢-weighted-round-robin" aria-label="Permalink to &quot;**2.2 åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robinï¼‰**&quot;">â€‹</a></h3><p>æ ¹æ®æœåŠ¡å™¨æ€§èƒ½åˆ†é…ä¸åŒæƒé‡</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤„ç†3å€è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    server </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0.0.2</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>é«˜æ€§èƒ½æœåŠ¡å™¨å¯æ‰¿æ‹…æ›´å¤šæµé‡</li><li>æƒé‡æ¯”ä¸ºè¯·æ±‚åˆ†é…æ¯”ä¾‹ï¼ˆå¦‚ 3:1ï¼‰</li><li>éœ€æ‰‹åŠ¨é…ç½®æƒé‡å€¼</li></ul><h3 id="_2-3-æœ€å°‘è¿æ¥-least-connections" tabindex="-1"><strong>2.3 æœ€å°‘è¿æ¥ï¼ˆLeast Connectionsï¼‰</strong> <a class="header-anchor" href="#_2-3-æœ€å°‘è¿æ¥-least-connections" aria-label="Permalink to &quot;**2.3 æœ€å°‘è¿æ¥ï¼ˆLeast Connectionsï¼‰**&quot;">â€‹</a></h3><p>ä¼˜å…ˆé€‰æ‹©å½“å‰è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    least_conn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>åŠ¨æ€å¹³è¡¡æœåŠ¡å™¨è´Ÿè½½</li><li>é€‚åˆé•¿è¿æ¥åœºæ™¯ï¼ˆå¦‚ WebSocketï¼‰</li><li>éœ€è¦ Nginx å®æ—¶ç›‘æ§è¿æ¥æ•°</li></ul><h3 id="_2-4-ip-å“ˆå¸Œ-ip-hash" tabindex="-1"><strong>2.4 IP å“ˆå¸Œï¼ˆIP Hashï¼‰</strong> <a class="header-anchor" href="#_2-4-ip-å“ˆå¸Œ-ip-hash" aria-label="Permalink to &quot;**2.4 IP å“ˆå¸Œï¼ˆIP Hashï¼‰**&quot;">â€‹</a></h3><p>åŸºäºå®¢æˆ·ç«¯ IP å›ºå®šåˆ†é…æœåŠ¡å™¨</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ip_hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>ä¿æŒä¼šè¯ä¸€è‡´æ€§ï¼ˆSession Persistenceï¼‰</li><li>è§£å†³åˆ†å¸ƒå¼ä¼šè¯é—®é¢˜</li><li>å¯èƒ½å¯¼è‡´è´Ÿè½½ä¸å‡</li></ul><h3 id="_2-5-å“åº”æ—¶é—´ä¼˜å…ˆ-least-time" tabindex="-1"><strong>2.5 å“åº”æ—¶é—´ä¼˜å…ˆï¼ˆLeast Timeï¼‰</strong> <a class="header-anchor" href="#_2-5-å“åº”æ—¶é—´ä¼˜å…ˆ-least-time" aria-label="Permalink to &quot;**2.5 å“åº”æ—¶é—´ä¼˜å…ˆï¼ˆLeast Timeï¼‰**&quot;">â€‹</a></h3><p>Nginx Plus ä¸“å±ï¼ŒåŸºäºå“åº”æ—¶é—´å’Œè¿æ¥æ•°</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    least_time </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">header; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æˆ–last_byte</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>å•†ä¸šç‰ˆ Nginx ç‹¬æœ‰åŠŸèƒ½</li><li>é€‰æ‹©æœ€å¿«å“åº”çš„æœåŠ¡å™¨</li><li>éœ€è¦æœåŠ¡å™¨æ€§èƒ½ç›‘æ§</li></ul><h3 id="_2-6-éšæœºè´Ÿè½½å‡è¡¡-random" tabindex="-1"><strong>2.6 éšæœºè´Ÿè½½å‡è¡¡ï¼ˆRandomï¼‰</strong> <a class="header-anchor" href="#_2-6-éšæœºè´Ÿè½½å‡è¡¡-random" aria-label="Permalink to &quot;**2.6 éšæœºè´Ÿè½½å‡è¡¡ï¼ˆRandomï¼‰**&quot;">â€‹</a></h3><p>éšæœºé€‰æ‹©åç«¯æœåŠ¡å™¨</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    random;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>å˜ç§</strong>ï¼šå¸¦æƒé‡çš„éšæœº</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    random </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">two; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># éšæœºé€‰2å°åæ ¹æ®æƒé‡é€‰æ‹©</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    server </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0.0.2</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_3-é«˜çº§é…ç½®æŠ€å·§" tabindex="-1"><strong>3. é«˜çº§é…ç½®æŠ€å·§</strong> <a class="header-anchor" href="#_3-é«˜çº§é…ç½®æŠ€å·§" aria-label="Permalink to &quot;**3. é«˜çº§é…ç½®æŠ€å·§**&quot;">â€‹</a></h2><h3 id="_3-1-å¥åº·æ£€æŸ¥" tabindex="-1"><strong>3.1 å¥åº·æ£€æŸ¥</strong> <a class="header-anchor" href="#_3-1-å¥åº·æ£€æŸ¥" aria-label="Permalink to &quot;**3.1 å¥åº·æ£€æŸ¥**&quot;">â€‹</a></h3><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> max_fails</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fail_timeout=30s;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>max_fails</code>ï¼šå…è®¸å¤±è´¥æ¬¡æ•°</li><li><code>fail_timeout</code>ï¼šæ•…éšœæœåŠ¡å™¨æš‚åœæœåŠ¡æ—¶é—´</li></ul><h3 id="_3-2-å¤‡ä»½æœåŠ¡å™¨" tabindex="-1"><strong>3.2 å¤‡ä»½æœåŠ¡å™¨</strong> <a class="header-anchor" href="#_3-2-å¤‡ä»½æœåŠ¡å™¨" aria-label="Permalink to &quot;**3.2 å¤‡ä»½æœåŠ¡å™¨**&quot;">â€‹</a></h3><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> backup; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä»…å½“ä¸»æœåŠ¡å™¨ä¸å¯ç”¨æ—¶å¯ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-3-é•¿è¿æ¥ä¼˜åŒ–" tabindex="-1"><strong>3.3 é•¿è¿æ¥ä¼˜åŒ–</strong> <a class="header-anchor" href="#_3-3-é•¿è¿æ¥ä¼˜åŒ–" aria-label="Permalink to &quot;**3.3 é•¿è¿æ¥ä¼˜åŒ–**&quot;">â€‹</a></h3><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    keepalive </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¿æŒçš„è¿æ¥æ± å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-4-åˆ†ç‰‡è´Ÿè½½å‡è¡¡" tabindex="-1"><strong>3.4 åˆ†ç‰‡è´Ÿè½½å‡è¡¡</strong> <a class="header-anchor" href="#_3-4-åˆ†ç‰‡è´Ÿè½½å‡è¡¡" aria-label="Permalink to &quot;**3.4 åˆ†ç‰‡è´Ÿè½½å‡è¡¡**&quot;">â€‹</a></h3><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŒ‰URLè·¯å¾„åˆ†é…åˆ°ä¸åŒé›†ç¾¤</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /video/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://video_backend;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /api/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://api_backend;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_4-ç­–ç•¥é€‰æ‹©å†³ç­–æŒ‡å—" tabindex="-1"><strong>4. ç­–ç•¥é€‰æ‹©å†³ç­–æŒ‡å—</strong> <a class="header-anchor" href="#_4-ç­–ç•¥é€‰æ‹©å†³ç­–æŒ‡å—" aria-label="Permalink to &quot;**4. ç­–ç•¥é€‰æ‹©å†³ç­–æŒ‡å—**&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>åœºæ™¯</th><th>æ¨èç­–ç•¥</th><th>åŸå› </th></tr></thead><tbody><tr><td>å¸¸è§„ Web åº”ç”¨</td><td>åŠ æƒè½®è¯¢</td><td>ç®€å•é«˜æ•ˆ</td></tr><tr><td>ä¼šè¯ä¾èµ–å‹åº”ç”¨</td><td>IP å“ˆå¸Œ</td><td>ä¿æŒä¼šè¯ä¸€è‡´</td></tr><tr><td>é•¿è¿æ¥æœåŠ¡</td><td>æœ€å°‘è¿æ¥</td><td>å¹³è¡¡æŒä¹…è¿æ¥</td></tr><tr><td>é™æ€èµ„æºåˆ†å‘</td><td>è½®è¯¢</td><td>æ— çŠ¶æ€è¯·æ±‚</td></tr><tr><td>é«˜å¯ç”¨é›†ç¾¤</td><td>å¥åº·æ£€æŸ¥+å¤‡ä»½</td><td>æ•…éšœè‡ªåŠ¨è½¬ç§»</td></tr><tr><td>å•†ä¸šç‰ˆç¯å¢ƒ</td><td>å“åº”æ—¶é—´ä¼˜å…ˆ</td><td>æœ€ä¼˜æ€§èƒ½</td></tr></tbody></table><h2 id="_5-å¯è§†åŒ–ç­–ç•¥å¯¹æ¯”" tabindex="-1"><strong>5. å¯è§†åŒ–ç­–ç•¥å¯¹æ¯”</strong> <a class="header-anchor" href="#_5-å¯è§†åŒ–ç­–ç•¥å¯¹æ¯”" aria-label="Permalink to &quot;**5. å¯è§†åŒ–ç­–ç•¥å¯¹æ¯”**&quot;">â€‹</a></h2><p><img src="`+k+`" alt="è´Ÿè½½å‡è¡¡ç­–ç•¥å¯¹æ¯”" loading="lazy"></p><h2 id="_6-æ€§èƒ½ç›‘æ§å»ºè®®" tabindex="-1"><strong>6. æ€§èƒ½ç›‘æ§å»ºè®®</strong> <a class="header-anchor" href="#_6-æ€§èƒ½ç›‘æ§å»ºè®®" aria-label="Permalink to &quot;**6. æ€§èƒ½ç›‘æ§å»ºè®®**&quot;">â€‹</a></h2><ol><li><p><strong>Nginx çŠ¶æ€æ¨¡å—</strong>ï¼š</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /nginx_status </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    stub_status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> on;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    allow </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.0.0.0/24;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    deny </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>å…³é”®æŒ‡æ ‡</strong>ï¼š</p><ul><li>è¯·æ±‚å¤„ç†é€Ÿç‡ï¼ˆRequests/secï¼‰</li><li>åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´</li><li>æ´»è·ƒè¿æ¥æ•°</li></ul></li><li><p><strong>æ—¥å¿—åˆ†æ</strong>ï¼š</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">log_format </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">upstream_log </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remote_addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> - $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">upstream_addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> - $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">upstream_response_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h2 id="_7-å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ" tabindex="-1"><strong>7. å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ</strong> <a class="header-anchor" href="#_7-å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ" aria-label="Permalink to &quot;**7. å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ**&quot;">â€‹</a></h2><p><strong>é—®é¢˜ 1ï¼šä¼šè¯ä¸ä¸€è‡´</strong><br> ğŸ‘‰ æ–¹æ¡ˆï¼šä½¿ç”¨<code>ip_hash</code>æˆ–å¼•å…¥ Redis é›†ä¸­å¼ä¼šè¯å­˜å‚¨</p><p><strong>é—®é¢˜ 2ï¼šæŸå°æœåŠ¡å™¨è¿‡è½½</strong><br> ğŸ‘‰ æ–¹æ¡ˆï¼šè°ƒæ•´æƒé‡æˆ–å¯ç”¨<code>least_conn</code></p><p><strong>é—®é¢˜ 3ï¼šå¥åº·æ£€æŸ¥ä¸çµæ•</strong><br> ğŸ‘‰ æ–¹æ¡ˆï¼šå‡å°<code>fail_timeout</code>å€¼ï¼ˆå¦‚æ”¹ä¸º 10sï¼‰</p><p><strong>é—®é¢˜ 4ï¼šDNS ç¼“å­˜é—®é¢˜</strong><br> ğŸ‘‰ æ–¹æ¡ˆï¼šåœ¨ upstream ä¸­ç›´æ¥ä½¿ç”¨ IP åœ°å€</p>`,56))])}const F=n(d,[["render",g]]);export{m as __pageData,F as default};
