import{_ as A,C as l,c as B,o as r,j as t,G as o,a2 as i,b as g,a as e,w as n,a7 as h}from"./chunks/framework.0gGui_5R.js";const D=JSON.parse('{"title":"共享单车的扫码开锁逻辑","description":"","frontmatter":{},"headers":[],"relativePath":"column/ProblemNotes/日常笔记/共享单车的扫码逻辑.md","filePath":"column/ProblemNotes/日常笔记/共享单车的扫码逻辑.md","lastUpdated":1763362911000}'),d={name:"column/ProblemNotes/日常笔记/共享单车的扫码逻辑.md"};function u(p,a,c,_,C,m){const s=l("ArticleMetadata"),E=l("Mermaid");return r(),B("div",null,[a[1]||(a[1]=t("h1",{id:"共享单车的扫码开锁逻辑",tabindex:"-1"},[e("共享单车的扫码开锁逻辑 "),t("a",{class:"header-anchor",href:"#共享单车的扫码开锁逻辑","aria-label":'Permalink to "共享单车的扫码开锁逻辑"'},"​")],-1)),o(s),a[2]||(a[2]=i('<nav class="table-of-contents"><ul><li><a href="#整体架构图-逻辑层面">整体架构图（逻辑层面）</a></li><li><a href="#详细步骤分解">详细步骤分解</a></li><li><a href="#技术要点与关键问题">技术要点与关键问题</a></li><li><a href="#总结">总结</a></li></ul></nav><p>共享单车的“扫码开锁”逻辑。这背后是一套典型的物联网应用，涉及移动端、云端和单车硬件之间的协同工作。</p><p>我们可以将整个扫码开锁的逻辑分为以下几个核心步骤：</p><h3 id="整体架构图-逻辑层面" tabindex="-1">整体架构图（逻辑层面） <a class="header-anchor" href="#整体架构图-逻辑层面" aria-label="Permalink to &quot;整体架构图（逻辑层面）&quot;">​</a></h3>',4)),(r(),g(h,null,{default:n(()=>[o(E,{id:"mermaid-15",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5B%E7%94%A8%E6%88%B7%E6%89%8B%E6%9C%BA%20App%5D%20--%3E%20B%5B%E5%85%B1%E4%BA%AB%E5%8D%95%E8%BD%A6%E4%BA%8C%E7%BB%B4%E7%A0%81%2F%E7%BC%96%E5%8F%B7%5D%3B%0A%20%20%20%20B%20--%3E%20C%5BApp%20%E5%90%91%E4%BA%91%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%91%E9%80%81%E5%BC%80%E9%94%81%E8%AF%B7%E6%B1%82%5D%3B%0A%20%20%20%20C%20--%3E%20D%7B%E4%BA%91%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%9B%E8%A1%8C%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E6%A0%A1%E9%AA%8C%7D%3B%0A%20%20%20%20D%20--%20%E6%A0%A1%E9%AA%8C%E9%80%9A%E8%BF%87%20--%3E%20E%5B%E4%BA%91%E7%AB%AF%E5%90%91%E5%8D%95%E8%BD%A6%E8%BD%A6%E9%94%81%E5%8F%91%E9%80%81%E5%BC%80%E9%94%81%E6%8C%87%E4%BB%A4%5D%3B%0A%20%20%20%20D%20--%20%E6%A0%A1%E9%AA%8C%E5%A4%B1%E8%B4%A5%20--%3E%20F%5B%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%3Cbr%3E%E5%A6%82%EF%BC%9A%20%E8%B4%A6%E6%88%B7%E6%AC%A0%E8%B4%B9%EF%BC%8C%20%E5%8D%95%E8%BD%A6%E6%95%85%E9%9A%9C%5D%3B%0A%20%20%20%20E%20--%3E%20G%5B%E5%8D%95%E8%BD%A6%E9%94%81%E7%9A%84%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9D%97%3Cbr%3E2G%2F4G%2FNB-IoT%5D%3B%0A%20%20%20%20G%20--%3E%20H%5B%E8%BD%A6%E9%94%81%E6%8E%A7%E5%88%B6%E5%99%A8%E6%89%A7%E8%A1%8C%E5%BC%80%E9%94%81%5D%3B%0A%20%20%20%20H%20--%3E%20I%5B%E6%9C%BA%E6%A2%B0%E9%94%81%E5%BC%B9%E5%BC%80%2F%E7%94%B5%E6%9C%BA%E5%8A%A8%E4%BD%9C%5D%3B%0A%20%20%20%20I%20--%3E%20J%5BApp%E6%98%BE%E7%A4%BA%E2%80%9C%E5%BC%80%E9%94%81%E6%88%90%E5%8A%9F%E2%80%9D%5D%3B%0A%20%20%20%20J%20--%3E%20K%5B%E5%BC%80%E5%A7%8B%E8%AE%A1%E8%B4%B9%5D%3B%0A"})]),fallback:n(()=>[...a[0]||(a[0]=[e(" Loading... ",-1)])]),_:1})),a[3]||(a[3]=i('<h3 id="详细步骤分解" tabindex="-1">详细步骤分解 <a class="header-anchor" href="#详细步骤分解" aria-label="Permalink to &quot;详细步骤分解&quot;">​</a></h3><h4 id="第-1-步-扫描二维码" tabindex="-1">第 1 步：扫描二维码 <a class="header-anchor" href="#第-1-步-扫描二维码" aria-label="Permalink to &quot;第 1 步：扫描二维码&quot;">​</a></h4><ul><li><strong>二维码里有什么？</strong><ul><li>你扫描的二维码并不直接包含开锁指令，它本质上是一个<code>身份证</code>。</li><li>它通常编码了一串<strong>唯一的数字编号</strong>，这个编号与云平台数据库中这辆单车的身份信息是绑定的。</li><li>可能包含的信息有：<strong>单车 ID、车辆型号、所属区域</strong>等元数据。</li></ul></li></ul><h4 id="第-2-步-app-向云端发送请求" tabindex="-1">第 2 步：App 向云端发送请求 <a class="header-anchor" href="#第-2-步-app-向云端发送请求" aria-label="Permalink to &quot;第 2 步：App 向云端发送请求&quot;">​</a></h4><ul><li>手机 App 在识别出二维码中的单车编号后，会立即组装一个“开锁请求”数据包，并通过移动网络（4G/5G/Wi-Fi）发送到共享单车公司的云端服务器。</li><li>这个数据包通常包含： <ul><li><strong>单车编号</strong>（从二维码获取）</li><li><strong>用户身份标识</strong>（你的用户 ID 或 Token）</li><li><strong>地理位置信息</strong>（确保你就在车旁边）</li><li><strong>时间戳</strong></li></ul></li></ul><h4 id="第-3-步-云端服务器的业务逻辑校验-核心环节" tabindex="-1">第 3 步：云端服务器的业务逻辑校验（核心环节） <a class="header-anchor" href="#第-3-步-云端服务器的业务逻辑校验-核心环节" aria-label="Permalink to &quot;第 3 步：云端服务器的业务逻辑校验（核心环节）&quot;">​</a></h4><p>这是整个流程中最关键的一步，云端服务器在收到请求后，会进行一系列复杂的校验，以确保业务的合法性和安全性：</p><ol><li><strong>用户身份认证</strong>：验证你的账号是否有效、已登录。</li><li><strong>支付状态检查</strong>：检查你的账户余额是否充足、是否已缴纳押金（如果需要）、是否有未支付的订单。</li><li><strong>单车状态检查</strong>：在数据库中查询这辆单车： <ul><li>是否是<strong>可用的状态</strong>（非故障、非报修、非已骑行中）。</li><li>是否处于<strong>合法的运营区域</strong>。</li></ul></li><li><strong>风控规则检查</strong>： <ul><li>用户行为是否异常（例如，短时间内频繁开锁关锁）。</li><li>地理位置是否匹配（防止远程开锁）。</li></ul></li><li><strong>生成骑行订单</strong>：如果所有校验都通过，云端会在数据库中为你创建一条新的<strong>骑行订单</strong>，状态为“进行中”，并记录开始时间。</li></ol><h4 id="第-4-步-云端向单车车锁发送开锁指令" tabindex="-1">第 4 步：云端向单车车锁发送开锁指令 <a class="header-anchor" href="#第-4-步-云端向单车车锁发送开锁指令" aria-label="Permalink to &quot;第 4 步：云端向单车车锁发送开锁指令&quot;">​</a></h4><ul><li>校验通过后，云端服务器会通过移动网络（通常是 2G/4G Cat.1 或 NB-IoT 这类低功耗广域物联网技术）找到对应的单车。</li><li>云端向单车内置的<strong>通信模块（MCU）</strong> 发送“开锁指令”。</li><li>这个指令通常是加密的，以防止被恶意截获和破解。</li></ul><h4 id="第-5-步-单车执行开锁" tabindex="-1">第 5 步：单车执行开锁 <a class="header-anchor" href="#第-5-步-单车执行开锁" aria-label="Permalink to &quot;第 5 步：单车执行开锁&quot;">​</a></h4><ul><li>单车上的通信模块收到云端指令后，会将其传递给<strong>主控制器</strong>。</li><li>主控制器（一块简单的单片机）会驱动<strong>电机或电磁锁</strong>的电路，执行物理开锁动作。 <ul><li><strong>马蹄锁</strong>：电机转动，带动锁舌收回，“咔哒”一声锁就开了。</li><li><strong>电子集成锁</strong>：直接控制锁体内的电机解锁。</li></ul></li></ul><h4 id="第-6-步-确认开锁与开始计费" tabindex="-1">第 6 步：确认开锁与开始计费 <a class="header-anchor" href="#第-6-步-确认开锁与开始计费" aria-label="Permalink to &quot;第 6 步：确认开锁与开始计费&quot;">​</a></h4><ul><li>车锁打开后，单车上的传感器（如振动传感器、锁舌状态传感器）会检测到状态变化。</li><li>单车会<strong>主动上报“开锁成功”的信号</strong>给云端服务器。</li><li>云端服务器收到确认后，立即向你的手机 App 发送“开锁成功”的通知，并<strong>正式开始计费</strong>。</li></ul><h3 id="技术要点与关键问题" tabindex="-1">技术要点与关键问题 <a class="header-anchor" href="#技术要点与关键问题" aria-label="Permalink to &quot;技术要点与关键问题&quot;">​</a></h3><h4 id="_1-如果网络信号不好怎么办" tabindex="-1">1. 如果网络信号不好怎么办？ <a class="header-anchor" href="#_1-如果网络信号不好怎么办" aria-label="Permalink to &quot;1. 如果网络信号不好怎么办？&quot;">​</a></h4><p>这是一个非常常见的问题，共享单车的设计考虑了弱网或无网环境：</p><ul><li><strong>“伪开锁”流程</strong>：你的开锁请求到达云端并校验通过后，即使云端无法立即将指令下发给单车（单车所在位置信号差），App 也可能先显示“开锁中”或“开锁成功”。这是因为云端<strong>单方面相信了开锁会成功</strong>，并开始了计费。实际上，云端会<strong>持续重试</strong>发送开锁指令，直到单车在信号恢复后收到为止。</li><li><strong>单车的离线能力</strong>：部分单车设计有简单的离线逻辑，比如收到一个特定的“一次性密码”也能开锁，但这较少见。主流方案还是依赖网络。</li></ul><h4 id="_2-二维码被损坏或篡改怎么办" tabindex="-1">2. 二维码被损坏或篡改怎么办？ <a class="header-anchor" href="#_2-二维码被损坏或篡改怎么办" aria-label="Permalink to &quot;2. 二维码被损坏或篡改怎么办？&quot;">​</a></h4><ul><li><strong>手动输入编号</strong>：所有单车的二维码旁边，都有一串<strong>物理编号</strong>。如果二维码无法扫描，你可以在 App 内手动输入这串数字，后续流程完全一样。</li><li><strong>防篡改措施</strong>：二维码本身没有防篡改功能，但恶意粘贴其他二维码属于“物理攻击”，需要通过运营（巡逻、举报）和法律手段来解决。</li></ul><h4 id="_3-通信技术" tabindex="-1">3. 通信技术 <a class="header-anchor" href="#_3-通信技术" aria-label="Permalink to &quot;3. 通信技术&quot;">​</a></h4><ul><li>早期主要使用<strong>2G</strong>网络。</li><li>现在主流是<strong>NB-IoT</strong>和<strong>4G Cat.1</strong>。它们具有<strong>低功耗、广覆盖、成本低</strong>的特点，非常适合共享单车这种需要长时间待机、数据量极小的物联网设备。</li></ul><h4 id="_4-安全性与功耗" tabindex="-1">4. 安全性与功耗 <a class="header-anchor" href="#_4-安全性与功耗" aria-label="Permalink to &quot;4. 安全性与功耗&quot;">​</a></h4><ul><li><strong>安全性</strong>：指令传输全程加密，防止重放攻击和指令伪造。</li><li><strong>功耗</strong>：单车车锁的绝大部分时间处于<strong>深度睡眠状态</strong>，只有收到“唤醒”信号（如云端开锁指令、或用户手动关锁）时才会全功率工作，以此保证长达数月的续航。</li></ul><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>共享单车的扫码逻辑，本质上是一个 <strong>“云端决策，单车执行”</strong> 的物联网控制模型。手机 App 只是一个发起请求和显示结果的交互界面，所有核心的业务逻辑（身份、支付、风控）都在云端完成，单车则是一个受控的、联网的简单执行终端。这种架构保证了系统的集中管理、高可靠性和可扩展性。</p>',26))])}const f=A(d,[["render",u]]);export{D as __pageData,f as default};
