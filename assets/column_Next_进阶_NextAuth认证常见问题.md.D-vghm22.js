import{_ as n,C as e,c as l,o as t,j as i,G as h,aQ as p,a as k}from"./chunks/framework.DEi4YP2n.js";const r="/assets/next-auth-6.Dk0BxvmN.png",o="/assets/next-auth-7.CwtZBZiu.png",m=JSON.parse('{"title":"NextAuth è®¤è¯å¸¸è§é—®é¢˜","description":"","frontmatter":{},"headers":[],"relativePath":"column/Next/è¿›é˜¶/NextAuthè®¤è¯å¸¸è§é—®é¢˜.md","filePath":"column/Next/è¿›é˜¶/NextAuthè®¤è¯å¸¸è§é—®é¢˜.md","lastUpdated":1758877920000}'),d={name:"column/Next/è¿›é˜¶/NextAuthè®¤è¯å¸¸è§é—®é¢˜.md"};function g(c,s,E,u,y,b){const a=e("ArticleMetadata");return t(),l("div",null,[s[0]||(s[0]=i("h1",{id:"nextauth-è®¤è¯å¸¸è§é—®é¢˜",tabindex:"-1"},[k("NextAuth è®¤è¯å¸¸è§é—®é¢˜ "),i("a",{class:"header-anchor",href:"#nextauth-è®¤è¯å¸¸è§é—®é¢˜","aria-label":'Permalink to "NextAuth è®¤è¯å¸¸è§é—®é¢˜"'},"â€‹")],-1)),h(a),s[1]||(s[1]=p(`<nav class="table-of-contents"><ul><li><a href="#_1-ç™»å½•æˆåŠŸå-token-session-çš„ç”Ÿæˆå’Œå­˜å‚¨">1. ç™»å½•æˆåŠŸåï¼Œtoken/session çš„ç”Ÿæˆå’Œå­˜å‚¨</a><ul><li><a href="#_1-1-ç”Ÿæˆè¿‡ç¨‹">1.1 ç”Ÿæˆè¿‡ç¨‹</a></li><li><a href="#_1-2-å­˜æ”¾ä½ç½®">1.2 å­˜æ”¾ä½ç½®</a></li><li><a href="#_1-3-æœ‰æ•ˆæœŸ">1.3 æœ‰æ•ˆæœŸ</a></li></ul></li><li><a href="#_2-ä¸ºä»€ä¹ˆ-nextauth-çš„-token-å­˜åœ¨-cookie-è€Œä¸æ˜¯-localstorage-sessionstorage">2. ä¸ºä»€ä¹ˆ NextAuth çš„ token å­˜åœ¨ Cookieï¼Œè€Œä¸æ˜¯ localStorage/sessionStorageï¼Ÿ</a><ul><li><a href="#_2-1-åŸå› ">2.1 åŸå› </a></li><li><a href="#_2-2-å¯ä»¥æ”¹å—">2.2 å¯ä»¥æ”¹å—ï¼Ÿ</a></li></ul></li><li><a href="#_3-æ¯æ¬¡è°ƒç”¨ä¸šåŠ¡æ¥å£æ—¶-éƒ½ä¼šæºå¸¦-nextauth-çš„-token-å—">3. æ¯æ¬¡è°ƒç”¨ä¸šåŠ¡æ¥å£æ—¶ï¼Œéƒ½ä¼šæºå¸¦ NextAuth çš„ token å—ï¼Ÿ</a></li><li><a href="#_4-nextauth-çš„-token-å’Œæ—¥å¸¸çš„-jwt-token-ä¸æ˜¯é‡å¤äº†å—">4. NextAuth çš„ token å’Œæ—¥å¸¸çš„ JWT tokenï¼Œä¸æ˜¯é‡å¤äº†å—ï¼Ÿ</a><ul><li><a href="#_4-1-åŒºåˆ«">4.1 åŒºåˆ«ï¼š</a></li><li><a href="#_4-2-ä¸ºä»€ä¹ˆçœ‹èµ·æ¥é‡å¤">4.2 ä¸ºä»€ä¹ˆçœ‹èµ·æ¥é‡å¤ï¼Ÿ</a></li></ul></li><li><a href="#ğŸš€-æ€»ç»“">ğŸš€ æ€»ç»“</a></li><li><a href="#_5-nextauth-session-è¿‡æœŸ-maxage-åæ€ä¹ˆåŠ-æ€ä¹ˆé‡æ–°è®¤è¯">5 NextAuth session è¿‡æœŸï¼ˆmaxAgeï¼‰åæ€ä¹ˆåŠï¼Ÿæ€ä¹ˆé‡æ–°è®¤è¯ï¼Ÿ</a><ul><li><a href="#_5-1-æœºåˆ¶">5.1 æœºåˆ¶</a></li><li><a href="#_5-2-è¿‡æœŸåæ€ä¹ˆåŠ">5.2 è¿‡æœŸåæ€ä¹ˆåŠï¼Ÿ</a></li></ul></li><li><a href="#_6-æµè§ˆå™¨ä¸Šçš„-cookie-ä¸ºä»€ä¹ˆæœ‰å¥½å‡ ä¸ª">6 æµè§ˆå™¨ä¸Šçš„ Cookieï¼šä¸ºä»€ä¹ˆæœ‰å¥½å‡ ä¸ªï¼Ÿ</a><ul><li><a href="#_6-1-ğŸª-next-auth-session-token">6.1 ğŸª next-auth.session-token</a></li><li><a href="#_6-2-ğŸª-next-auth-csrf-token">6.2 ğŸª next-auth.csrf-token</a></li><li><a href="#_6-3-ğŸª-next-auth-callback-url">6.3 ğŸª next-auth.callback-url</a></li></ul></li><li><a href="#_7-nextauth-session-è¿‡æœŸå¤„ç†æ–¹æ¡ˆ">7 NextAuth Session è¿‡æœŸå¤„ç†æ–¹æ¡ˆ</a><ul><li><a href="#_7-1-å®¢æˆ·ç«¯æ£€æµ‹-usesession-hook">7.1 å®¢æˆ·ç«¯æ£€æµ‹ï¼ˆuseSession Hookï¼‰</a></li><li><a href="#_7-2-æœåŠ¡ç«¯æ£€æµ‹-getserversession">7.2 æœåŠ¡ç«¯æ£€æµ‹ï¼ˆgetServerSessionï¼‰</a></li><li><a href="#_7-3-api-æ¥å£ä¿æŠ¤">7.3 API æ¥å£ä¿æŠ¤</a></li><li><a href="#_7-4-ç”¨æˆ·ä½“éªŒä¼˜åŒ–-è‡ªåŠ¨ç»­æœŸ">7.4 ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼šè‡ªåŠ¨ç»­æœŸ</a></li></ul></li></ul></nav><p><a href="/column/Next/è¿›é˜¶/NextAuthè®¤è¯.html"><strong>ä¹¦æ¥ä¸Šæ–‡ï¼ˆNextAuth è®¤è¯ï¼‰</strong></a></p><div class="tip custom-block"><p class="custom-block-title">æç¤º</p><p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•åœ¨ <code>Next.js</code>ä¸­ä½¿ç”¨<code>NextAuth</code>è®¤è¯ä¸­å¸¸è§çš„é—®é¢˜ï¼Œåˆ©äºå¯¹<code>NextAuth</code>çš„æ·±åˆ»ç†è§£ã€‚<br> è¿™å‡ ä¸ªå…¶å®éƒ½æ˜¯å¾ˆå¤šäººç¬¬ä¸€æ¬¡ç”¨ <strong>NextAuth.js</strong> ä¼šå›°æƒ‘çš„ç‚¹ã€‚</p></div><h2 id="_1-ç™»å½•æˆåŠŸå-token-session-çš„ç”Ÿæˆå’Œå­˜å‚¨" tabindex="-1">1. ç™»å½•æˆåŠŸåï¼Œtoken/session çš„ç”Ÿæˆå’Œå­˜å‚¨ <a class="header-anchor" href="#_1-ç™»å½•æˆåŠŸå-token-session-çš„ç”Ÿæˆå’Œå­˜å‚¨" aria-label="Permalink to &quot;1. ç™»å½•æˆåŠŸåï¼Œtoken/session çš„ç”Ÿæˆå’Œå­˜å‚¨&quot;">â€‹</a></h2><p>ç™»å½•æˆåŠŸåï¼Œtoken æ˜¯é€šè¿‡<code>NextAuth</code>çš„<code>signIn</code>æ–¹æ³•ç”Ÿæˆçš„ï¼Œé»˜è®¤ä¼šå°† token å­˜æ”¾åœ¨<code>cookie</code>ä¸­ï¼Œæ—¶é—´æ˜¯<code>30</code>å¤©(å¯é…ç½®)ã€‚</p><p><code>NextAuth</code> çš„å·¥ä½œæµç¨‹å’Œ <code>JWT</code> æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œé»˜è®¤æ˜¯ <strong>åŸºäº Cookie/Session</strong>ã€‚</p><h3 id="_1-1-ç”Ÿæˆè¿‡ç¨‹" tabindex="-1">1.1 ç”Ÿæˆè¿‡ç¨‹ <a class="header-anchor" href="#_1-1-ç”Ÿæˆè¿‡ç¨‹" aria-label="Permalink to &quot;1.1 ç”Ÿæˆè¿‡ç¨‹&quot;">â€‹</a></h3><ul><li><p>ç”¨æˆ·åœ¨ <code>/api/auth/[...nextauth]</code> ç”¨ <code>CredentialsProvider</code> ç™»å½•æˆåŠŸåï¼ŒNextAuth ä¼šç”Ÿæˆä¸€ä¸ª <strong>Session å¯¹è±¡</strong>ï¼š</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Alice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;alice@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;expires&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-09-26T09:00:00.000Z&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p>åŒæ—¶ï¼Œå®ƒä¼šåœ¨ <strong>æµè§ˆå™¨ Cookie</strong> ä¸­å­˜å‚¨ä¸€ä¸ª <strong>åŠ å¯†çš„ session token</strong>ï¼Œåå­—æ˜¯ï¼š</p><ul><li><code>next-auth.session-token</code> ï¼ˆç”Ÿäº§ç¯å¢ƒ HTTPS ä¸‹ï¼‰</li><li><code>__Secure-next-auth.session-token</code> ï¼ˆå®‰å…¨æ¨¡å¼ä¸‹ï¼‰</li></ul></li></ul><h3 id="_1-2-å­˜æ”¾ä½ç½®" tabindex="-1">1.2 å­˜æ”¾ä½ç½® <a class="header-anchor" href="#_1-2-å­˜æ”¾ä½ç½®" aria-label="Permalink to &quot;1.2 å­˜æ”¾ä½ç½®&quot;">â€‹</a></h3><ul><li>ä¸æ˜¯ <code>localStorage</code> æˆ– <code>sessionStorage</code>ï¼Œè€Œæ˜¯ <strong>æµè§ˆå™¨ Cookie</strong>ã€‚</li><li>ä½ å¯ä»¥åœ¨æµè§ˆå™¨ â†’ å¼€å‘è€…å·¥å…· â†’ åº”ç”¨ (Application) â†’ Cookie â†’ æ‰¾åˆ°ã€‚</li></ul><p><strong>å¦‚å›¾ï¼š</strong></p><p><img src="`+r+`" alt="next-auth-6.png" loading="lazy"></p><h3 id="_1-3-æœ‰æ•ˆæœŸ" tabindex="-1">1.3 æœ‰æ•ˆæœŸ <a class="header-anchor" href="#_1-3-æœ‰æ•ˆæœŸ" aria-label="Permalink to &quot;1.3 æœ‰æ•ˆæœŸ&quot;">â€‹</a></h3><ul><li>é»˜è®¤ <strong>30 å¤©</strong>ï¼Œå¹¶ä¸”æ¯æ¬¡è¯·æ±‚ä¼š <strong>åˆ·æ–°è¿‡æœŸæ—¶é—´</strong>ã€‚</li><li>ä½ å¯ä»¥åœ¨ <code>authOptions.session</code> é‡Œé…ç½®ï¼š</li></ul><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">session</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  strategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jwt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æˆ– &quot;database&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  maxAge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 7å¤©</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  updateAge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¯24å°æ—¶åˆ·æ–°ä¸€æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><strong>maxAge</strong>: session è¿‡æœŸæ—¶é—´ï¼ˆç§’æ•°ï¼‰</li><li><strong>updateAge</strong>: è®¿é—®åå¤šä¹…åˆ·æ–° Cookie é‡Œçš„è¿‡æœŸæ—¶é—´</li></ul><h2 id="_2-ä¸ºä»€ä¹ˆ-nextauth-çš„-token-å­˜åœ¨-cookie-è€Œä¸æ˜¯-localstorage-sessionstorage" tabindex="-1">2. ä¸ºä»€ä¹ˆ NextAuth çš„ token å­˜åœ¨ Cookieï¼Œè€Œä¸æ˜¯ localStorage/sessionStorageï¼Ÿ <a class="header-anchor" href="#_2-ä¸ºä»€ä¹ˆ-nextauth-çš„-token-å­˜åœ¨-cookie-è€Œä¸æ˜¯-localstorage-sessionstorage" aria-label="Permalink to &quot;2. ä¸ºä»€ä¹ˆ NextAuth çš„ token å­˜åœ¨ Cookieï¼Œè€Œä¸æ˜¯ localStorage/sessionStorageï¼Ÿ&quot;">â€‹</a></h2><h3 id="_2-1-åŸå› " tabindex="-1">2.1 åŸå›  <a class="header-anchor" href="#_2-1-åŸå› " aria-label="Permalink to &quot;2.1 åŸå› &quot;">â€‹</a></h3><ul><li><p><strong>å®‰å…¨æ€§</strong></p><ul><li>Cookie å¯ä»¥è®¾ç½®ä¸º <code>HttpOnly</code>ï¼Œè¿™æ ·å‰ç«¯ JS è¯»ä¸åˆ°ï¼Œé˜²æ­¢ <strong>XSS çªƒå– token</strong>ã€‚</li><li>è€Œå¦‚æœæ”¾åœ¨ <code>localStorage</code> æˆ– <code>sessionStorage</code>ï¼Œåªè¦é¡µé¢æœ‰ä¸ª XSS æ¼æ´ï¼Œæ”»å‡»è€…å°±èƒ½ç›´æ¥æ‹¿åˆ° tokenã€‚</li></ul></li><li><p><strong>è‡ªåŠ¨æºå¸¦</strong></p><ul><li>Cookie æ˜¯æµè§ˆå™¨åœ¨è¯·æ±‚åŒæºæ¥å£æ—¶è‡ªåŠ¨é™„å¸¦çš„ï¼Œä¸éœ€è¦ä½ æ‰‹åŠ¨åœ¨ <code>fetch</code> æˆ– <code>axios</code> é‡ŒåŠ  <code>Authorization</code> headerã€‚</li><li>è¿™æ ·å°±èƒ½ä¿è¯å‰åç«¯å¤©ç„¶å¯¹æ¥ï¼Œä¸ç”¨æ¯ä¸ªè¯·æ±‚éƒ½å†™ token æ³¨å…¥é€»è¾‘ã€‚</li></ul></li><li><p><strong>è·¨å­åŸŸæ”¯æŒ</strong></p><ul><li>è®¾ç½® Cookie çš„ <code>domain=.example.com</code> åï¼Œ<code>api.example.com</code> å’Œ <code>app.example.com</code> éƒ½èƒ½å…±äº«ç™»å½•çŠ¶æ€ã€‚</li><li><code>localStorage</code> åªèƒ½åœ¨åŒä¸€ä¸ªåŸŸåä¸‹å…±äº«ã€‚</li></ul></li></ul><h3 id="_2-2-å¯ä»¥æ”¹å—" tabindex="-1">2.2 å¯ä»¥æ”¹å—ï¼Ÿ <a class="header-anchor" href="#_2-2-å¯ä»¥æ”¹å—" aria-label="Permalink to &quot;2.2 å¯ä»¥æ”¹å—ï¼Ÿ&quot;">â€‹</a></h3><p>ç†è®ºä¸Šå¯ä»¥è®© <code>NextAuth</code> ä½¿ç”¨ <code>jwt</code> æ¨¡å¼ï¼Œç„¶åä½ æ‰‹åŠ¨å­˜åˆ° <code>localStorage</code>ï¼Œä½†æ˜¯ï¼š</p><ul><li>ä¸æ¨èï¼ˆå®‰å…¨æ€§å¤§å¹…é™ä½ï¼Œå®¹æ˜“è¢« XSS æ”»å‡»ï¼‰ã€‚</li><li><code>NextAuth</code> çš„è®¾è®¡åˆè¡·å°±æ˜¯ï¼š<strong>é»˜è®¤ç”¨ Cookie æ¥ç»´æŠ¤ä¼šè¯ (session)</strong>ï¼Œå°½é‡å‡å°‘å¼€å‘è€…æ‰‹å·¥å¤„ç†ã€‚</li></ul><h2 id="_3-æ¯æ¬¡è°ƒç”¨ä¸šåŠ¡æ¥å£æ—¶-éƒ½ä¼šæºå¸¦-nextauth-çš„-token-å—" tabindex="-1">3. æ¯æ¬¡è°ƒç”¨ä¸šåŠ¡æ¥å£æ—¶ï¼Œéƒ½ä¼šæºå¸¦ NextAuth çš„ token å—ï¼Ÿ <a class="header-anchor" href="#_3-æ¯æ¬¡è°ƒç”¨ä¸šåŠ¡æ¥å£æ—¶-éƒ½ä¼šæºå¸¦-nextauth-çš„-token-å—" aria-label="Permalink to &quot;3. æ¯æ¬¡è°ƒç”¨ä¸šåŠ¡æ¥å£æ—¶ï¼Œéƒ½ä¼šæºå¸¦ NextAuth çš„ token å—ï¼Ÿ&quot;">â€‹</a></h2><p>âœ… <strong>æ˜¯çš„</strong> â€”â€” åªè¦æ˜¯ <strong>åŒæºè¯·æ±‚</strong>ï¼ˆæ¯”å¦‚ <code>/api/xxx</code>ï¼‰ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚å¤´é‡Œå¸¦ä¸Šï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Cookie: next-auth.session-token=xxxx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>ğŸ‘‰ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ <code>/api/protected/route.ts</code> é‡Œä½ åªéœ€è¦å†™ï¼š</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> session</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getServerSession</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authOptions);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>å°±èƒ½ç›´æ¥æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå› ä¸º NextAuth ä¼šè§£å¯† Cookieï¼Œæ‰¾åˆ°å¯¹åº”çš„ sessionã€‚</p><p>å¦‚æœä½ ç”¨çš„æ˜¯ <strong>è·¨åŸŸ</strong>ï¼ˆæ¯”å¦‚å‰ç«¯åœ¨ <code>http://localhost:3000</code>ï¼ŒAPI åœ¨ <code>http://localhost:4000</code>ï¼‰ï¼Œé‚£å°±è¦è®¾ç½®ï¼š</p><ul><li><code>credentials: &quot;include&quot;</code>ï¼ˆfetch/axiosï¼‰</li><li>åç«¯å…è®¸ <code>Access-Control-Allow-Credentials: true</code></li></ul><h2 id="_4-nextauth-çš„-token-å’Œæ—¥å¸¸çš„-jwt-token-ä¸æ˜¯é‡å¤äº†å—" tabindex="-1">4. NextAuth çš„ token å’Œæ—¥å¸¸çš„ JWT tokenï¼Œä¸æ˜¯é‡å¤äº†å—ï¼Ÿ <a class="header-anchor" href="#_4-nextauth-çš„-token-å’Œæ—¥å¸¸çš„-jwt-token-ä¸æ˜¯é‡å¤äº†å—" aria-label="Permalink to &quot;4. NextAuth çš„ token å’Œæ—¥å¸¸çš„ JWT tokenï¼Œä¸æ˜¯é‡å¤äº†å—ï¼Ÿ&quot;">â€‹</a></h2><p>è¿™æ˜¯ä¸€ä¸ªå…³é”®ç‚¹ï¼Œå¾ˆå¤šäººç¬¬ä¸€æ¬¡æ¥è§¦ä¼šè¯¯ä¼šã€‚</p><h3 id="_4-1-åŒºåˆ«" tabindex="-1">4.1 åŒºåˆ«ï¼š <a class="header-anchor" href="#_4-1-åŒºåˆ«" aria-label="Permalink to &quot;4.1 åŒºåˆ«ï¼š&quot;">â€‹</a></h3><ol><li><p><strong>ä¼ ç»Ÿ JWT é‰´æƒ</strong>ï¼ˆè‡ªå·±å®ç°æ—¶ï¼‰ï¼š</p><ul><li>ç™»å½•æˆåŠŸ â†’ åç«¯è¿”å›ä¸€ä¸ª JWT â†’ å‰ç«¯å­˜ <code>localStorage</code> æˆ– Cookieã€‚</li><li>å‰ç«¯æ¯æ¬¡è¯·æ±‚æ—¶ â†’ æ‰‹åŠ¨åœ¨ <code>Authorization: Bearer xxx</code> é‡Œå¸¦ä¸Š JWTã€‚</li><li>åç«¯æ ¡éªŒ JWT â†’ æ”¾è¡Œã€‚</li></ul></li><li><p><strong>NextAuth çš„ session token</strong>ï¼š</p><ul><li>ç™»å½•æˆåŠŸ â†’ NextAuth è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŠ å¯†çš„ session tokenï¼Œæ”¾åœ¨ Cookieã€‚</li><li>å‰ç«¯è¯·æ±‚æ—¶ â†’ æµè§ˆå™¨è‡ªåŠ¨å¸¦ Cookieã€‚</li><li>NextAuth æ ¡éªŒ Cookie â†’ è·å– sessionã€‚</li></ul></li></ol><h3 id="_4-2-ä¸ºä»€ä¹ˆçœ‹èµ·æ¥é‡å¤" tabindex="-1">4.2 ä¸ºä»€ä¹ˆçœ‹èµ·æ¥é‡å¤ï¼Ÿ <a class="header-anchor" href="#_4-2-ä¸ºä»€ä¹ˆçœ‹èµ·æ¥é‡å¤" aria-label="Permalink to &quot;4.2 ä¸ºä»€ä¹ˆçœ‹èµ·æ¥é‡å¤ï¼Ÿ&quot;">â€‹</a></h3><ul><li><p>å¦‚æœä½ åªæ˜¯ã€Œå‰ç«¯ + è‡ªå·±å†™çš„åç«¯ APIã€ï¼Œé‚£ä¹ˆ <strong>ç¡®å®ç”¨ JWT å°±å¤Ÿäº†</strong>ï¼Œä¸éœ€è¦å†å¥—ä¸€å±‚ã€‚</p></li><li><p>ä½† NextAuth çš„ç›®æ ‡æ˜¯ï¼š</p><ul><li>å¼€ç®±å³ç”¨ï¼Œå°‘å†™é€»è¾‘ã€‚</li><li>æ”¯æŒå¤šç§ç™»å½•æ–¹å¼ï¼ˆGitHub / Google / Credentials / Email Link / SSOï¼‰ã€‚</li><li>ä¸ç”¨æ¯ä¸ªåœ°æ–¹éƒ½æ‰‹åŠ¨å†™ JWT æ ¡éªŒã€‚</li></ul></li></ul><blockquote><p>ä½ å¯ä»¥ç†è§£ä¸ºï¼š</p><ul><li><strong>JWT</strong>ï¼šè‡ªå·±å†™çš„ã€Œä½å±‚ APIã€ï¼Œçµæ´»ä½†è¦ç»´æŠ¤ã€‚</li><li><strong>NextAuth</strong>ï¼šä¸€ä¸ªã€Œé«˜å±‚å°è£…ã€ï¼Œé‡Œé¢ä¹Ÿå¯èƒ½ç”¨åˆ° JWTï¼Œä½†ä¸»è¦é  Cookie æ¥ç»´æŠ¤ç™»å½•æ€ã€‚</li></ul></blockquote><h2 id="ğŸš€-æ€»ç»“" tabindex="-1">ğŸš€ æ€»ç»“ <a class="header-anchor" href="#ğŸš€-æ€»ç»“" aria-label="Permalink to &quot;ğŸš€ æ€»ç»“&quot;">â€‹</a></h2><ol><li><p><strong>ä¸ºä»€ä¹ˆå­˜ Cookie</strong></p><ul><li>æ›´å®‰å…¨ (<code>HttpOnly</code>)</li><li>è‡ªåŠ¨æºå¸¦ï¼Œä¸ç”¨æ‰‹åŠ¨åŠ  token</li><li>æ”¯æŒè·¨å­åŸŸå…±äº«</li></ul></li><li><p><strong>è¯·æ±‚æ¥å£æ—¶</strong></p><ul><li>æµè§ˆå™¨è‡ªåŠ¨å¸¦ä¸Š <code>next-auth.session-token</code>ï¼ˆåŒæºè¯·æ±‚ï¼‰</li><li>è·¨åŸŸéœ€è¦ <code>credentials: include</code></li></ul></li><li><p><strong>å’Œ JWT çš„å…³ç³»</strong></p><ul><li><p>ä¸æ˜¯é‡å¤ï¼Œè€Œæ˜¯ä¸¤ç§æ€è·¯ï¼š</p><ul><li>JWT â†’ ä½ è‡ªå·±ç»´æŠ¤ tokenã€‚</li><li>NextAuth â†’ ä»£æ›¿ä½ ç®¡ç† sessionï¼Œç”¨ Cookie ä¿æŒçŠ¶æ€ã€‚</li></ul></li><li><p>å¦‚æœä½ çš„é¡¹ç›®åªéœ€è¦å‰åç«¯åˆ†ç¦» + JWTï¼Œå¯ä»¥ä¸ç”¨ NextAuthã€‚</p></li><li><p>å¦‚æœä½ éœ€è¦å¿«é€Ÿæ¥å…¥å¤šç§è®¤è¯æ–¹å¼ï¼Œæˆ–è€…ä¸æƒ³ç»´æŠ¤ JWT åˆ·æ–°é€»è¾‘ï¼Œç”¨ NextAuth æ›´æ–¹ä¾¿ã€‚</p></li></ul></li></ol><h2 id="_5-nextauth-session-è¿‡æœŸ-maxage-åæ€ä¹ˆåŠ-æ€ä¹ˆé‡æ–°è®¤è¯" tabindex="-1">5 NextAuth session è¿‡æœŸï¼ˆmaxAgeï¼‰åæ€ä¹ˆåŠï¼Ÿæ€ä¹ˆé‡æ–°è®¤è¯ï¼Ÿ <a class="header-anchor" href="#_5-nextauth-session-è¿‡æœŸ-maxage-åæ€ä¹ˆåŠ-æ€ä¹ˆé‡æ–°è®¤è¯" aria-label="Permalink to &quot;5 NextAuth session è¿‡æœŸï¼ˆmaxAgeï¼‰åæ€ä¹ˆåŠï¼Ÿæ€ä¹ˆé‡æ–°è®¤è¯ï¼Ÿ&quot;">â€‹</a></h2><h3 id="_5-1-æœºåˆ¶" tabindex="-1">5.1 æœºåˆ¶ <a class="header-anchor" href="#_5-1-æœºåˆ¶" aria-label="Permalink to &quot;5.1 æœºåˆ¶&quot;">â€‹</a></h3><ul><li><p>åœ¨ <code>authOptions.session</code> é‡Œä½ å¯ä»¥è®¾ç½®ï¼š</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">session</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  strategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jwt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æˆ– &quot;database&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  maxAge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸€å¤©ï¼ˆç§’ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  updateAge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¯24å°æ—¶åˆ·æ–°ä¸€æ¬¡ Cookie</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>maxAge</strong>ï¼šsession æœ€é•¿æœ‰æ•ˆæ—¶é—´ï¼ˆæ¯”å¦‚ 1 å¤©ï¼‰ã€‚</p></li><li><p><strong>updateAge</strong>ï¼šç”¨æˆ·åªè¦æœ‰è®¿é—®ï¼ˆæ¯”å¦‚æ‰“å¼€é¡µé¢ã€è°ƒç”¨ APIï¼‰ï¼ŒNextAuth å°±ä¼šè‡ªåŠ¨åˆ·æ–° Cookie çš„è¿‡æœŸæ—¶é—´ï¼Œå»¶é•¿æœ‰æ•ˆæœŸã€‚</p></li></ul><p>ğŸ‘‰ è¿™æ„å‘³ç€ï¼š</p><ul><li>å¦‚æœç”¨æˆ·<strong>æ¯å¤©è‡³å°‘è®¿é—®ä¸€æ¬¡</strong>ï¼Œç™»å½•çŠ¶æ€ä¼šä¸€ç›´ä¿æŒã€‚</li><li>å¦‚æœç”¨æˆ·<strong>ä¸€å¤©éƒ½æ²¡è®¿é—®</strong>ï¼Œsession å°±ä¼šè¿‡æœŸã€‚</li></ul><h3 id="_5-2-è¿‡æœŸåæ€ä¹ˆåŠ" tabindex="-1">5.2 è¿‡æœŸåæ€ä¹ˆåŠï¼Ÿ <a class="header-anchor" href="#_5-2-è¿‡æœŸåæ€ä¹ˆåŠ" aria-label="Permalink to &quot;5.2 è¿‡æœŸåæ€ä¹ˆåŠï¼Ÿ&quot;">â€‹</a></h3><ol><li><p>å¦‚æœ session è¿‡æœŸï¼ŒNextAuth çš„ <code>getServerSession</code> ä¼šè¿”å› <code>null</code>ã€‚</p></li><li><p>è¿™æ—¶ä½ è¦åšçš„å°±æ˜¯ï¼š</p><ul><li>é¡µé¢ï¼š<code>redirect(&quot;/auth/signin&quot;)</code> è·³è½¬ç™»å½•é¡µã€‚</li><li>APIï¼šè¿”å› <code>401 Unauthorized</code>ï¼Œå‰ç«¯æ•è·åè·³è½¬ç™»å½•é¡µã€‚</li></ul></li></ol><p>æ¢å¥è¯è¯´ï¼š<strong>è¿‡æœŸåå°±æ˜¯é‡æ–°ç™»å½•</strong>ï¼ŒNextAuth ä¸ä¼šåƒ OAuth é‚£æ ·è‡ªåŠ¨åˆ·æ–° tokenï¼ˆé™¤éä½ ç”¨çš„æ˜¯ Google/GitHub providerï¼Œè¿™ç§æƒ…å†µä¸‹ä¼šå†…ç½® refresh é€»è¾‘ï¼‰ã€‚</p><p>å¦‚æœä½ å¸Œæœ› â€œè‡ªåŠ¨ç»­æœŸâ€ï¼Œå¯ä»¥ï¼š</p><ul><li>è®¾ç½® <code>maxAge</code> å¤§ä¸€ç‚¹ï¼Œæ¯”å¦‚ <code>7 å¤©</code> æˆ– <code>30 å¤©</code>ã€‚</li><li>é…åˆ <code>updateAge</code>ï¼Œåªè¦ç”¨æˆ·æ´»è·ƒï¼Œå°±ä¸€ç›´ç»­å‘½ã€‚</li></ul><p><strong>æ€»ç»“ï¼ˆsession è¿‡æœŸæ€ä¹ˆåŠï¼‰</strong></p><ul><li><code>maxAge</code> æ§åˆ¶æœ€å¤§æœ‰æ•ˆæœŸï¼Œ<code>updateAge</code> æ§åˆ¶åˆ·æ–°æœºåˆ¶ã€‚</li><li>ç”¨æˆ·æ´»è·ƒ â†’ è‡ªåŠ¨ç»­å‘½ï¼›é•¿æ—¶é—´ä¸è®¿é—® â†’ session è¿‡æœŸï¼Œå¿…é¡»é‡æ–°ç™»å½•ã€‚</li></ul><h2 id="_6-æµè§ˆå™¨ä¸Šçš„-cookie-ä¸ºä»€ä¹ˆæœ‰å¥½å‡ ä¸ª" tabindex="-1">6 æµè§ˆå™¨ä¸Šçš„ Cookieï¼šä¸ºä»€ä¹ˆæœ‰å¥½å‡ ä¸ªï¼Ÿ <a class="header-anchor" href="#_6-æµè§ˆå™¨ä¸Šçš„-cookie-ä¸ºä»€ä¹ˆæœ‰å¥½å‡ ä¸ª" aria-label="Permalink to &quot;6 æµè§ˆå™¨ä¸Šçš„ Cookieï¼šä¸ºä»€ä¹ˆæœ‰å¥½å‡ ä¸ªï¼Ÿ&quot;">â€‹</a></h2><p>NextAuth ä¼šç”Ÿæˆ <strong>å¤šä¸ª Cookie</strong>ï¼Œæ¯ä¸ªè´Ÿè´£ä¸åŒåŠŸèƒ½ã€‚å¸¸è§çš„æœ‰ï¼š</p><p><img src="`+o+`" alt="next-auth-7.png" loading="lazy"></p><h3 id="_6-1-ğŸª-next-auth-session-token" tabindex="-1">6.1 ğŸª <code>next-auth.session-token</code> <a class="header-anchor" href="#_6-1-ğŸª-next-auth-session-token" aria-label="Permalink to &quot;6.1 ğŸª \`next-auth.session-token\`&quot;">â€‹</a></h3><ul><li>è¿™æ˜¯æœ€é‡è¦çš„ <strong>ç™»å½•æ€ Cookie</strong>ã€‚</li><li>å­˜å‚¨åŠ å¯†çš„ session ä¿¡æ¯ï¼Œåç«¯ç”¨å®ƒè¯†åˆ«ç”¨æˆ·ã€‚</li><li>è¿‡æœŸæ—¶é—´ = <code>session.maxAge</code>ã€‚</li><li>è®¾ç½®äº† <code>HttpOnly</code> å’Œ <code>Secure</code>ï¼ˆç”Ÿäº§ç¯å¢ƒä¸‹ï¼‰ï¼ŒJS ä¸èƒ½è¯»ã€‚</li></ul><hr><h3 id="_6-2-ğŸª-next-auth-csrf-token" tabindex="-1">6.2 ğŸª <code>next-auth.csrf-token</code> <a class="header-anchor" href="#_6-2-ğŸª-next-auth-csrf-token" aria-label="Permalink to &quot;6.2 ğŸª \`next-auth.csrf-token\`&quot;">â€‹</a></h3><ul><li>ç”¨äºé˜²æ­¢ <strong>CSRF æ”»å‡»</strong>ï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ã€‚</li><li>ä¸»è¦åœ¨ <strong>ç™»å½•è¡¨å•æäº¤</strong>æ—¶ç”¨ã€‚</li><li>å­˜åœ¨äºæµè§ˆå™¨ Cookieï¼Œä½†å‰ç«¯æäº¤æ—¶ NextAuth ä¼šå¯¹æ¯”æ ¡éªŒã€‚</li><li>è¿™ä¸ª cookie æœ¬èº«å®‰å…¨æ€§è¦æ±‚æ²¡é‚£ä¹ˆé«˜ï¼Œä½†ä»ç„¶æœ‰è¿‡æœŸæ—¶é—´ï¼ˆä¸€èˆ¬æ˜¯ 1 å¤©ï¼‰ã€‚</li></ul><hr><h3 id="_6-3-ğŸª-next-auth-callback-url" tabindex="-1">6.3 ğŸª <code>next-auth.callback-url</code> <a class="header-anchor" href="#_6-3-ğŸª-next-auth-callback-url" aria-label="Permalink to &quot;6.3 ğŸª \`next-auth.callback-url\`&quot;">â€‹</a></h3><ul><li>ç”¨æ¥ä¿å­˜ç™»å½•åçš„å›è·³åœ°å€ã€‚</li><li>æ¯”å¦‚ä½ è®¿é—® <code>/dashboard</code>ï¼Œè¢«é‡å®šå‘åˆ° <code>/auth/signin</code>ï¼Œç™»å½•æˆåŠŸåä¼šè‡ªåŠ¨å›åˆ° <code>/dashboard</code>ã€‚</li><li>è¿™ä¸ª cookie å°±æ˜¯å­˜å‚¨ <strong>ä½ åŸæ¥æƒ³å»çš„é¡µé¢ URL</strong>ã€‚</li><li>ä¸´æ—¶æ€§ cookieï¼Œç™»å½•å®ŒæˆååŸºæœ¬å°±æ²¡ç”¨äº†ã€‚</li></ul><p><strong>æ€»ç»“</strong></p><ul><li><code>next-auth.session-token</code> â†’ ç»´æŒç™»å½•æ€</li><li><code>next-auth.csrf-token</code> â†’ é˜²æ­¢ CSRF æ”»å‡»</li><li><code>next-auth.callback-url</code> â†’ ä¿å­˜å›è·³åœ°å€ï¼Œç™»å½•æˆåŠŸåé‡å®šå‘</li></ul><h2 id="_7-nextauth-session-è¿‡æœŸå¤„ç†æ–¹æ¡ˆ" tabindex="-1">7 NextAuth Session è¿‡æœŸå¤„ç†æ–¹æ¡ˆ <a class="header-anchor" href="#_7-nextauth-session-è¿‡æœŸå¤„ç†æ–¹æ¡ˆ" aria-label="Permalink to &quot;7 NextAuth Session è¿‡æœŸå¤„ç†æ–¹æ¡ˆ&quot;">â€‹</a></h2><p>ä¸‹é¢æ˜¯ä¸€ä»½ <strong>NextAuth.js Session è¿‡æœŸåè‡ªåŠ¨æ£€æµ‹ + é‡å®šå‘ç™»å½•</strong> çš„å®Œæ•´æ–¹æ¡ˆï¼ˆåŒ…å« <strong>å‰ç«¯å®¢æˆ·ç«¯æ£€æµ‹</strong> å’Œ <strong>æœåŠ¡ç«¯é¡µé¢ä¿æŠ¤</strong> ä¸¤ç§æ–¹å¼ï¼‰ã€‚</p><h3 id="_7-1-å®¢æˆ·ç«¯æ£€æµ‹-usesession-hook" tabindex="-1">7.1 å®¢æˆ·ç«¯æ£€æµ‹ï¼ˆuseSession Hookï¼‰ <a class="header-anchor" href="#_7-1-å®¢æˆ·ç«¯æ£€æµ‹-usesession-hook" aria-label="Permalink to &quot;7.1 å®¢æˆ·ç«¯æ£€æµ‹ï¼ˆuseSession Hookï¼‰&quot;">â€‹</a></h3><p>åœ¨å‰ç«¯ç»„ä»¶é‡Œï¼Œå¯ä»¥ç”¨ <code>next-auth/react</code> æä¾›çš„ <code>useSession()</code>ï¼Œå®ƒä¼šè¿”å›ï¼š</p><ul><li><code>status: &quot;authenticated&quot; | &quot;unauthenticated&quot; | &quot;loading&quot;</code></li><li><code>data: session | null</code></li></ul><p><strong>ç¤ºä¾‹ï¼šé«˜é˜¶ç»„ä»¶ä¿æŠ¤é¡µé¢</strong></p><div class="language-tsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;use client&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { useSession } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next-auth/react&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { useRouter } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next/navigation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { useEffect } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;react&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProtectedClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">children</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">children</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> React</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ReactNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">session</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSession</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> router</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useRouter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;unauthenticated&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/auth/signin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æœªç™»å½• â†’ è·³è½¬ç™»å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }, [status, router]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;loading&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Loading...&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é¡µé¢åŠ è½½ä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;authenticated&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;&gt;{children}&lt;/&gt;; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å·²ç™»å½• â†’ æ¸²æŸ“å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>ğŸ‘‰ ä½¿ç”¨æ—¶ç›´æ¥åŒ…è£¹é¡µé¢å†…å®¹ï¼š</p><div class="language-tsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ProtectedClient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@/components/ProtectedClient&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DashboardPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ProtectedClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Dashboard&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ProtectedClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h3 id="_7-2-æœåŠ¡ç«¯æ£€æµ‹-getserversession" tabindex="-1">7.2 æœåŠ¡ç«¯æ£€æµ‹ï¼ˆgetServerSessionï¼‰ <a class="header-anchor" href="#_7-2-æœåŠ¡ç«¯æ£€æµ‹-getserversession" aria-label="Permalink to &quot;7.2 æœåŠ¡ç«¯æ£€æµ‹ï¼ˆgetServerSessionï¼‰&quot;">â€‹</a></h3><p>App Router ä¸‹æ¨èåœ¨ <strong>page.tsx</strong> é‡Œç”¨ <code>getServerSession()</code>ï¼Œè¿™æ ·ç”¨æˆ·ç›´æ¥è¯·æ±‚æ—¶å°±èƒ½è¢«æ‹¦æˆªã€‚</p><p><strong>ç¤ºä¾‹ï¼šä¿æŠ¤ Dashboard é¡µé¢</strong></p><div class="language-tsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { getServerSession } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next-auth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { authOptions } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;../api/auth/[...nextauth]/route&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { redirect } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next/navigation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DashboardPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> session</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getServerSession</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authOptions);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">session) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/auth/signin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Session è¿‡æœŸ â†’ é‡å®šå‘ç™»å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Welcome {session.user?.name}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Email: {session.user?.email}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>ğŸ‘‰ å¥½å¤„ï¼š</p><ul><li><strong>SSR é˜¶æ®µå°±èƒ½æ‹¦æˆª</strong>ï¼Œæœªç™»å½•ç”¨æˆ·çœ‹ä¸åˆ°æ•æ„Ÿé¡µé¢ã€‚</li><li>å¯¹ SEO å‹å¥½ï¼Œé¡µé¢ä¸ä¼šé—ªä¸€ä¸‹å†è·³è½¬ã€‚</li></ul><hr><h3 id="_7-3-api-æ¥å£ä¿æŠ¤" tabindex="-1">7.3 API æ¥å£ä¿æŠ¤ <a class="header-anchor" href="#_7-3-api-æ¥å£ä¿æŠ¤" aria-label="Permalink to &quot;7.3 API æ¥å£ä¿æŠ¤&quot;">â€‹</a></h3><p>ä¸šåŠ¡ API è·¯ç”±é‡Œï¼Œä¹Ÿè¦é˜²æ­¢è¿‡æœŸçš„ sessionï¼š</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/api/orders/route.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { getServerSession } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next-auth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { authOptions } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;../auth/[...nextauth]/route&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { NextResponse } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next/server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> session</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getServerSession</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authOptions);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">session) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NextResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ error: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Unauthorized&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, { status: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">401</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NextResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ orders: [{ id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, item: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Book&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }] });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>å‰ç«¯ fetchï¼š</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/orders&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (res.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 401</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/auth/signin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è‡ªåŠ¨è·³ç™»å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><hr><h3 id="_7-4-ç”¨æˆ·ä½“éªŒä¼˜åŒ–-è‡ªåŠ¨ç»­æœŸ" tabindex="-1">7.4 ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼šè‡ªåŠ¨ç»­æœŸ <a class="header-anchor" href="#_7-4-ç”¨æˆ·ä½“éªŒä¼˜åŒ–-è‡ªåŠ¨ç»­æœŸ" aria-label="Permalink to &quot;7.4 ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼šè‡ªåŠ¨ç»­æœŸ&quot;">â€‹</a></h3><p>å¦‚æœä½ è§‰å¾—ã€Œä¸€å¤©è¿‡æœŸå°±è¦é‡æ–°ç™»å½•ã€å¾ˆçƒ¦ï¼Œå¯ä»¥ï¼š</p><ul><li>æŠŠ <code>maxAge</code> è®¾å¤§ä¸€ç‚¹ï¼Œæ¯”å¦‚ 30 å¤©ï¼›</li><li>é…åˆ <code>updateAge</code>ï¼ˆæ¯”å¦‚ 1 å¤©ï¼‰ï¼Œåªè¦ç”¨æˆ·æ¯å¤©æ¥ä¸€æ¬¡ï¼ŒCookie å°±ä¼šè‡ªåŠ¨åˆ·æ–°ã€‚</li></ul><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">session</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  maxAge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 30 å¤©</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  updateAge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¯ 24 å°æ—¶åˆ·æ–°ä¸€æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>è¿™æ ·å°±å˜æˆã€Œé•¿æœŸæœ‰æ•ˆç™»å½•ã€ï¼Œé™¤éç”¨æˆ·çœŸçš„ä¸€ä¸ªæœˆæ²¡æ¥ã€‚</p><hr><p><strong>âœ… æœ€ç»ˆæ•ˆæœ</strong></p><ol><li><strong>å®¢æˆ·ç«¯æ£€æµ‹</strong> â†’ åœ¨ React ç»„ä»¶é‡Œå®æ—¶ç›‘æ§ç™»å½•çŠ¶æ€ï¼Œå¤±æ•ˆè‡ªåŠ¨è·³è½¬ã€‚</li><li><strong>æœåŠ¡ç«¯æ£€æµ‹</strong> â†’ åœ¨ page.tsx é‡Œç”¨ <code>getServerSession()</code>ï¼Œæœªç™»å½•ç›´æ¥ redirectã€‚</li><li><strong>API æ¥å£ä¿æŠ¤</strong> â†’ åç«¯è·¯ç”±éªŒè¯ sessionï¼Œè¿‡æœŸè¿”å› 401ã€‚</li><li><strong>è‡ªåŠ¨ç»­æœŸ</strong> â†’ åªè¦ç”¨æˆ·æ´»è·ƒï¼Œsession å°±ä¸ä¼šè½»æ˜“è¿‡æœŸã€‚</li></ol>`,95))])}const A=n(d,[["render",g]]);export{m as __pageData,A as default};
