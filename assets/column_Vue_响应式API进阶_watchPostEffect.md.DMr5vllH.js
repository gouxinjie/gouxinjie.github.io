import{_ as a,c as i,o as n,aP as l}from"./chunks/framework.Dxm0NwP8.js";const E=JSON.parse('{"title":"Vue watchPostEffect ï¼šDOM æ›´æ–°åçš„å‰¯ä½œç”¨å¤„ç†","description":"","frontmatter":{},"headers":[],"relativePath":"column/Vue/å“åº”å¼APIè¿›é˜¶/watchPostEffect.md","filePath":"column/Vue/å“åº”å¼APIè¿›é˜¶/watchPostEffect.md"}'),t={name:"column/Vue/å“åº”å¼APIè¿›é˜¶/watchPostEffect.md"};function e(p,s,h,k,r,d){return n(),i("div",null,s[0]||(s[0]=[l(`<h1 id="vue-watchposteffect-dom-æ›´æ–°åçš„å‰¯ä½œç”¨å¤„ç†" tabindex="-1">Vue watchPostEffect ï¼šDOM æ›´æ–°åçš„å‰¯ä½œç”¨å¤„ç† <a class="header-anchor" href="#vue-watchposteffect-dom-æ›´æ–°åçš„å‰¯ä½œç”¨å¤„ç†" aria-label="Permalink to &quot;Vue watchPostEffect ï¼šDOM æ›´æ–°åçš„å‰¯ä½œç”¨å¤„ç†&quot;">â€‹</a></h1><h2 id="ä¸€ã€æ ¸å¿ƒæ¦‚å¿µä¸åŸºæœ¬ç”¨æ³•" tabindex="-1">ä¸€ã€æ ¸å¿ƒæ¦‚å¿µä¸åŸºæœ¬ç”¨æ³• <a class="header-anchor" href="#ä¸€ã€æ ¸å¿ƒæ¦‚å¿µä¸åŸºæœ¬ç”¨æ³•" aria-label="Permalink to &quot;ä¸€ã€æ ¸å¿ƒæ¦‚å¿µä¸åŸºæœ¬ç”¨æ³•&quot;">â€‹</a></h2><p><code>watchPostEffect</code> æ˜¯ Vue 3.2+ å¼•å…¥çš„ä¸€ä¸ªç‰¹æ®Šç‰ˆæœ¬çš„ <code>watchEffect</code>ï¼Œå®ƒä¼šåœ¨ <strong>DOM æ›´æ–°ä¹‹å</strong> æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ã€‚è¿™æ˜¯å¤„ç†éœ€è¦è®¿é—®æ›´æ–°å DOM çš„åœºæ™¯çš„ç†æƒ³é€‰æ‹©ã€‚</p><h3 id="åŸºç¡€ç¤ºä¾‹" tabindex="-1">åŸºç¡€ç¤ºä¾‹ <a class="header-anchor" href="#åŸºç¡€ç¤ºä¾‹" aria-label="Permalink to &quot;åŸºç¡€ç¤ºä¾‹&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ref, watchPostEffect } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;vue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> count</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> elementRef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åœ¨DOMæ›´æ–°åæ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watchPostEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (elementRef.value) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;å…ƒç´ å®½åº¦:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, elementRef.value.offsetWidth);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¿®æ”¹ä¼šè§¦å‘DOMæ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">count.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="äºŒã€ä¸-watcheffect-çš„å…³é”®åŒºåˆ«" tabindex="-1">äºŒã€ä¸ watchEffect çš„å…³é”®åŒºåˆ« <a class="header-anchor" href="#äºŒã€ä¸-watcheffect-çš„å…³é”®åŒºåˆ«" aria-label="Permalink to &quot;äºŒã€ä¸ watchEffect çš„å…³é”®åŒºåˆ«&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>ç‰¹æ€§</th><th>watchEffect</th><th>watchPostEffect</th></tr></thead><tbody><tr><td><strong>æ‰§è¡Œæ—¶æœº</strong></td><td>é»˜è®¤åœ¨ç»„ä»¶æ›´æ–°å‰(pre)</td><td>ç»„ä»¶æ›´æ–°å(post)</td></tr><tr><td><strong>DOM è®¿é—®</strong></td><td>å¯èƒ½è®¿é—®åˆ°æ—§ DOM</td><td>æ€»æ˜¯è®¿é—®æœ€æ–° DOM</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>æ•°æ®é¢„å¤„ç†</td><td>DOM æµ‹é‡ã€ç¬¬ä¸‰æ–¹åº“é›†æˆ</td></tr><tr><td><strong>å®ç°æ–¹å¼</strong></td><td><code>flush: &#39;pre&#39;</code></td><td><code>flush: &#39;post&#39;</code></td></tr></tbody></table><h2 id="ä¸‰ã€å…¸å‹åº”ç”¨åœºæ™¯" tabindex="-1">ä¸‰ã€å…¸å‹åº”ç”¨åœºæ™¯ <a class="header-anchor" href="#ä¸‰ã€å…¸å‹åº”ç”¨åœºæ™¯" aria-label="Permalink to &quot;ä¸‰ã€å…¸å‹åº”ç”¨åœºæ™¯&quot;">â€‹</a></h2><h3 id="_1-dom-æµ‹é‡ä¸å¸ƒå±€" tabindex="-1">1. DOM æµ‹é‡ä¸å¸ƒå±€ <a class="header-anchor" href="#_1-dom-æµ‹é‡ä¸å¸ƒå±€" aria-label="Permalink to &quot;1. DOM æµ‹é‡ä¸å¸ƒå±€&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> containerRef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> width</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watchPostEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (containerRef.value) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    width.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> containerRef.value.offsetWidth;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-ç¬¬ä¸‰æ–¹åº“åˆå§‹åŒ–" tabindex="-1">2. ç¬¬ä¸‰æ–¹åº“åˆå§‹åŒ– <a class="header-anchor" href="#_2-ç¬¬ä¸‰æ–¹åº“åˆå§‹åŒ–" aria-label="Permalink to &quot;2. ç¬¬ä¸‰æ–¹åº“åˆå§‹åŒ–&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> chartRef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*...*/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watchPostEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (chartRef.value) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç¡®ä¿DOMå·²æ›´æ–°å†åˆå§‹åŒ–å›¾è¡¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    initChart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chartRef.value, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toRaw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-åŠ¨ç”»è§¦å‘" tabindex="-1">3. åŠ¨ç”»è§¦å‘ <a class="header-anchor" href="#_3-åŠ¨ç”»è§¦å‘" aria-label="Permalink to &quot;3. åŠ¨ç”»è§¦å‘&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> show</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> animElement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watchPostEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (show.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> animElement.value) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // DOMæ›´æ–°åæ‰§è¡ŒåŠ¨ç”»</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    animElement.value.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startAnimation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="å››ã€é«˜çº§ç”¨æ³•ä¸æŠ€å·§" tabindex="-1">å››ã€é«˜çº§ç”¨æ³•ä¸æŠ€å·§ <a class="header-anchor" href="#å››ã€é«˜çº§ç”¨æ³•ä¸æŠ€å·§" aria-label="Permalink to &quot;å››ã€é«˜çº§ç”¨æ³•ä¸æŠ€å·§&quot;">â€‹</a></h2><h3 id="_1-é…åˆ-nexttick-ä½¿ç”¨" tabindex="-1">1. é…åˆ nextTick ä½¿ç”¨ <a class="header-anchor" href="#_1-é…åˆ-nexttick-ä½¿ç”¨" aria-label="Permalink to &quot;1. é…åˆ nextTick ä½¿ç”¨&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { nextTick } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;vue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watchPostEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nextTick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é¢å¤–çš„ç­‰å¾…ç¡®ä¿æ‰€æœ‰æ›´æ–°å®Œæˆ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ‰§è¡Œæ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-æ¸…ç†å‰¯ä½œç”¨" tabindex="-1">2. æ¸…ç†å‰¯ä½œç”¨ <a class="header-anchor" href="#_2-æ¸…ç†å‰¯ä½œç”¨" aria-label="Permalink to &quot;2. æ¸…ç†å‰¯ä½œç”¨&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watchPostEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">onCleanup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> observer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ResizeObserver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">entries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¤„ç†å°ºå¯¸å˜åŒ–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (elementRef.value) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    observer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">observe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elementRef.value);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onCleanup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> observer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disconnect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-æ€§èƒ½ä¼˜åŒ–" tabindex="-1">3. æ€§èƒ½ä¼˜åŒ– <a class="header-anchor" href="#_3-æ€§èƒ½ä¼˜åŒ–" aria-label="Permalink to &quot;3. æ€§èƒ½ä¼˜åŒ–&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¯¹é«˜é¢‘æ“ä½œè¿›è¡Œé˜²æŠ–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { debounce } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;lodash-es&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> updateLayout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> debounce</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æµ‹é‡å¸ƒå±€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watchPostEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(updateLayout);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="äº”ã€å®ç°åŸç†" tabindex="-1">äº”ã€å®ç°åŸç† <a class="header-anchor" href="#äº”ã€å®ç°åŸç†" aria-label="Permalink to &quot;äº”ã€å®ç°åŸç†&quot;">â€‹</a></h2><p><code>watchPostEffect</code> æœ¬è´¨ä¸Šæ˜¯ <code>watchEffect</code> çš„ç‰¹å®šé…ç½®ç‰ˆæœ¬ï¼š</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> watchPostEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> watchEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(effect, {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    flush: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;post&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å…¶å·¥ä½œæµç¨‹ï¼š</p><ol><li>ç»„ä»¶è§¦å‘å“åº”å¼å˜åŒ–</li><li>Vue æ‰§è¡Œ DOM æ›´æ–°</li><li>å°†å‰¯ä½œç”¨å‡½æ•°åŠ å…¥ Post é˜Ÿåˆ—</li><li>å½“å‰ä»»åŠ¡å®Œæˆåæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‡½æ•°</li></ol><h2 id="å…­ã€æœ€ä½³å®è·µ" tabindex="-1">å…­ã€æœ€ä½³å®è·µ <a class="header-anchor" href="#å…­ã€æœ€ä½³å®è·µ" aria-label="Permalink to &quot;å…­ã€æœ€ä½³å®è·µ&quot;">â€‹</a></h2><ol><li><strong>æ˜ç¡®ä½¿ç”¨åœºæ™¯</strong>ï¼šåªåœ¨éœ€è¦è®¿é—®æ›´æ–°å DOM æ—¶ä½¿ç”¨</li><li><strong>é¿å…è¿‡åº¦ä½¿ç”¨</strong>ï¼šä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ watchEffect</li><li><strong>æ¸…ç†èµ„æº</strong>ï¼šåŠæ—¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨ã€è§‚å¯Ÿè€…ç­‰</li><li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šæ³¨æ„å¯èƒ½å¼•èµ·çš„å¸ƒå±€æŠ–åŠ¨</li></ol><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¥½çš„å®è·µï¼šå°è£…ä¸ºè‡ªå®šä¹‰hook</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useElementSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ width: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, height: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  watchPostEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ref.value) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      size.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ref.value.offsetWidth;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      size.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ref.value.offsetHeight;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> size;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="ä¸ƒã€å¸¸è§é—®é¢˜è§£ç­”" tabindex="-1">ä¸ƒã€å¸¸è§é—®é¢˜è§£ç­” <a class="header-anchor" href="#ä¸ƒã€å¸¸è§é—®é¢˜è§£ç­”" aria-label="Permalink to &quot;ä¸ƒã€å¸¸è§é—®é¢˜è§£ç­”&quot;">â€‹</a></h2><h3 id="q1-watchposteffect-å’Œ-nexttick-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1">Q1: watchPostEffect å’Œ nextTick æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ <a class="header-anchor" href="#q1-watchposteffect-å’Œ-nexttick-æœ‰ä»€ä¹ˆåŒºåˆ«" aria-label="Permalink to &quot;Q1: watchPostEffect å’Œ nextTick æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&quot;">â€‹</a></h3><ul><li><code>watchPostEffect</code> è‡ªåŠ¨å“åº”ä¾èµ–å˜åŒ–å¹¶åœ¨æ¯æ¬¡ DOM æ›´æ–°åæ‰§è¡Œ</li><li><code>nextTick</code> åªæ˜¯ç­‰å¾…ä¸‹ä¸€æ¬¡ DOM æ›´æ–°ï¼Œä¸è‡ªåŠ¨è¿½è¸ªä¾èµ–</li></ul><h3 id="q2-ä¸ºä»€ä¹ˆæˆ‘çš„-watchposteffect-æ²¡æœ‰æ‰§è¡Œ" tabindex="-1">Q2: ä¸ºä»€ä¹ˆæˆ‘çš„ watchPostEffect æ²¡æœ‰æ‰§è¡Œï¼Ÿ <a class="header-anchor" href="#q2-ä¸ºä»€ä¹ˆæˆ‘çš„-watchposteffect-æ²¡æœ‰æ‰§è¡Œ" aria-label="Permalink to &quot;Q2: ä¸ºä»€ä¹ˆæˆ‘çš„ watchPostEffect æ²¡æœ‰æ‰§è¡Œï¼Ÿ&quot;">â€‹</a></h3><ul><li>æ£€æŸ¥ä¾èµ–çš„å“åº”å¼æ•°æ®æ˜¯å¦çœŸçš„å‘ç”Ÿäº†å˜åŒ–</li><li>ç¡®è®¤ç»„ä»¶æ²¡æœ‰è¢«å¸è½½</li><li>ç¡®ä¿æ²¡æœ‰æå‰è°ƒç”¨äº†åœæ­¢å‡½æ•°</li></ul><h3 id="q3-å¯ä»¥åœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­ä½¿ç”¨å—" tabindex="-1">Q3: å¯ä»¥åœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­ä½¿ç”¨å—ï¼Ÿ <a class="header-anchor" href="#q3-å¯ä»¥åœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­ä½¿ç”¨å—" aria-label="Permalink to &quot;Q3: å¯ä»¥åœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­ä½¿ç”¨å—ï¼Ÿ&quot;">â€‹</a></h3><p>åœ¨ SSR ä¸­ï¼Œ<code>watchPostEffect</code> ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºä¸å­˜åœ¨ DOM æ›´æ–°é˜¶æ®µã€‚</p><h2 id="å…«ã€æ€§èƒ½è€ƒé‡" tabindex="-1">å…«ã€æ€§èƒ½è€ƒé‡ <a class="header-anchor" href="#å…«ã€æ€§èƒ½è€ƒé‡" aria-label="Permalink to &quot;å…«ã€æ€§èƒ½è€ƒé‡&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>æ“ä½œ</th><th>watchEffect (pre)</th><th>watchPostEffect (post)</th></tr></thead><tbody><tr><td><strong>æ‰§è¡Œé€Ÿåº¦</strong></td><td>æ›´å¿«</td><td>ç¨æ…¢(éœ€ç­‰å¾…æ¸²æŸ“å®Œæˆ)</td></tr><tr><td><strong>å¸ƒå±€æŠ–åŠ¨é£é™©</strong></td><td>ä½</td><td>é«˜(å¯èƒ½è§¦å‘å›æµ)</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>ç›¸åŒ</td><td>ç›¸åŒ</td></tr></tbody></table><h2 id="ä¹ã€æ€»ç»“" tabindex="-1">ä¹ã€æ€»ç»“ <a class="header-anchor" href="#ä¹ã€æ€»ç»“" aria-label="Permalink to &quot;ä¹ã€æ€»ç»“&quot;">â€‹</a></h2><p><code>watchPostEffect</code> æ˜¯ Vue å“åº”å¼ç³»ç»Ÿä¸­å¤„ç† DOM ç›¸å…³å‰¯ä½œç”¨çš„ä¸“ç”¨å·¥å…·ï¼š</p><ul><li>ğŸ–¥ï¸ <strong>DOM å°±ç»ªä¿è¯</strong>ï¼šæ€»æ˜¯åœ¨æ›´æ–°åè®¿é—®æœ€æ–° DOM</li><li>ğŸ› ï¸ <strong>ç®€åŒ–ä»£ç </strong>ï¼šæ— éœ€æ‰‹åŠ¨ nextTick</li><li>âš¡ <strong>å“åº”å¼é›†æˆ</strong>ï¼šè‡ªåŠ¨ä¾èµ–è¿½è¸ª</li><li>ğŸ§¹ <strong>å®Œå–„æ¸…ç†</strong>ï¼šæä¾›å‰¯ä½œç”¨æ¸…ç†æœºåˆ¶</li></ul>`,41)]))}const o=a(t,[["render",e]]);export{E as __pageData,o as default};
