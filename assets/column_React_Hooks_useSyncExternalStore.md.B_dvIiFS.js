import{_ as n,C as t,c as e,o as l,j as i,G as p,aQ as h,a as r}from"./chunks/framework.DEi4YP2n.js";const b=JSON.parse('{"title":"useSyncExternalStoreï¼š åŒæ­¥å¤–éƒ¨çŠ¶æ€ Hook","description":"","frontmatter":{},"headers":[],"relativePath":"column/React/Hooks/useSyncExternalStore.md","filePath":"column/React/Hooks/useSyncExternalStore.md","lastUpdated":1763628978000}'),k={name:"column/React/Hooks/useSyncExternalStore.md"};function d(E,s,c,o,g,y){const a=t("ArticleMetadata");return l(),e("div",null,[s[0]||(s[0]=i("h1",{id:"usesyncexternalstore-åŒæ­¥å¤–éƒ¨çŠ¶æ€-hook",tabindex:"-1"},[r("useSyncExternalStoreï¼š åŒæ­¥å¤–éƒ¨çŠ¶æ€ Hook "),i("a",{class:"header-anchor",href:"#usesyncexternalstore-åŒæ­¥å¤–éƒ¨çŠ¶æ€-hook","aria-label":'Permalink to "useSyncExternalStoreï¼š åŒæ­¥å¤–éƒ¨çŠ¶æ€ Hook"'},"â€‹")],-1)),p(a),s[1]||(s[1]=h(`<nav class="table-of-contents"><ul><li><a href="#ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦-usesyncexternalstore">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ useSyncExternalStoreï¼Ÿ</a></li><li><a href="#äºŒã€usesyncexternalstore-çš„è¯­æ³•">äºŒã€useSyncExternalStore çš„è¯­æ³•</a></li><li><a href="#ä¸‰ã€ç®€å•ç¤ºä¾‹-è®¢é˜…å…¨å±€çŠ¶æ€">ä¸‰ã€ç®€å•ç¤ºä¾‹ï¼šè®¢é˜…å…¨å±€çŠ¶æ€</a></li><li><a href="#å››ã€åœ¨-redux-zustand-ä¸­çš„åº”ç”¨">å››ã€åœ¨ Redux / Zustand ä¸­çš„åº”ç”¨</a></li><li><a href="#äº”ã€ssr-æœåŠ¡å™¨ç«¯æ¸²æŸ“-åœºæ™¯">äº”ã€SSRï¼ˆæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼‰åœºæ™¯</a></li><li><a href="#å…­ã€ä¸-useeffect-çš„åŒºåˆ«">å…­ã€ä¸ useEffect çš„åŒºåˆ«</a></li><li><a href="#ä¸ƒã€å®æˆ˜æ¡ˆä¾‹-ç›‘å¬æµè§ˆå™¨å®½åº¦">ä¸ƒã€å®æˆ˜æ¡ˆä¾‹ï¼šç›‘å¬æµè§ˆå™¨å®½åº¦</a></li><li><a href="#å…«ã€æœ€ä½³å®è·µæ€»ç»“">å…«ã€æœ€ä½³å®è·µæ€»ç»“</a></li></ul></nav><blockquote><p>React 18 å¸¦æ¥äº†å¾ˆå¤šæ–°çš„ç‰¹æ€§ï¼Œå…¶ä¸­ <code>useSyncExternalStore</code> æ˜¯ä¸€ä¸ªè¢«å¾ˆå¤šäººå¿½è§†ä½†éå¸¸é‡è¦çš„ Hookã€‚å®ƒä¸º <strong>React ä¸å¤–éƒ¨æ•°æ®æºçš„åŒæ­¥</strong> æä¾›äº†å®˜æ–¹ã€ç¨³å®šä¸”é«˜æ€§èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><h2 id="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦-usesyncexternalstore" tabindex="-1">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ useSyncExternalStoreï¼Ÿ <a class="header-anchor" href="#ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦-usesyncexternalstore" aria-label="Permalink to &quot;ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ useSyncExternalStoreï¼Ÿ&quot;">â€‹</a></h2><p>åœ¨ React ä¸­ï¼Œç»„ä»¶çš„çŠ¶æ€é€šå¸¸ç”± React è‡ªèº«ç®¡ç†ï¼ˆå¦‚ <code>useState</code>ã€<code>useReducer</code>ï¼‰ã€‚ä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä¸ <strong>å¤–éƒ¨çŠ¶æ€æº</strong> åŒæ­¥ï¼Œæ¯”å¦‚ï¼š</p><ul><li>Reduxã€Zustandã€Recoil ç­‰çŠ¶æ€ç®¡ç†åº“</li><li>æµè§ˆå™¨ <code>window</code> å¯¹è±¡ï¼ˆå¦‚ <code>window.innerWidth</code>ï¼‰</li><li>WebSocket æˆ–å…¨å±€æ•°æ®ä¸­å¿ƒ</li><li>åŸç”Ÿäº‹ä»¶è®¢é˜…ï¼ˆå¦‚æ»šåŠ¨ã€é¼ æ ‡äº‹ä»¶ç­‰ï¼‰</li></ul><p>ä»¥å‰æˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·åš ğŸ‘‡</p><div class="language-jsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âŒ æ—§å†™æ³•ï¼ˆå¯èƒ½å¼•å‘é—®é¢˜ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    setState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, []);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>è¿™ç§æ–¹å¼å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li><strong>Concurrent Mode ä¸å®‰å…¨</strong>ï¼šåœ¨å¹¶å‘æ¸²æŸ“ä¸‹å¯èƒ½å¯¼è‡´æ•°æ®ä¸åŒæ­¥ã€‚</li><li><strong>éš¾ä»¥é¿å…é—ªçƒæˆ–ä¸­æ–­</strong>ï¼šReact æ— æ³•æ„ŸçŸ¥å¤–éƒ¨æ•°æ®å˜åŒ–çš„â€œå¿«ç…§â€ã€‚</li></ol><p>äºæ˜¯ï¼ŒReact å®˜æ–¹å¼•å…¥äº† <code>useSyncExternalStore</code> â€”â€” å®ƒè®© React èƒ½<strong>å¯é åœ°è®¢é˜…å¤–éƒ¨æ•°æ®æº</strong>ï¼Œå¹¶ç¡®ä¿æ¸²æŸ“æ—¶æ•°æ®ä¸€è‡´ã€‚</p><h2 id="äºŒã€usesyncexternalstore-çš„è¯­æ³•" tabindex="-1">äºŒã€useSyncExternalStore çš„è¯­æ³• <a class="header-anchor" href="#äºŒã€usesyncexternalstore-çš„è¯­æ³•" aria-label="Permalink to &quot;äºŒã€useSyncExternalStore çš„è¯­æ³•&quot;">â€‹</a></h2><div class="language-tsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSyncExternalStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(subscribe, getSnapshot, getServerSnapshot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p><table tabindex="0"><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>subscribe</code></td><td><code>(listener: () =&gt; void) =&gt; () =&gt; void</code></td><td>ç”¨äºè®¢é˜…å¤–éƒ¨ storeï¼Œå½“ store å˜åŒ–æ—¶è°ƒç”¨ listener</td></tr><tr><td><code>getSnapshot</code></td><td><code>() =&gt; any</code></td><td>è¿”å›å½“å‰çš„å¤–éƒ¨çŠ¶æ€å¿«ç…§</td></tr><tr><td><code>getServerSnapshot</code></td><td><code>() =&gt; any</code> <em>(å¯é€‰)</em></td><td>ç”¨äº SSRï¼ˆæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼‰æ—¶è·å–å¿«ç…§</td></tr></tbody></table><p><strong>è¿”å›å€¼</strong>ï¼š</p><p>è¿”å›å½“å‰çš„ <strong>å¿«ç…§æ•°æ®ï¼ˆsnapshotï¼‰</strong>ï¼Œå³å½“å‰çŠ¶æ€ã€‚</p><h2 id="ä¸‰ã€ç®€å•ç¤ºä¾‹-è®¢é˜…å…¨å±€çŠ¶æ€" tabindex="-1">ä¸‰ã€ç®€å•ç¤ºä¾‹ï¼šè®¢é˜…å…¨å±€çŠ¶æ€ <a class="header-anchor" href="#ä¸‰ã€ç®€å•ç¤ºä¾‹-è®¢é˜…å…¨å±€çŠ¶æ€" aria-label="Permalink to &quot;ä¸‰ã€ç®€å•ç¤ºä¾‹ï¼šè®¢é˜…å…¨å±€çŠ¶æ€&quot;">â€‹</a></h2><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå…¨å±€ storeï¼Œç”¨æœ€ç®€å•çš„æ–¹å¼å®ç°ï¼š</p><div class="language-jsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// store.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { count: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> listeners </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getSnapshot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  setState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">newState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newState };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    listeners.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">l</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> l</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">listener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    listeners.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listener);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> listeners.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listener);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>ç„¶ååœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š</p><div class="language-jsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> React, { useSyncExternalStore } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;react&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { store } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./store&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Counter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> snapshot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSyncExternalStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(store.subscribe, store.getSnapshot);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Count: {snapshot.count}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ count: snapshot.count </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })}&gt;+1&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>âœ… ä¼˜ç‚¹ï¼š</p><ul><li>æ— éœ€æ‰‹åŠ¨ setState</li><li>React è‡ªåŠ¨åœ¨å¤–éƒ¨æ•°æ®æ›´æ–°æ—¶é‡æ–°æ¸²æŸ“</li><li>æ”¯æŒå¹¶å‘æ¨¡å¼ï¼Œæ¸²æŸ“æ—¶æ•°æ®å§‹ç»ˆä¸€è‡´</li></ul><h2 id="å››ã€åœ¨-redux-zustand-ä¸­çš„åº”ç”¨" tabindex="-1">å››ã€åœ¨ Redux / Zustand ä¸­çš„åº”ç”¨ <a class="header-anchor" href="#å››ã€åœ¨-redux-zustand-ä¸­çš„åº”ç”¨" aria-label="Permalink to &quot;å››ã€åœ¨ Redux / Zustand ä¸­çš„åº”ç”¨&quot;">â€‹</a></h2><p>è®¸å¤šçŠ¶æ€ç®¡ç†åº“åœ¨ React 18 ä¹‹åéƒ½æ›´æ–°ä¸ºå†…éƒ¨ä½¿ç”¨ <code>useSyncExternalStore</code>ã€‚</p><p>ä¾‹å¦‚ï¼ŒZustand æºç ç‰‡æ®µä¸­å°±æœ‰è¿™æ ·çš„å®ç°ï¼š</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useStore</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSyncExternalStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(store.subscribe, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>è¿™è®©çŠ¶æ€ç®¡ç†åº“åœ¨ React 18+ çš„ <strong>Concurrent Rendering</strong> æ¨¡å¼ä¸‹æ›´åŠ å®‰å…¨ã€‚</p><h2 id="äº”ã€ssr-æœåŠ¡å™¨ç«¯æ¸²æŸ“-åœºæ™¯" tabindex="-1">äº”ã€SSRï¼ˆæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼‰åœºæ™¯ <a class="header-anchor" href="#äº”ã€ssr-æœåŠ¡å™¨ç«¯æ¸²æŸ“-åœºæ™¯" aria-label="Permalink to &quot;äº”ã€SSRï¼ˆæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼‰åœºæ™¯&quot;">â€‹</a></h2><p><code>useSyncExternalStore</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•° <code>getServerSnapshot</code> ä¸“é—¨ç”¨äº SSR åœºæ™¯ï¼ˆNext.jsã€Remix ç­‰ï¼‰ã€‚</p><p>å½“åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“æ—¶ï¼ŒReact ä¼šè°ƒç”¨ <code>getServerSnapshot</code> è·å–åˆå§‹æ•°æ®ï¼Œé˜²æ­¢<strong>å®¢æˆ·ç«¯æ°´åˆï¼ˆHydrationï¼‰ä¸åŒ¹é…</strong>ã€‚</p><div class="language-jsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSyncExternalStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  subscribe,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  getSnapshot,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> initialServerData </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// SSR æ—¶è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="å…­ã€ä¸-useeffect-çš„åŒºåˆ«" tabindex="-1">å…­ã€ä¸ useEffect çš„åŒºåˆ« <a class="header-anchor" href="#å…­ã€ä¸-useeffect-çš„åŒºåˆ«" aria-label="Permalink to &quot;å…­ã€ä¸ useEffect çš„åŒºåˆ«&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>ç‰¹æ€§</th><th>useEffect + setState</th><th>useSyncExternalStore</th></tr></thead><tbody><tr><td>å“åº”å¤–éƒ¨çŠ¶æ€å˜åŒ–</td><td>âœ… å¯ä»¥</td><td>âœ… å¯ä»¥</td></tr><tr><td>å¹¶å‘æ¸²æŸ“å®‰å…¨</td><td>âŒ å¦</td><td>âœ… æ˜¯</td></tr><tr><td>ç›´æ¥è¯»å–æœ€æ–°å¿«ç…§</td><td>âŒ æœ‰å»¶è¿Ÿ</td><td>âœ… å®æ—¶</td></tr><tr><td>SSR æ”¯æŒ</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr></tbody></table><h2 id="ä¸ƒã€å®æˆ˜æ¡ˆä¾‹-ç›‘å¬æµè§ˆå™¨å®½åº¦" tabindex="-1">ä¸ƒã€å®æˆ˜æ¡ˆä¾‹ï¼šç›‘å¬æµè§ˆå™¨å®½åº¦ <a class="header-anchor" href="#ä¸ƒã€å®æˆ˜æ¡ˆä¾‹-ç›‘å¬æµè§ˆå™¨å®½åº¦" aria-label="Permalink to &quot;ä¸ƒã€å®æˆ˜æ¡ˆä¾‹ï¼šç›‘å¬æµè§ˆå™¨å®½åº¦&quot;">â€‹</a></h2><p>æˆ‘ä»¬è¿˜å¯ä»¥ç”¨å®ƒè®¢é˜… <strong>æµè§ˆå™¨çª—å£å®½åº¦</strong>ï¼š</p><div class="language-jsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;resize&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, callback);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">removeEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;resize&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, callback);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getSnapshot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> window.innerWidth;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WindowWidth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> width</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSyncExternalStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(subscribe, getSnapshot);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;å½“å‰çª—å£å®½åº¦ï¼š{width}px&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>âœ… ä¼˜ç‚¹ï¼š</p><ul><li>è‡ªåŠ¨åˆ·æ–°</li><li>æ²¡æœ‰å¼‚æ­¥å»¶è¿Ÿ</li><li>Concurrent Mode å®‰å…¨</li></ul><h2 id="å…«ã€æœ€ä½³å®è·µæ€»ç»“" tabindex="-1">å…«ã€æœ€ä½³å®è·µæ€»ç»“ <a class="header-anchor" href="#å…«ã€æœ€ä½³å®è·µæ€»ç»“" aria-label="Permalink to &quot;å…«ã€æœ€ä½³å®è·µæ€»ç»“&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>å»ºè®®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>âœ… åœ¨ä»»ä½•å¤–éƒ¨æ•°æ®æºä¸­ä½¿ç”¨ <code>useSyncExternalStore</code></td><td>åŒ…æ‹¬å…¨å±€çŠ¶æ€ã€äº‹ä»¶ç›‘å¬ã€WebSocket ç­‰</td></tr><tr><td>âœ… ä¿æŒ <code>getSnapshot</code> çº¯å‡€</td><td>ä¸èƒ½æœ‰å‰¯ä½œç”¨ï¼Œåªè¿”å›å¿«ç…§</td></tr><tr><td>âŒ ä¸è¦åœ¨ <code>subscribe</code> é‡Œç›´æ¥ä¿®æ”¹çŠ¶æ€</td><td>åº”é€šè¿‡ listener é€šçŸ¥ React</td></tr><tr><td>âœ… å¯¹ SSR æä¾› <code>getServerSnapshot</code></td><td>ä¿è¯é¦–å±ä¸€è‡´æ€§</td></tr></tbody></table>`,41))])}const F=n(k,[["render",d]]);export{b as __pageData,F as default};
