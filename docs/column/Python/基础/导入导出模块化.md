# Python 中的模块与路径管理

[[toc]]

在 `Python` 中，**模块**是组织和重用代码的基本单位。通过模块，你可以将相关功能集中在一个文件中，从而使代码更易于管理、维护和扩展。

## 一、创建模块

一个模块通常是一个 `.py` 文件，例如 `my_module.py`。你可以在 Python 代码中使用 `import` 语句来引用并使用模块中的功能。

例如，创建一个名为 `math_utils.py` 的模块，内容如下：

```python
# math_utils.py

def add(a, b):
    return a + b

def subtract(a, b):
    return a - b
```

## 二、导入模块

一旦创建了模块，你就可以在其他 `Python` 文件中导入它并使用其中的函数、类或变量。使用 `import` 语句可以导入整个模块，或导入模块中的特定部分。

### 2.1 导入整个模块

通过 `import` 语句导入整个模块，然后通过模块名来访问其中的内容：

```python
# main.py

import math_utils

print(math_utils.add(3, 5))  # 输出 8
print(math_utils.subtract(10, 4))  # 输出 6
```

### 2.2 导入模块中的特定部分

如果只需要模块中的某个函数或类，可以使用 `from ... import ...` 来导入：

```python
from math_utils import add

print(add(3, 5))  # 输出 8
```

### 2.3 为模块起别名

你也可以为导入的模块起一个别名，以便更方便地使用：

```python
import math_utils as mu

print(mu.add(3, 5))  # 输出 8
```

### 2.4 导入多个模块部分

你可以同时导入模块中的多个函数：

```python
from math_utils import add, subtract

print(add(3, 5))  # 输出 8
print(subtract(10, 4))  # 输出 6
```

## 三、Python 标准库模块

`Python` 提供了大量的标准库模块，它们覆盖了广泛的功能，从文件操作到网络通信，再到数学计算。例如：

- **math**：提供数学函数，如平方根、三角函数等。
- **datetime**：处理日期和时间。
- **os**：与操作系统交互，如文件路径、目录操作等。
- **sys**：与 Python 解释器交互，如命令行参数、标准输入输出等。

这些标准库模块可以直接导入并使用，无需额外安装。

```python
import math

print(math.sqrt(16))  # 输出 4.0

import datetime

now = datetime.datetime.now()
print(now)  # 输出当前的日期和时间
```

## 四、模块搜索路径

那么，当你使用 `import` 语句导入模块时，Python 是如何找到该模块的呢？其实，Python 会按照一定的顺序在一系列目录中查找模块。这些目录路径称为 **模块搜索路径**，它们存储在 `sys.path` 列表中。

### 4.1 模块搜索路径顺序

1. **当前目录** Python 会首先在当前目录中查找模块。如果你在执行脚本的当前目录下有一个名为 `my_module.py` 的文件，Python 会优先导入它。

2. **`PYTHONPATH` 环境变量** 如果你设置了 `PYTHONPATH` 环境变量，Python 会在该环境变量指定的路径中查找模块。

3. **标准库目录** Python 会在标准库目录中查找内置的模块。例如，`os`、`sys`、`math` 等标准库模块。

4. **第三方库目录** Python 会在通过 `pip` 安装的第三方库的目录中查找模块。常见的第三方库安装位置是 `site-packages`。

#### 4.2 查看 `sys.path`

你可以通过 `sys.path` 查看 Python 查找模块的路径：

```python
import sys
print(sys.path)
```

这将打印出 Python 的模块搜索路径列表，通常包括当前目录、`PYTHONPATH` 指定的目录、标准库路径等。

## 五、如何导入模块时指定路径？

虽然 Python 会自动根据模块搜索路径查找模块，但有时我们需要从自定义目录或指定路径导入模块。你可以通过以下方法来指定模块路径：

### 5.1 修改 `sys.path` 添加路径

你可以在运行时修改 `sys.path`，将模块所在的目录添加到搜索路径中：

```python
import sys
sys.path.append('/path/to/your/module/directory')

import my_module
```

这样，Python 会在 `/path/to/your/module/directory` 目录中查找模块。

### 5.2 使用相对导入或绝对导入

在 Python 包中，你可以使用相对导入和绝对导入来访问不同模块。

- **绝对导入**：使用完整的路径从根目录导入模块。

  ```python
  from my_package.my_module import some_function
  ```

- **相对导入**：在包内使用相对路径导入模块。

  ```python
  from .my_module import some_function  # 当前目录的模块
  from ..another_package import another_function  # 上级目录的模块
  ```

### 5.3 模块的缓存和重复导入

Python 会将导入的模块缓存起来，当同一个模块再次被导入时，Python 会直接使用缓存中的模块，而不会重新执行该模块的代码。你可以通过 `sys.modules` 查看当前已导入的模块：

```python
import sys
print(sys.modules)
```

## 六、创建包（Package）

当你有多个相关模块时，可以将它们组织成一个**包**。包是一个包含多个模块的目录，其中必须包含一个 `__init__.py` 文件（可以是空文件），以告诉 Python 这是一个包。

例如，创建一个名为 `my_package` 的包：

```
my_package/
    __init__.py
    module1.py
    module2.py
```

你可以使用以下方式导入包中的模块：

```python
from my_package import module1
from my_package.module2 import function
```
