# å‰ç«¯æ·»åŠ åŸ‹ç‚¹æ–¹å¼å’ŒåŸç†

å‰ç«¯åŸ‹ç‚¹ï¼Œå°±æ˜¯æŠŠç”¨æˆ·åœ¨äº§å“é‡Œçš„å…³é”®è¡Œä¸ºï¼ˆç‚¹å‡»ã€æ›å…‰ã€åœç•™ã€é”™è¯¯ç­‰ï¼‰è®°å½•ä¸‹æ¥ï¼Œå›ä¼ åˆ°æœåŠ¡å™¨æˆ–ç¬¬ä¸‰æ–¹å¹³å°ï¼Œä¸ºäº§å“å†³ç­–ã€è¿è¥åˆ†æã€é—®é¢˜æ’æŸ¥æä¾›æ•°æ®ä¾æ®ã€‚

[[toc]]

:::tip

**æ ¸å¿ƒå®ç°æ€è·¯** åŸ‹ç‚¹æœ¬è´¨ä¸Šå°±æ˜¯å‘åŸ‹ç‚¹å¹³å°çš„æ•°æ®æ¥æ”¶ URL å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œè¯·æ±‚ä¸­æºå¸¦äº†æ ¼å¼åŒ–çš„æ•°æ®ï¼ˆé€šå¸¸æ˜¯ URL å‚æ•°æˆ– JSONï¼‰ã€‚æ‚¨æä¾›çš„å“åº”å¤´è¡¨æ˜è¿™æ˜¯ä¸€ä¸ª GET è¯·æ±‚ï¼Œå¹¶ä¸”æœåŠ¡å™¨é…ç½®ä¸ºä¸ç¼“å­˜ä¸”å…è®¸è·¨åŸŸã€‚

:::

## æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Image Beaconï¼ˆæœ€ç»å…¸ã€æœ€å¯é çš„æ–¹æ³•ï¼‰

è¿™æ˜¯æœ€ä¼ ç»Ÿä¸”å…¼å®¹æ€§æœ€å¥½çš„æ–¹å¼ï¼Œåˆ©ç”¨å›¾ç‰‡è¯·æ±‚æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„ç‰¹æ€§ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```js
// å°†å±æ€§å¯¹è±¡è½¬æ¢ä¸ºURLå‚æ•°å­—ç¬¦ä¸²
function formatParams(params) {
  return Object.keys(params)
    .map((key) => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
    .join("&");
}
// ä½¿ç”¨ Image Beacon
document.getElementById("ImageBeacon").addEventListener("click", () => {
  // æ„å»ºåŸ‹ç‚¹URLå’Œå‚æ•°
  const saUrl = "https://..."; // æ•°æ®æ¥æ”¶åœ°å€
  const project = "fosun_test1"; // æ‚¨çš„é¡¹ç›®å
  const event = "ButtonClick"; // äº‹ä»¶åç§°ï¼Œå¦‚ 'PageView', 'ButtonClick'
  const distinctId = "user_123"; // ç”¨æˆ·ID
  const properties = {
    // äº‹ä»¶å±æ€§
    $url: window.location.href,
    button_name: "æäº¤æŒ‰é’®"
  };
  const finalUrl = `${saUrl}?project=${project}&event=${event}&distinct_id=${distinctId}&${formatParams(properties)}`;

  // åˆ›å»ºImageå¯¹è±¡å‘é€è¯·æ±‚
  const beacon = new Image(1, 1); // åˆ›å»ºä¸€ä¸ª1x1åƒç´ çš„å›¾ç‰‡
  beacon.src = finalUrl; // è®¾ç½®srcå³å‘èµ·GETè¯·æ±‚

  // å¯é€‰çš„é”™è¯¯å¤„ç†
  beacon.onerror = function () {
    console.error("Sensors beacon request failed.");
  };
  beacon.onload = function () {
    console.log("Sensors beacon request successful.");
  };
});
```

æˆªå›¾å¦‚ä¸‹ï¼š

![](../images/maidian-1.png)

## æ–¹æ³•äºŒï¼šä½¿ç”¨ Navigator.sendBeaconï¼ˆç°ä»£æµè§ˆå™¨æ¨èï¼‰

è¿™æ˜¯ HTML5 ä¸“é—¨ä¸ºæ—¥å¿—ä¸ŠæŠ¥è®¾è®¡çš„æ–° APIï¼Œéå¸¸é€‚åˆåŸ‹ç‚¹åœºæ™¯ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```js
// ä½¿ç”¨ sendBeacon å‘é€æ•°æ®
document.getElementById("sendBeacon").addEventListener("click", () => {
  // æ„å»ºæ•°æ®å¯¹è±¡
  const data = {
    project: "fosun_test1",
    event: "ButtonClick",
    distinct_id: "user_123",
    properties: {
      $url: window.location.href,
      button_name: "æäº¤æŒ‰é’®"
    }
  };

  // æ³¨æ„ï¼šsendBeacon é€šå¸¸ä»¥ POST æ–¹å¼å‘é€å­—ç¬¦ä¸²åŒ–çš„JSON
  const blob = new Blob([JSON.stringify(data)], { type: "application/x-www-form-urlencoded" });
  const success = navigator.sendBeacon("https://...", blob); // æ•°æ®æ¥æ”¶åœ°å€
  if (success) {
    console.log("Beacon enqueued successfully!");
  } else {
    console.error("Beacon failed to queue.");
  }
});
```

æˆªå›¾å¦‚ä¸‹ï¼š

![](../images/maidian-2.png)

**ä¼˜ç‚¹ï¼š**

- ä¸“ä¸ºæ—¥å¿—è®¾è®¡ï¼šå³ä½¿é¡µé¢å¸è½½ä¹Ÿä¼šä¿è¯å‘é€ã€‚
- ä½ä¼˜å…ˆçº§ï¼šä¸ä¼šé˜»å¡é¡µé¢å¸è½½è¿‡ç¨‹æˆ–ä¸å…³é”®æ“ä½œç«äº‰ç½‘ç»œèµ„æºã€‚

## æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ Fetch API with keepaliveï¼ˆä¸æ¨èï¼‰

`Fetch API `æä¾›äº† `keepalive` é€‰é¡¹ï¼Œç”¨äºåœ¨é¡µé¢å¸è½½åç»§ç»­å‘é€è¯·æ±‚ã€‚è¿™åœ¨éœ€è¦ç¡®ä¿æ•°æ®ä¸ŠæŠ¥çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚

```javascript
// ä½¿ç”¨ fetchKeepalive å‘é€æ•°æ®
document.getElementById("keepalive").addEventListener("click", () => {
  const data = new URLSearchParams();
  data.append("project", "your_project_name");
  data.append("event", "ButtonClick");
  data.append("distinct_id", "user_123");
  data.append(
    "properties",
    JSON.stringify({
      $url: window.location.href,
      button_name: "æäº¤æŒ‰é’®"
    })
  );
  fetch("https://...", {
    method: "POST",
    body: data,
    keepalive: true, // å…³é”®å‚æ•°ï¼šç¡®ä¿è¯·æ±‚åœ¨é¡µé¢å¸è½½åä»èƒ½ç»§ç»­
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    }
  }).catch((error) => {
    console.error("Fetch beacon failed:", error);
  });
});
```

## æ–¹æ³•å››ï¼šç›´æ¥ä½¿ç”¨ç¥ç­–å®˜æ–¹ SDKï¼ˆæœ€æ¨èï¼‰

å®é™…ä¸Šï¼Œæ‚¨ä¸éœ€è¦æ‰‹åŠ¨å®ç°è¿™äº›ã€‚ç¥ç­–æä¾›äº†éå¸¸å®Œå–„çš„å®˜æ–¹ SDKï¼Œåªéœ€ç®€å•åˆå§‹åŒ–å³å¯ã€‚

1.  **å®‰è£… SDK**ï¼š

    ```bash
    npm install sa-sdk-javascript
    ```

2.  **åˆå§‹åŒ–å¹¶è°ƒç”¨**ï¼š

    ```html
    <script>
      // åˆå§‹åŒ–ç¥ç­–åˆ†æ
      var sensors = window["sensorsDataAnalytic201505"];
      sensors.init({
        server_url: "https://your-sensors-data-server.com/sa", // æ•°æ®æ¥æ”¶åœ°å€
        heatmap: {
          // å¯é€‰ï¼šç‚¹å‡»å›¾/è§¦è¾¾å›¾é…ç½®
          clickmap: "default",
          scroll_notice_map: "default"
        }
      });

      // æ ‡è¯†ç”¨æˆ·
      sensors.login("user_123");

      // å‘é€äº‹ä»¶
      sensors.track("ButtonClick", {
        button_name: "æäº¤æŒ‰é’®"
      });
    </script>
    ```

**è¿™æ˜¯æœ€æ¨èçš„æ–¹å¼**ï¼Œå› ä¸ºå®˜æ–¹ SDK å¤„ç†äº†æ‰€æœ‰çš„å…¼å®¹æ€§ã€æ‰¹é‡ä¸ŠæŠ¥ã€é‡è¯•æœºåˆ¶ç­‰å¤æ‚é—®é¢˜ã€‚

### ç¥ç­–è¯·æ±‚å‚æ•°è¯¦è§£

æ— è®ºç”¨å“ªç§æ–¹æ³•ï¼Œæœ€ç»ˆå‘é€ç»™ç¥ç­–æœåŠ¡å™¨çš„ URL é€šå¸¸åŒ…å«ä»¥ä¸‹æ ¸å¿ƒå‚æ•°ï¼š

| å‚æ•°          | å«ä¹‰               | ç¤ºä¾‹                                |
| :------------ | :----------------- | :---------------------------------- |
| `project`     | é¡¹ç›®åç§°           | `production`                        |
| `event`       | äº‹ä»¶åç§°           | `$pageview` (é¡µé¢æµè§ˆ)              |
| `distinct_id` | åŒ¿å/ç”¨æˆ· ID       | `123456`                            |
| `properties`  | äº‹ä»¶å±æ€§           | `{ "$url": "https://example.com" }` |
| `time`        | äº‹ä»¶æ—¶é—´æˆ³ï¼ˆå¯é€‰ï¼‰ | `1631234567890`                     |

## æ€»ç»“ä¸é€‰æ‹©

| æ–¹æ³•                | é€‚ç”¨åœºæ™¯                    | ä¼˜ç‚¹                         | ç¼ºç‚¹                    |
| :------------------ | :-------------------------- | :--------------------------- | :---------------------- |
| **Image Beacon**    | éœ€è¦æè‡´å…¼å®¹æ€§ï¼ˆå¦‚æ—§ç‰ˆ IEï¼‰ | å…¼å®¹æ€§æœ€å¥½ï¼Œæ— è·¨åŸŸé—®é¢˜       | æ— æ³•å‘é€å¤§é‡æ•°æ®        |
| **sendBeacon**      | ç°ä»£æµè§ˆå™¨ï¼Œé¡µé¢å¸è½½æ—¶ä¸ŠæŠ¥  | ä¸“ä¸ºæ—¥å¿—è®¾è®¡ï¼Œä¸é˜»å¡å¸è½½     | å…¼å®¹æ€§ç¨å·®ï¼ˆIE ä¸æ”¯æŒï¼‰ |
| **fetch keepalive** | ç°ä»£æµè§ˆå™¨ï¼Œéœ€è¦æ›´å¤šæ§åˆ¶    | åŠŸèƒ½å¼ºå¤§ï¼Œå¯æ§åˆ¶è¯·æ±‚ç»†èŠ‚     | å…¼å®¹æ€§æ¯” sendBeacon å·®  |
| **å®˜æ–¹ SDK**        | **æ‰€æœ‰ç”Ÿäº§ç¯å¢ƒ**            | **åŠŸèƒ½å®Œæ•´ï¼Œç¨³å®šå¯é ï¼Œçœå¿ƒ** | éœ€è¦å¼•å…¥ SDK            |

**æœ€ç»ˆå»ºè®®**ï¼šå¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œ**å¼ºçƒˆæ¨èç›´æ¥ä½¿ç”¨ç¥ç­–å®˜æ–¹ SDK**ã€‚å®ƒå°è£…äº†æ‰€æœ‰æœ€ä½³å®è·µï¼Œæ‚¨åªéœ€è¦å…³å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆè§¦å‘ä»€ä¹ˆäº‹ä»¶ï¼‰ï¼Œè€Œä¸éœ€è¦å…³å¿ƒç½‘ç»œä¼ è¾“çš„å®ç°ç»†èŠ‚ã€‚åªæœ‰åœ¨ä¸€äº›éå¸¸ç‰¹æ®Šçš„åœºæ™¯ä¸‹ï¼Œæ‰éœ€è¦è€ƒè™‘è‡ªå·±å®ç°åŸ‹ç‚¹è¯·æ±‚ã€‚

## å¸¸è§é—®é¢˜ï¼šç¥ç­–ä½¿ç”¨ Image Beacon æ˜¯æ€ä¹ˆè·å–ç”¨æˆ·æ•°æ®çš„ï¼Ÿ

åƒç¥ç­–è¿™ç§å‘é€ä¸€ä¸ªå›¾ç‰‡ç»™åç«¯ï¼Œä»–ä»¬æ˜¯æ€ä¹ˆé€šè¿‡å›¾ç‰‡åˆ†ææ•°æ®çš„ï¼Ÿ

**ç¥ç­–å¹¶ä¸æ˜¯çœŸçš„å»â€œåˆ†æâ€å›¾ç‰‡æœ¬èº«çš„å†…å®¹**ï¼ˆæ¯”å¦‚å›¾ç‰‡é‡Œçš„åƒç´ ã€é¢œè‰²ç­‰ï¼‰ï¼Œè€Œæ˜¯**å·§å¦™åœ°åˆ©ç”¨æµè§ˆå™¨è¯·æ±‚å›¾ç‰‡çš„è¡Œä¸ºæ¥ä¼ é€’æ•°æ®**ã€‚

å¯ä»¥è¿™æ ·ç†è§£ï¼š**å›¾ç‰‡çš„ URLï¼ˆåœ°å€ï¼‰ä¸æ˜¯æŒ‡å‘ä¸€å¼ çœŸå®çš„å›¾ç‰‡ï¼Œè€Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªç²¾å¿ƒç¼–æ’çš„ã€åŒ…å«äº†ä½ æ‰€æœ‰åŸ‹ç‚¹æ•°æ®çš„â€œä»£ç å­—ç¬¦ä¸²â€**ã€‚

æ•´ä¸ªè¿‡ç¨‹å°±åƒä¸€ä¸ªç§˜å¯†é€šä¿¡åè®®ï¼š

### æ ¸å¿ƒåŸç†ï¼šURL å³æ¶ˆæ¯

åŸ‹ç‚¹ç³»ç»Ÿä¼šåŠ¨æ€ç”Ÿæˆä¸€ä¸ª 1x1 åƒç´ çš„é€æ˜ GIF å›¾ç‰‡çš„ URLï¼Œä½†è¿™ä¸ª URL çš„è·¯å¾„å’Œå‚æ•°éƒ¨åˆ†è¢«ç”¨æ¥ç¼–ç æ•°æ®ã€‚

**ä¸¾ä¸ªä¾‹å­ï¼š** ä¸€ä¸ªçœŸå®çš„åŸ‹ç‚¹å›¾ç‰‡è¯·æ±‚ URL å¯èƒ½é•¿è¿™æ ·ï¼š

```
https://data-sensors.com/sa.gif?project=my_web&event=pageview&user_id=123&page_url=https%3A%2F%2Fexample.com&button_name=checkout&time=1631234567890
```

**åˆ†è§£è¿™ä¸ª URLï¼š**

| URL éƒ¨åˆ†                          | ä½œç”¨                     | è¯´æ˜                                                       |
| :-------------------------------- | :----------------------- | :--------------------------------------------------------- |
| `https://data-sensors.com/sa.gif` | **æ¥æ”¶ç«¯ç‚¹**             | ç¥ç­–æœåŠ¡å™¨çš„åœ°å€ï¼Œè·¯å¾„å« `sa.gif` åªæ˜¯ä¸ºäº†**ä¼ªè£…**æˆå›¾ç‰‡ã€‚ |
| `?project=my_web`                 | **æŸ¥è¯¢å‚æ•°ï¼ˆæ•°æ®è½½ä½“ï¼‰** | ä»é—®å· `?` å¼€å§‹çš„éƒ¨åˆ†æ‰æ˜¯å…³é”®ï¼è¿™äº›å‚æ•°å°±æ˜¯åŸ‹ç‚¹æ•°æ®ã€‚      |
| `&event=pageview`                 | äº‹ä»¶åç§°                 | å‘Šè¯‰æœåŠ¡å™¨ç”¨æˆ·è¿›è¡Œäº†â€œé¡µé¢æµè§ˆâ€è¿™ä¸ªè¡Œä¸ºã€‚                   |
| `&user_id=123`                    | ç”¨æˆ·æ ‡è¯†                 | å‘Šè¯‰æœåŠ¡å™¨æ˜¯å“ªä¸ªç”¨æˆ·åšçš„ã€‚                                 |
| `&page_url=...`                   | äº‹ä»¶å±æ€§                 | å‘Šè¯‰ç”¨æˆ·æ˜¯åœ¨å“ªä¸ªé¡µé¢åšçš„ã€‚                                 |
| `&time=...`                       | æ—¶é—´æˆ³                   | å‘Šè¯‰æœåŠ¡å™¨äº‹ä»¶å‘ç”Ÿçš„ç¡®åˆ‡æ—¶é—´ã€‚                             |

å½“æµè§ˆå™¨å°è¯•åŠ è½½è¿™ä¸ªâ€œå›¾ç‰‡â€æ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹äº‹æƒ…ï¼š

1.  **æµè§ˆå™¨**ï¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„å›¾ç‰‡èµ„æºï¼Œå‘ `https://data-sensors.com/sa.gif` å‘èµ·ä¸€ä¸ª **HTTP GET è¯·æ±‚**ã€‚
2.  **ç¥ç­–æœåŠ¡å™¨**ï¼š
    - æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ï¼Œ**å®Œå…¨å¿½ç•¥**è¯·æ±‚çš„æ˜¯ `.gif` è¿™ä¸ªäº‹å®ã€‚
    - æœåŠ¡å™¨ç«¯çš„ç¨‹åºï¼ˆå¦‚ Nginxã€Node.jsã€Java ç­‰ï¼‰ä¼š**è§£æ URL ä¸­çš„æŸ¥è¯¢å‚æ•°**ï¼ˆå³ `?` åé¢çš„éƒ¨åˆ†ï¼‰ã€‚
    - å°†è¿™äº›å‚æ•°ï¼ˆ`project=my_web`, `event=pageview`...ï¼‰è§£ææˆç»“æ„åŒ–çš„ JSON æ•°æ®ã€‚
    - **å°†è¿™äº›æ•°æ®å­˜å…¥æ•°æ®åº“æˆ–å¤§æ•°æ®å¹³å°**ï¼Œç”¨äºåç»­çš„åˆ†æå’Œè®¡ç®—ã€‚
    - æœ€åï¼ŒæœåŠ¡å™¨è¿”å›ä¸€ä¸ª**æå…¶å¾®å°çš„ 1x1 åƒç´ çš„é€æ˜ GIF å›¾ç‰‡**ä½œä¸ºå“åº”å†…å®¹ï¼ˆå°±æ˜¯ä½ å“åº”å¤´é‡Œ `content-type: image/gif` å¯¹åº”çš„å†…å®¹ï¼‰ã€‚
3.  **æµè§ˆå™¨**ï¼šæ¥æ”¶åˆ°è¿™ä¸ªå¾®å°çš„å›¾ç‰‡æ•°æ®ï¼Œå¹¶æ¸²æŸ“å®ƒï¼ˆå½“ç„¶ï¼Œåœ¨é¡µé¢ä¸Šä½ ä»€ä¹ˆéƒ½çœ‹ä¸åˆ°ï¼‰ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹©ç”¨å›¾ç‰‡ï¼ˆImage Beaconï¼‰ï¼Ÿ

è¿™ç§æŠ€æœ¯è¢«ç§°ä¸º **â€œImage Beaconâ€**ï¼ˆå›¾ç‰‡ä¿¡æ ‡ï¼‰ï¼Œå®ƒè¢«å¹¿æ³›é‡‡ç”¨æ˜¯å› ä¸ºæœ‰è¯¸å¤šä¼˜ç‚¹ï¼š

| ä¼˜ç‚¹             | è§£é‡Š                                                                            |
| :--------------- | :------------------------------------------------------------------------------ |
| **æ²¡æœ‰è·¨åŸŸé—®é¢˜** | å›¾ç‰‡èµ„æºä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œå¯ä»¥ä»ä»»ä½•åŸŸåä¸‹åŠ è½½ã€‚è¿™æ˜¯æœ€å¤§çš„ä¼˜åŠ¿ã€‚              |
| **å…¼å®¹æ€§æå¥½**   | æ‰€æœ‰æµè§ˆå™¨ï¼ŒåŒ…æ‹¬éå¸¸å¤è€çš„ç‰ˆæœ¬ï¼Œéƒ½æ”¯æŒå›¾ç‰‡åŠ è½½ã€‚                                |
| **ç®€å•å¯é **     | å®ç°èµ·æ¥éå¸¸ç®€å•ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ª `Image` å¯¹è±¡å¹¶è®¾ç½® `src` å±æ€§å³å¯ã€‚            |
| **ä¸é˜»å¡é¡µé¢**   | å›¾ç‰‡åŠ è½½æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡é¡µé¢çš„æ¸²æŸ“æˆ–å¸è½½è¿‡ç¨‹ã€‚                                |
| **å¼€é”€æå°**     | è¯·æ±‚çš„å›¾ç‰‡åªæœ‰ 1x1 åƒç´ ï¼Œå‡ ä¹æ˜¯æ‰€æœ‰ç½‘ç»œè¯·æ±‚ä¸­æ•°æ®é‡æœ€å°çš„ï¼Œå¯¹æ€§èƒ½å½±å“å¾®ä¹å…¶å¾®ã€‚ |

### ğŸ†š ä¸ç°ä»£æ–¹æ³•çš„å¯¹æ¯”

è™½ç„¶ Image Beacon éå¸¸ç»å…¸ï¼Œä½†ç°åœ¨ä¹Ÿæœ‰æ›´ç°ä»£çš„æŠ€æœ¯ï¼š

| æŠ€æœ¯                       | å·¥ä½œåŸç†                             | ä¼˜ç‚¹                             | ç¼ºç‚¹                               |
| :------------------------- | :----------------------------------- | :------------------------------- | :--------------------------------- |
| **Image Beacon**           | ä¼ªè£…æˆå›¾ç‰‡çš„ GET è¯·æ±‚ï¼Œæ•°æ®åœ¨ URL ä¸­ | å…¼å®¹æ€§æœ€å¥½ï¼Œæ— è·¨åŸŸé—®é¢˜           | URL é•¿åº¦æœ‰é™åˆ¶ï¼Œä¸é€‚åˆä¼ è¾“å¤§é‡æ•°æ® |
| **navigator.sendBeacon()** | HTML5 æ–° APIï¼Œä¸“é—¨ç”¨äºå‘é€å°‘é‡æ•°æ®   | å³ä½¿é¡µé¢å…³é—­ä¹Ÿä¼šä¿è¯å‘é€ï¼Œä¸é˜»å¡ | å…¼å®¹æ€§ç¨å·®ï¼ˆIE å®Œå…¨ä¸æ”¯æŒï¼‰        |
| **Fetch API**              | ä½¿ç”¨ JavaScript å‘èµ·å¼‚æ­¥è¯·æ±‚         | åŠŸèƒ½å¼ºå¤§ï¼Œå¯æ§åˆ¶æ€§å¼º             | å¯èƒ½å—è·¨åŸŸç­–ç•¥é™åˆ¶                 |

### æ€»ç»“

æ‰€ä»¥ï¼Œç¥ç­–å¹¶ä¸æ˜¯åˆ†æå›¾ç‰‡ï¼Œè€Œæ˜¯**æŒ‚ç¾Šå¤´å–ç‹—è‚‰**ï¼š

- **ç¾Šå¤´ï¼ˆè¯·æ±‚å¤´ï¼‰**ï¼š`Content-Type: image/gif` -> è®©æµè§ˆå™¨ä»¥ä¸ºè¿™æ˜¯ä¸ªå›¾ç‰‡ã€‚
- **ç‹—è‚‰ï¼ˆè¯·æ±‚ä½“å’Œç›®çš„ï¼‰**ï¼š`?event=xxx&user_id=xxx` -> åœ¨ URL å‚æ•°ä¸­æºå¸¦æ•°æ®ï¼ŒæœåŠ¡å™¨è§£æåå­˜å…¥æ•°æ®åº“ã€‚

æœ€ç»ˆï¼Œæ‚¨åœ¨æµ·é‡æ•°æ®ä¸­çœ‹åˆ°çš„**ç”¨æˆ·è¡Œä¸ºåˆ†ææŠ¥è¡¨ã€è½¬åŒ–æ¼æ–—ã€ç•™å­˜åˆ†æ**ç­‰ï¼Œå…¨éƒ½æ˜¯åŸºäº**è§£æè¿™äº› URL å‚æ•°åå­˜å…¥æ•°æ®åº“çš„æ•°æ®**è®¡ç®—å‡ºæ¥çš„ï¼Œä¸é‚£å¼ å¾®å°çš„é€æ˜å›¾ç‰‡æœ¬èº«æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚

## æ¡ˆä¾‹ä»£ç 

ä¸Šé¢çš„æ¡ˆä¾‹ä»£ç å¦‚ä¸‹ï¼š

```html
<!DOCTYPE html>
<html>
  <head>
    <title>Markdown Renderer</title>
    <style>
      button {
        display: block;
        margin: 20px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div id="result"></div>
    <button id="ImageBeacon">ImageBeaconæ·»åŠ åŸ‹ç‚¹</button>
    <button id="sendBeacon">Navigator.sendBeaconæ·»åŠ åŸ‹ç‚¹</button>
    <button id="keepalive">fetchKeepaliveæ·»åŠ åŸ‹ç‚¹</button>
    <script>
      // å°†å±æ€§å¯¹è±¡è½¬æ¢ä¸ºURLå‚æ•°å­—ç¬¦ä¸²
      function formatParams(params) {
        return Object.keys(params)
          .map((key) => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
          .join("&");
      }
      // ä½¿ç”¨ Image Beacon
      document.getElementById("ImageBeacon").addEventListener("click", () => {
        // æ„å»ºåŸ‹ç‚¹URLå’Œå‚æ•°
        const saUrl = "https://..."; // æ•°æ®æ¥æ”¶åœ°å€
        const project = "fosun_test1"; // æ‚¨çš„é¡¹ç›®å
        const event = "ButtonClick"; // äº‹ä»¶åç§°ï¼Œå¦‚ 'PageView', 'ButtonClick'
        const distinctId = "user_123"; // ç”¨æˆ·ID
        const properties = {
          // äº‹ä»¶å±æ€§
          $url: window.location.href,
          button_name: "æäº¤æŒ‰é’®"
        };
        const finalUrl = `${saUrl}?project=${project}&event=${event}&distinct_id=${distinctId}&${formatParams(properties)}`;
        // åˆ›å»ºImageå¯¹è±¡å‘é€è¯·æ±‚
        const beacon = new Image(1, 1); // åˆ›å»ºä¸€ä¸ª1x1åƒç´ çš„å›¾ç‰‡
        beacon.src = finalUrl; // è®¾ç½®srcå³å‘èµ·GETè¯·æ±‚
        // å¯é€‰çš„é”™è¯¯å¤„ç†
        beacon.onerror = function () {
          console.error("Sensors beacon request failed.");
        };
        beacon.onload = function () {
          console.log("Sensors beacon request successful.");
        };
      });

      // ä½¿ç”¨ sendBeacon å‘é€æ•°æ®
      document.getElementById("sendBeacon").addEventListener("click", () => {
        // æ„å»ºæ•°æ®å¯¹è±¡
        const data = {
          project: "fosun_test1",
          event: "ButtonClick",
          distinct_id: "user_123",
          properties: {
            $url: window.location.href,
            button_name: "æäº¤æŒ‰é’®"
          }
        };
        // æ³¨æ„ï¼šsendBeacon é€šå¸¸ä»¥ POST æ–¹å¼å‘é€å­—ç¬¦ä¸²åŒ–çš„JSON
        const blob = new Blob([JSON.stringify(data)], { type: "application/x-www-form-urlencoded" });
        const success = navigator.sendBeacon("https://...", blob);
        if (success) {
          console.log("Beacon enqueued successfully!");
        } else {
          console.error("Beacon failed to queue.");
        }
      });

      // ä½¿ç”¨ fetchKeepalive å‘é€æ•°æ®
      document.getElementById("keepalive").addEventListener("click", () => {
        const data = new URLSearchParams();
        data.append("project", "your_project_name");
        data.append("event", "ButtonClick");
        data.append("distinct_id", "user_123");
        data.append(
          "properties",
          JSON.stringify({
            $url: window.location.href,
            button_name: "æäº¤æŒ‰é’®"
          })
        );
        fetch("https://...", {
          method: "POST", // ä¹Ÿå¯èƒ½æ˜¯GETï¼Œå–å†³äºç¥ç­–æœåŠ¡å™¨çš„é…ç½®
          body: data,
          keepalive: true, // å…³é”®å‚æ•°ï¼šç¡®ä¿è¯·æ±‚åœ¨é¡µé¢å¸è½½åä»èƒ½ç»§ç»­
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          }
        }).catch((error) => {
          console.error("Fetch beacon failed:", error);
        });
      });
    </script>
  </body>
</html>
```
