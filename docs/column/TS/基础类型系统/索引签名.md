# TypeScript 中的索引签名（Index Signatures）

索引签名是 `TypeScript` 中一个强大的特性，它允许我们定义对象中可以包含哪些动态属性。当对象的属性名在编写代码时不确定，但你知道它们的值类型时，索引签名就特别有用。

## 基本语法

索引签名的基本语法如下：

```typescript
interface SomeInterface {
  [key: KeyType]: ValueType;
}
```

其中：

- `key` 可以是任意名称（常用 `key`、`index` 或 `prop`）
- `KeyType` 只能是 `string`、`number` 或 `symbol` 类型
- `ValueType` 可以是任意 TypeScript 类型

在使用`apiFox`对接接口时，经常会自动生成类型：如图

![apiFox自动生成类型](../images/key-1.png)

项目中的一些场景：

![apiFox自动生成类型](../images/key-2.png)


## 字符串索引签名

```typescript
interface StringDictionary {
  [key: string]: string;
}

const dict: StringDictionary = {
  name: "Alice",
  email: "alice@example.com"
  // 可以添加任意字符串键，只要值是string类型
};
```

## 数字索引签名

```typescript
interface NumberArray {
  [index: number]: string; // 虽然键是数字，但实际上是字符串索引
}

const arr: NumberArray = ["a", "b", "c"];
const item = arr[0]; // string
```

注意：JavaScript 会隐式将数字索引转换为字符串

## 混合索引签名

```typescript
interface HybridDictionary {
  [key: string]: number | string;
  name: string; // 必须与索引签名兼容
  age: number; // 必须与索引签名兼容
  // error: isActive: boolean;  // 错误，因为boolean不在 string | number 中
}
```

## 只读索引签名

```typescript
interface ReadonlyDictionary {
  readonly [key: string]: number;
}

const scores: ReadonlyDictionary = { math: 90, english: 85 };
// scores.math = 95;  // 错误，因为是只读的
```

## 索引签名与确定属性的结合

```typescript
interface User {
  [key: string]: string | number;
  name: string;
  age: number;
  // 可以添加其他任意属性，只要值是string或number
}

const user: User = {
  name: "Bob",
  age: 30,
  email: "bob@example.com", // 允许
  score: 95 // 允许
};
```

## 索引签名的注意事项

1. **所有显式属性必须兼容索引签名**：

   ```typescript
   interface Problematic {
     [key: string]: number;
     name: string; // 错误，string不兼容number
   }
   ```

2. **一个接口可以有多个索引签名**，但键类型必须不同（string/number/symbol）：

   ```typescript
   interface MultiIndex {
     [key: string]: string;
     [index: number]: string; // 必须与字符串索引的返回类型相同或更具体
   }
   ```

3. **索引签名会影响类型检查**：

   ```typescript
   interface StrictDict {
     [key: string]: string;
   }

   const dict: StrictDict = {
     name: "Alice",
     age: 30 // 错误，因为number不兼容string
   };
   ```

## 实际应用场景

1. **处理动态属性对象**：

   ```typescript
   function processConfig(config: { [key: string]: any }) {
     // 处理任意键值对
   }
   ```

2. **字典/映射结构**：

   ```typescript
   interface WordCount {
     [word: string]: number;
   }

   const counts: WordCount = {
     hello: 3,
     world: 5
   };
   ```

3. **模拟数组行为**：

   ```typescript
   interface StringArray {
     [index: number]: string;
     length: number;
   }
   ```

4. **类型安全的任意属性**：
   ```typescript
   interface SafeAnyProps {
     [prop: string]: unknown; // 比any更安全
   }
   ```

## 索引签名 vs Record 类型

TypeScript 的 `Record` 类型可以实现类似功能：

```typescript
type StringDictionary = Record<string, string>;
// 等价于
interface StringDictionary {
  [key: string]: string;
}
```

区别：

- `Record` 更简洁，适用于简单映射
- 索引签名可以在接口中与其他属性混合使用
