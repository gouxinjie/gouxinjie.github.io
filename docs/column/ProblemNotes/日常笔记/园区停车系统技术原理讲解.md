# 园区停车系统完整技术讲解

[[toc]]

这是一套集 **视频识别、边缘计算、车道控制、计费规则、车位管理、数据平台** 于一体的“智能停车 + IoT”系统。

## 一、一个标准的智慧园区停车系统通常包括

### ① 入口/出口设备

- 车牌识别摄像头（AI IPC）
- 道闸（栏杆机）
- 补光灯
- LED 提示屏
- 车位引导屏（可选）

### ② 场内系统

- **空余车位采集**（地磁 / 超声波 / 视频 AI）
- **车位诱导**（灯柱、屏幕）
- **内部道路监测**（可选）

### ③ 后台系统（服务端）

- 通行鉴权
- 车牌管理（白名单 / 黑名单）
- 计时计费
- 月卡/访客管理
- 通行日志
- 对账与财务

### ④ 管理端 / 移动端

- 管理员后台
- 租户管理平台
- 移动 App / 小程序（缴费、预约车位）

## 二、一个完整的通行流程是怎样的？

以下为“入口 → 停车 → 出口”的完整技术流程。

## 🟦 **步骤 1：车辆到达入口，摄像头触发识别**

入口摄像头（通常为 AI IPC）会在车辆进入识别区域时自动触发：

1. 图像采集
2. 边缘设备进行本地车牌识别（OCR + 分类）
3. 上传车牌号、车牌颜色、车头方向到服务器

常见车牌识别技术包括：

- 基于 CNN 的车牌检测
- OCR 字符识别
- 中文字符识别（京、沪、粤…）
- 双行新能源识别
- 遮挡补偿算法

> 大部分识别摄像头支持 **边缘计算**，可在本地完成识别，提高速度与可靠性。

## 🟩 **步骤 2：服务器通行鉴权**

服务器收到车牌号后，会做几项判断：

### ① 是否是园区内部车辆？

- 月卡车
- 固定车位用户
- 企业白名单
- 物业/巡逻车辆

### ② 是否为访客？

- 是否有预约？
- 是否由企业发起访客登记？

### ③ 是否禁止通行？

- 黑名单
- 欠费
- 异常车辆（识别错误、无车牌等）

## 🟥 **步骤 3：下发开闸指令**

若鉴权通过，系统会通过 TCP/UDP/串口控制器向道闸发送：

```
open_gate
timeout=5s
```

同时联动：

- LED 显示屏显示

  ```
  欢迎 ××× 车主
  ```

- 补光灯亮度控制（确保“进场照片”清晰）
- 录像标记 & 入场抓拍

> 如果识别失败，可以处理“无牌车”，提示司机扫码通行或人工审核。

## 🟨 **步骤 4：入场记录创建**

服务器会存储一个“停车开始”记录：

```
parking_record {
  recordId
  plateNumber
  enterTime
  enterSnapshot
  enterGateId
  carType
  channelId
}
```

此时还会更新：

- 当前园区剩余车位
- 当前车位占用
- 租户车辆实时统计

## 🟦 **步骤 5：车位检测与诱导（可选）**

两种常见的车位检测方案：

### ① 地磁传感器

- 每个车位一个地磁
- 低功耗
- 准确率高

### ② 视频车位 AI

- 停车场顶部装摄像头（鱼眼/球机）
- N 路车位同时识别
- 成本低，但光照影响较大

停车场入口 / 楼层可见：

```
B2 层剩余：23 个车位
```

道路两侧灯柱引导至空位。

## 🟥 **步骤 6：车辆离场流程（出口）**

### 摄像头再次识别车牌

→ 上传到服务器 → 服务器查找“未结束的停车记录”

### 服务器计算费用：

```
parkingTime = exitTime - enterTime
amount = 计费规则(parkingTime, 车辆类型, 是否白名单)
```

### 计费规则通常有：

- 按小时收费（最常见）
- 阶梯计费
- 入场免费时段
- 最低消费 / 封顶价
- 工作日与周末不同价

结算成功 → 系统下发“开闸”指令。

如果未缴费 → 触发：

- 自动抬杆附带扣费（绑定车牌支付）
- 手机/小程序支付
- 人工岗亭收费
- 无感支付（ETC/车牌自动扣费）

## 三、后台系统：整个停车系统的“大脑”

后台主要负责：

### ✔ 车辆管理

- 白名单
- 企业车位分配
- 长租车/包月车
- 特殊车辆（保洁车、救护车）

### ✔ 计时计费系统

- 0 元入场
- 15 分钟免费
- 每小时 8 元
- 24 小时封顶 30 元
- 工作日深夜免费
- 多车主共享套餐

规则完全可配置。

### ✔ 对账系统

- 查询某日收入
- 企业分账
- 发票管理
- 无感支付订单查看

### ✔ 视频与抓拍管理

每次进出都存储：

- 抓拍图片
- 车牌识别结果
- 开闸日志
- 异常记录（车牌不一致、遮挡）

## 四、异常处理机制（非常关键）

常见问题与处理方式：

### ❌ 车牌识别失败

- 再识别
- 使用“入场比对”与车型比对
- 推送 App 让用户确认车牌
- 现场扫码开闸（备用）

### ❌ 入场车牌与出场车牌不一致

通常出现在光线差导致 OCR 错误。系统使用：

- AI 相似度比对
- 入场与出场图片比对
- 人工审核介入

### ❌ 联网异常

设备本地会缓存：

- 入场记录
- 出场记录

网络恢复后自动补录。

### ❌ 无感支付失败

- 道闸延时放行
- 用户补缴
- 场内扣费不成功 → 推送通知 + 催缴机制

## 五、整体架构图（逻辑流）

```
    ┌─────────┐      ┌───────────┐
    │ 摄像头   │──OCR→│ 边缘识别端 │
    └─────┬───┘      └──────┬────┘
          ↓                  ↓
     ┌──────────┐     ┌───────────┐
     │ 道闸控制器 │←→  │ 服务器鉴权 │
     └──────────┘     └──────┬────┘
                              ↓
                   ┌─────────────────┐
                   │ 停车记录/计费系统 │
                   └────────┬────────┘
                            ↓
                   ┌─────────────────┐
                   │ 管理平台 / APP  │
                   └─────────────────┘
```
