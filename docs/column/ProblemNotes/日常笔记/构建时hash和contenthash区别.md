# ä¸€æ–‡ææ‡‚æ„å»ºå·¥å…·ä¸­çš„ `[hash]` ä¸ `[contenthash]` â€”â€” ä»¥ Webpack å’Œ Vite ä¸ºä¾‹

[[toc]]

## å‰è¨€

åœ¨ç°ä»£å‰ç«¯é¡¹ç›®ä¸­ï¼Œæ„å»ºå·¥å…·ï¼ˆå¦‚ **Webpack**ã€**Vite**ã€**Rollup**ï¼‰éƒ½ä¼šä¸ºæ‰“åŒ…è¾“å‡ºçš„æ–‡ä»¶ç”Ÿæˆå¸¦æœ‰å“ˆå¸Œå€¼çš„æ–‡ä»¶åï¼Œä¾‹å¦‚ï¼š

```bash
bundle.4a8f2d.js
style.73a0de.css
```

è¿™äº› **hash å€¼ä¸ä»…æ˜¯éšæœºå­—ç¬¦ä¸²**ï¼Œè€Œæ˜¯å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚

å®ƒä»¬çš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š

> âœ… **å®ç°æµè§ˆå™¨ç¼“å­˜çš„ç²¾å‡†æ§åˆ¶**ï¼ˆCache Bustingï¼‰ âœ… **æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Œå‡å°‘é‡å¤åŠ è½½**

ä½†å½“æˆ‘ä»¬åœ¨é…ç½®ä¸­çœ‹åˆ° `[hash]`ã€`[contenthash]`ã€`[chunkhash]` æ—¶ï¼Œå¾ˆå¤šäººä¼šè¿·æƒ‘ï¼šè¿™äº›åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Vite é‡Œä¹Ÿæœ‰ç±»ä¼¼çš„ hash å—ï¼Ÿ

åˆ«æ€¥ï¼Œè¿™ç¯‡æ–‡ç« å¸¦ä½ å½»åº•ææ‡‚ï¼

## ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ hashï¼Ÿ

å½“æµè§ˆå™¨åŠ è½½é™æ€èµ„æºï¼ˆJSã€CSSã€å›¾ç‰‡ï¼‰æ—¶ï¼Œé€šå¸¸ä¼šç¼“å­˜å®ƒä»¬ã€‚è¿™åœ¨æ€§èƒ½ä¸Šæ˜¯å¥½äº‹ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥ä¸€ä¸ªç»å…¸é—®é¢˜ï¼š

> âŒ æ–‡ä»¶æ›´æ–°äº†ï¼Œä½†æµè§ˆå™¨è¿˜åœ¨ç”¨æ—§ç¼“å­˜ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç»™æ–‡ä»¶åæ·»åŠ å“ˆå¸Œåç¼€ï¼š

```bash
main.83a6d2.js
```

å½“æ–‡ä»¶å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ„å»ºå·¥å…·ä¼šç”Ÿæˆæ–°çš„ hash å€¼ï¼š

```bash
main.93b7e4.js
```

äºæ˜¯æµè§ˆå™¨å°±ä¼šé‡æ–°è¯·æ±‚æ–°æ–‡ä»¶ï¼Œä¿è¯æ‹¿åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ **ç¼“å­˜ç ´åï¼ˆCache Bustingï¼‰æœºåˆ¶**ã€‚

## äºŒã€åœ¨ Webpack ä¸­çš„ä¸‰ç§å“ˆå¸Œç±»å‹

Webpack æä¾›äº†ä¸‰ç§å ä½ç¬¦ï¼Œå®ƒä»¬ä»£è¡¨ä¸åŒç²’åº¦çš„å“ˆå¸Œç­–ç•¥ï¼š

| å ä½ç¬¦          | å«ä¹‰              | æ›´æ–°èŒƒå›´                               |
| --------------- | ----------------- | -------------------------------------- |
| `[hash]`        | æ•´ä¸ªæ„å»ºçš„å“ˆå¸Œ    | ä»»æ„æ–‡ä»¶å˜åŠ¨éƒ½ä¼šå¼•èµ·æ‰€æœ‰æ–‡ä»¶ hash å˜åŒ– |
| `[chunkhash]`   | åŸºäº chunk çš„å“ˆå¸Œ | ä»…å½“å‰å…¥å£åŠä¾èµ–å˜åŠ¨æ—¶æ›´æ–°             |
| `[contenthash]` | åŸºäºå†…å®¹çš„å“ˆå¸Œ    | ä»…å½“æ–‡ä»¶å†…å®¹å˜åŒ–æ—¶æ›´æ–°ï¼ˆæœ€ç²¾ç»†ï¼‰       |

### 1ï¸. `[hash]`ï¼šå…¨å±€æ„å»ºçº§åˆ«

```js
output: {
  filename: "bundle.[hash].js";
}
```

ä»»æ„æ–‡ä»¶ï¼ˆJSã€CSSã€å›¾ç‰‡ï¼‰å˜åŠ¨ï¼Œéƒ½ä¼šè®©æ‰€æœ‰è¾“å‡ºæ–‡ä»¶çš„ hash å…¨éƒ¨æ›´æ–°ã€‚

**é€‚ç”¨åœºæ™¯ï¼š** å¼€å‘ç¯å¢ƒï¼ˆæ¯æ¬¡æ„å»ºéƒ½é‡æ–°åŠ è½½æ— æ‰€è°“ï¼‰ **ä¸é€‚åˆç”Ÿäº§ï¼š** ç¼“å­˜å‘½ä¸­ç‡å¤ªä½ã€‚

### 2ï¸. `[chunkhash]`ï¼šæŒ‰å…¥å£ç²’åº¦æ›´æ–°

```js
output: {
  filename: "bundle.[chunkhash].js";
}
```

å½“æŸä¸ªå…¥å£æ–‡ä»¶ï¼ˆchunkï¼‰å†…å®¹å˜åŒ–æ—¶ï¼Œåªæ›´æ–°è¯¥ chunk çš„æ–‡ä»¶ã€‚ä½†å®ƒä»å¯èƒ½å—åˆ°å…¶ä»–ä¾èµ–çš„å½±å“ï¼ˆå°¤å…¶æ˜¯å…¬å…±æ¨¡å—ï¼‰ã€‚

> ğŸ’¡ åœ¨ä½¿ç”¨ `MiniCssExtractPlugin` æŠ½ç¦» CSS æ—¶ï¼ŒCSS æ”¹åŠ¨ä¼šå½±å“ JS çš„ chunkhashï¼Œå› æ­¤åæœŸä¸å¸¸ç”¨ã€‚

### 3ï¸. `[contenthash]`ï¼šå†…å®¹çº§å“ˆå¸Œï¼ˆæ¨èï¼‰

```js
output: {
  filename: "bundle.[contenthash].js";
}
```

å®ƒæ ¹æ®æ–‡ä»¶**è‡ªèº«å†…å®¹**ç”Ÿæˆå“ˆå¸Œå€¼ã€‚åªè¦æ–‡ä»¶å†…å®¹ä¸å˜ï¼Œæ–‡ä»¶åå°±ä¿æŒç¨³å®šã€‚

è¿™ä¹Ÿæ˜¯ç°ä»£å‰ç«¯æ„å»ºä¸­æœ€å¸¸ç”¨ã€æœ€æ¨èçš„æ–¹æ¡ˆã€‚

## ä¸‰ã€åœ¨ Vite ä¸­çš„å“ˆå¸Œç­–ç•¥

Vite æ²¡æœ‰ `[hash]`ã€`[contenthash]` è¿™æ ·çš„å ä½ç¬¦è¯­æ³•ï¼Œä½†å®ƒçš„è¡Œä¸ºä¸ Webpack çš„ `[contenthash]` ç­‰ä»·ã€‚

### é»˜è®¤è§„åˆ™

Vite çš„ç”Ÿäº§æ„å»ºï¼ˆ`vite build`ï¼‰è¾“å‡ºç›®å½•é€šå¸¸æ˜¯ï¼š

```
dist/
 â”œâ”€ assets/
 â”‚   â”œâ”€ index-BkR8kM3.js
 â”‚   â”œâ”€ index-BkR8kM3.css
 â”‚   â””â”€ logo-CyT9y0D.png
```

è¿™äº› `BkR8kM3`ã€`CyT9y0D` å°±æ˜¯ **åŸºäºæ–‡ä»¶å†…å®¹è®¡ç®—çš„ hash å€¼**ã€‚å½“æ–‡ä»¶å†…å®¹æœªå˜åŒ–æ—¶ï¼Œhash ä¸ä¼šæ”¹å˜ã€‚

### è‡ªå®šä¹‰å‘½åè§„åˆ™

åœ¨ `vite.config.js` ä¸­å¯ä»¥ä½¿ç”¨å ä½ç¬¦æ§åˆ¶è¾“å‡ºæ ¼å¼ï¼š

```js
export default {
  build: {
    rollupOptions: {
      output: {
        entryFileNames: "js/[name]-[hash].js",
        chunkFileNames: "js/[name]-[hash].js",
        assetFileNames: "assets/[name]-[hash][extname]"
      }
    }
  }
};
```

è¿™é‡Œçš„ `[hash]` å®é™…ç­‰ä»·äº **Webpack çš„ `[contenthash]`**ï¼Œå®ƒåŒæ ·æ˜¯æ ¹æ®å†…å®¹å˜åŒ–ç”Ÿæˆçš„ç¨³å®šå“ˆå¸Œã€‚

> ğŸ’¡ åœ¨ Vite ä¸­å¹¶æ²¡æœ‰å…¨å±€ `[hash]` æˆ– `[chunkhash]`ï¼Œæ‰€æœ‰ `[hash]` éƒ½æ˜¯åŸºäºå†…å®¹çš„ï¼ˆå³ content-based hashï¼‰ã€‚

## å››ã€ä¸¤è€…çš„æ ¸å¿ƒåŒºåˆ«æ€»ç»“

| å¯¹æ¯”é¡¹          | Webpack       | Vite                                |
| --------------- | ------------- | ----------------------------------- |
| é»˜è®¤è¡Œä¸º        | ä¸å¸¦ hash     | è‡ªåŠ¨ç”ŸæˆåŸºäºå†…å®¹çš„ hash             |
| `[hash]`        | å…¨å±€æ„å»º hash | æ–‡ä»¶å†…å®¹ hashï¼ˆç­‰ä»·äº contenthashï¼‰ |
| `[contenthash]` | å†…å®¹çº§åˆ« hash | é»˜è®¤è¡Œä¸º                            |
| é…ç½®å¤æ‚åº¦      | é«˜            | ç®€å•ï¼ˆå‡ ä¹å¼€ç®±å³ç”¨ï¼‰                |
| ç¼“å­˜æ§åˆ¶ç²¾åº¦    | å¯é…ç½®        | é»˜è®¤ç²¾ç»†                            |

## äº”ã€ä½¿ç”¨åœºæ™¯æ¨è

| åœºæ™¯           | æ¨èåšæ³•                                                       | è¯´æ˜               |
| -------------- | -------------------------------------------------------------- | ------------------ |
| **å¼€å‘ç¯å¢ƒ**   | ä½¿ç”¨ `[hash]`ï¼ˆWebpackï¼‰æˆ–å…³é—­ hashï¼ˆVite é»˜è®¤ dev ä¸å¸¦ hashï¼‰ | æ–¹ä¾¿çƒ­æ›´æ–°         |
| **ç”Ÿäº§ç¯å¢ƒ**   | ä½¿ç”¨ `[contenthash]`ï¼ˆWebpackï¼‰æˆ–é»˜è®¤è¡Œä¸ºï¼ˆViteï¼‰              | æ–‡ä»¶å†…å®¹å˜åŒ–æ‰æ›´æ–° |
| **å›¾ç‰‡ã€å­—ä½“** | ä½¿ç”¨ `[contenthash]` æˆ– Vite é»˜è®¤ `[hash]`                     | æå‡ç¼“å­˜å‘½ä¸­ç‡     |
| **CSS æ–‡ä»¶**   | ä½¿ç”¨ `MiniCssExtractPlugin` + `[contenthash]`ï¼ˆWebpackï¼‰       | ç‹¬ç«‹ç¼“å­˜æ§åˆ¶       |

## å…­ã€å®æˆ˜ç¤ºä¾‹

### âœ… Webpack ç”Ÿäº§é…ç½®

```js
const MiniCssExtractPlugin = require("mini-css-extract-plugin");

module.exports = {
  mode: "production",
  output: {
    filename: "js/[name].[contenthash].js",
    clean: true
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: "css/[name].[contenthash].css"
    })
  ]
};
```

### âœ… Vite ç”Ÿäº§é…ç½®

```js
// vite.config.js
export default {
  build: {
    rollupOptions: {
      output: {
        entryFileNames: "js/[name]-[hash].js",
        chunkFileNames: "js/[name]-[hash].js",
        assetFileNames: "assets/[name]-[hash][extname]"
      }
    }
  }
};
```

ä¸¤è€…æœ€ç»ˆè¡Œä¸ºä¸€è‡´ï¼š ğŸ‘‰ åªè¦æ–‡ä»¶å†…å®¹ä¸å˜ï¼Œhash ä¸ä¼šå˜åŒ–ï¼Œæµè§ˆå™¨ç¼“å­˜å°±èƒ½å‘½ä¸­ã€‚

## ä¸ƒã€æœ€ä½³å®è·µæ€»ç»“

| ç›®æ ‡       | Webpack é…ç½®                                              | Vite é…ç½®                                         |
| ---------- | --------------------------------------------------------- | ------------------------------------------------- |
| å¼€å‘è°ƒè¯•   | `[hash]`                                                  | é»˜è®¤è¡Œä¸ºï¼ˆä¸å¸¦ hashï¼‰                             |
| ç”Ÿäº§æ„å»º   | `[contenthash]`                                           | é»˜è®¤ `[hash]`ï¼ˆå†…å®¹ hashï¼‰                        |
| å›¾ç‰‡ã€å­—ä½“ | `assetModuleFilename: 'assets/[name].[contenthash][ext]'` | `assetFileNames: 'assets/[name]-[hash][extname]'` |
| CSS æŠ½ç¦»   | `MiniCssExtractPlugin + [contenthash]`                    | é»˜è®¤ç”Ÿæˆ                                          |
