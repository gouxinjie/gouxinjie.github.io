# React19 è¢«æ›å‡º RCE é«˜å±æ¼æ´

::: warning æ³¨æ„

![cve](../images/cve.png)

:::

## ä¸€ã€äº‹ä»¶é€Ÿè§ˆ

2025 å¹´ 12 æœˆ 3 æ—¥ï¼ŒReact ä¸ Next.js å®˜æ–¹åŒæ­¥å‘å¸ƒå®‰å…¨å…¬å‘Šï¼š  
**React Server Componentsï¼ˆRSCï¼‰å®ç°ä¸­å­˜åœ¨æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´**ï¼Œç¼–å· **CVE-5-55182**ï¼ˆReact ä¸Šæ¸¸ï¼‰ä¸ **CVE-2025-66478**ï¼ˆNext.js ä¸‹æ¸¸ï¼‰ï¼ŒCVSS è¯„åˆ†ç›´æ¥æ‹‰æ»¡ **10.0 / 10.0**ã€‚

- **åˆ©ç”¨æ¡ä»¶**ï¼šä»»æ„å¯è®¿é—®ç›®æ ‡ HTTP ç«¯ç‚¹çš„æ”»å‡»è€…ï¼Œ**æ— éœ€ç™»å½•ã€æ— éœ€äº¤äº’**
- **å½±å“é¢**ï¼šæ‰€æœ‰å¼€å¯ RSC åŠŸèƒ½ä¸”ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ç«™ç‚¹**é»˜è®¤å³å—æ”»å‡»**
- **åæœ**ï¼šä»»æ„ä»£ç æ‰§è¡Œã€æ•°æ®æ³„éœ²ã€æœåŠ¡æ¥ç®¡ã€æ¨ªå‘æ¸—é€

## äºŒã€æŠ€æœ¯æ‹†è§£ï¼šä¸€æ¡ HTTP è¯·æ±‚å¦‚ä½•æ‹¿åˆ° Shellï¼Ÿ

### 1. æ ¹æœ¬åŸå›  â€”â€” Flight ååºåˆ—åŒ–ç¼ºå¤±æ ¡éªŒ

RSC é‡‡ç”¨è‡ªå®šä¹‰ã€ŒFlightã€åè®®åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´åºåˆ—åŒ–ç»„ä»¶æ ‘ä¸ Server Actionã€‚  
æœåŠ¡ç«¯åœ¨é‡æ„è°ƒç”¨é“¾æ—¶ï¼Œ**æœªå¯¹ `moduleId#exportName` åš `hasOwnProperty` æ ¡éªŒ**ï¼Œå¯¼è‡´æ”»å‡»è€…å¯é€šè¿‡åŸå‹é“¾æ±¡æŸ“è®¿é—®åˆ° Node.js å†…ç½®æ¨¡å—ï¼ˆ`child_process`ã€`vm` ç­‰ï¼‰ã€‚

```js
// ç®€åŒ–æ¼æ´ä»£ç 
function resolveServerReference(modId, expName) {
  const mod = requireModule(modId);
  // âŒ ç¼ºå¤± hasOwnProperty æ£€æŸ¥
  return mod[expName]; // å¯å‘½ä¸­ Object.prototype.constructor
}
```

### 2. æ”»å‡»æµç¨‹ï¼ˆPoC å·²å…¬å¼€ï¼‰

1. æ„é€ æ¶æ„ RSC è½½è·ï¼Œå°† `$ACTION_REF_123` è¡¨å•é¡¹æŒ‡å‘ `child_process#execSync`
2. å‘é€ POST `/formaction`ï¼ˆæˆ–å…¶ä»– Server Action ç«¯ç‚¹ï¼‰
3. æœåŠ¡ç«¯è§£ææ—¶æ²¿ç€åŸå‹é“¾æ‹¿åˆ° `execSync`ï¼Œæ‹¼æ¥æ”»å‡»è€…å‘½ä»¤å¹¶æ‰§è¡Œ
4. è¿”å›ç»“æœä¸­å¯ç›´æ¥å¸¦å‡ºæ§åˆ¶å°è¾“å‡ºï¼Œå®Œæˆ **RCE â†’ åå¼¹ Shell / å†™åé—¨**

> å·²æœ‰å¼€æºæ‰«æå™¨æ‰¹é‡æ¢æµ‹äº’è”ç½‘èµ„äº§ï¼Œ**æš´éœ²åœ¨å¤–ç½‘çš„ Next.js App Router ç«™ç‚¹è¢«å¤§è§„æ¨¡æ¤å…¥æŒ–çŸ¿ã€åé—¨**ã€‚

## ä¸‰ã€å—å½±å“ç‰ˆæœ¬ä¸ç”Ÿæ€

| ç»„ä»¶ / æ¡†æ¶                | å—å½±å“ç‰ˆæœ¬                                                                        | å®‰å…¨ç‰ˆæœ¬                     |
| -------------------------- | --------------------------------------------------------------------------------- | ---------------------------- |
| react-server-dom-webpack   | 19.0.0 â€‘ 19.2.0                                                                   | â‰¥ 19.0.1 / 19.1.2 / 19.2.1   |
| react-server-dom-parcel    | åŒä¸Š                                                                              | åŒä¸Š                         |
| react-server-dom-turbopack | åŒä¸Š                                                                              | åŒä¸Š                         |
| Next.js App Router         | 14.3.0-canary.77 ~ 15.0.4<br>15.1.0 ~ 15.1.8<br>15.2.0 ~ 15.2.5 â€¦ï¼ˆè¯¦è§å®˜æ–¹å…¬å‘Šï¼‰ | â‰¥ 15.0.5 / 15.1.9 / 15.2.6 â€¦ |
| è¡ç”Ÿæ¡†æ¶                   | LobeChatã€Difyã€Wakuã€Redwoodã€@vitejs/plugin-rsc â€¦                               | è¯·ç­‰å¾…ä¸Šæ¸¸æ›´æ–°               |

> ä»…ä½¿ç”¨ **Pages Router** æˆ– **çº¯å®¢æˆ·ç«¯æ¸²æŸ“** çš„åº”ç”¨**ä¸åœ¨å½±å“èŒƒå›´**ã€‚

## å››ã€ä¿®å¤ä¸ç¼“è§£

### å®˜æ–¹ä¿®å¤

`react` å®˜ç½‘è§£å†³æ–¹æ¡ˆï¼šhttps://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components

1. **ç«‹å³å‡çº§**è‡³å®‰å…¨ç‰ˆæœ¬
   ```bash
   # npm
   npm i react-server-dom-webpack@19.2.1 next@15.2.6
   # pnpm
   pnpm up react-server-dom-webpack@19.2.1 next@15.2.6
   ```
2. é‡æ–°æ„å»ºå¹¶èµ°å®Œæ•´ CI/CDï¼Œ**ç¡®è®¤ lock æ–‡ä»¶**å·²åˆ·æ–°ã€‚

### ğŸ†˜ ä¸´æ—¶ç¼“è§£ï¼ˆæ— æ³•ç«‹å³å‡çº§æ—¶ï¼‰

- **WAF / API ç½‘å…³**è§„åˆ™ï¼šæ‹¦æˆªè¯·æ±‚ä½“åŒ…å« `$ACTION_REF`ã€`__proto__`ã€`constructor` ç­‰å…³é”®å­—
- **åå‘ä»£ç†å±‚**å…³é—­å¯¹ `/_next/*` æˆ– `/formaction` çš„å…¬ç½‘è®¿é—®
- **å®¹å™¨æ²™ç®±**ï¼šç»™ Node è¿›ç¨‹åŠ  `seccomp` / `AppArmor`ï¼Œç¦æ­¢ `exec` æ—ç³»ç»Ÿè°ƒç”¨
- **è¿è¡Œæ—¶é’©å­**ï¼šåœ¨ `require()` å±‚é¢å¯¹ `child_process`ã€`vm` ç­‰æ¨¡å—åšç™½åå•æ‹¦æˆª

## äº”ã€è‡ªæŸ¥è„šæœ¬

```bash
# 1. æ£€æŸ¥æ˜¯å¦å¼•ç”¨å—å½±å“åŒ…
npm ls react-server-dom-webpack react-server-dom-parcel react-server-dom-turbopack
# 2. æ£€æŸ¥ Next.js ç‰ˆæœ¬
npm list next
# 3. ç¡®è®¤æ˜¯å¦å­˜åœ¨ Server Action ç«¯ç‚¹ï¼ˆæœç´¢æ–‡ä»¶ï¼‰
grep -r "use server" .
```

è‹¥ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´ä¸”å­˜åœ¨ Server Actionï¼Œ**å³ä¸ºé«˜å±**ï¼Œè¯·ç«‹å³æ‰§è¡Œå‡çº§ã€‚

## å‚è€ƒä¸å»¶ä¼¸é˜…è¯»

çŸ¥ä¹: https://zhuanlan.zhihu.com/p/1980296882984067851  
é˜¿é‡Œäº‘: https://www.aliyun.com/notice/117771  
segmentfault çŸ¥å¦: https://segmentfault.com/a/1190000047451749  
CSDN åšå®¢: https://blog.csdn.net/lightningyang/article/details/155613936  
åšå®¢å›­: https://www.cnblogs.com/yupi/p/19320774  
CN-SEC ä¸­æ–‡ç½‘: https://cn-sec.com/archives/4757079.html
