# 关系型和非关系型数据库

[[toc]]

## 一、关系型数据库的基本概念

::: tip 关系型数据库的基本概念

在关系型数据库中，数据被存储在表（`Table`）中，这些表通过行（`Row`）和列（`Column`）组织。每一行表示一条记录，而每一列表示一个属性（字段）。这些表之间可以通过关联（`Relationship`）建立联系，从而确保数据的完整性、准确性以及易于管理。

:::

1. **表（Table）** 表是关系型数据库中的基本存储单元，它由多个行和列组成。每个表有一个唯一的名称，并且包含一组特定的字段。表中的每一行表示一个记录，每一列表示记录的一个属性。例如，一个学生信息表可能包含“学号”、“姓名”、“年龄”等列。

2. **行（Row）** 每一行代表一个数据实体（记录）。例如，在“学生”表中，一行可能表示某个学生的信息。

3. **列（Column）** 列是表中的字段，定义了记录的某一属性。例如，“姓名”、“学号”就是“学生”表的列。每列的数据类型（如整数、字符串、日期等）通常都是一致的。

4. **主键（Primary Key）** 主键是表中每行记录的**唯一标识符**。每个表只能有一个主键，主键字段的值必须唯一且不能为空。例如，“学号”可以作为学生信息表的主键，因为每个学生都有唯一的学号。

5. **外键（Foreign Key）** 外键是一个表中的字段，它引用另一个表中的主键，建立表与表之间的关系。通过外键，可以实现数据的关联。例如，“成绩”表可能包含一个“学生 ID”外键，它引用“学生”表中的主键“学号”。

6. **关系（Relationship）** 关系型数据库的核心就是“关系”，即不同表之间通过外键和主键相连接，形成数据之间的逻辑联系。通过这种关联，可以确保数据的一致性和完整性。

### 1.1 关系型数据库的特点

1. **数据存储方式：** 数据以表格的形式组织，每个表都有一组行和列。

2. **结构化查询：** 使用结构化查询语言（SQL，Structured Query Language）对数据库进行查询、插入、更新、删除等操作。SQL 提供了丰富的功能，可以执行复杂的查询操作。

3. **数据一致性：** 关系型数据库遵循 ACID（原子性、一致性、隔离性、持久性）原则，确保数据库中的数据在各种情况下都能保持一致和可靠。

4. **关系模型：** 数据表之间的关系是通过主键和外键建立的，可以在多个表之间进行联接（JOIN），从而获取更复杂的数据。

5. **数据完整性：** 通过主键和外键约束，关系型数据库确保数据的一致性和完整性。例如，外键约束保证了在一个表中的值必须对应另一个表中的值，从而避免出现孤立的记录。

6. **规范化（Normalization）：** 关系型数据库通常进行数据规范化，旨在减少数据冗余和依赖性。通过规范化，可以将数据分解成多个表，确保数据的结构更加简洁和高效。

### 1.2 关系型数据库的常见管理系统（DBMS）

1. **MySQL** 一个开源的关系型数据库管理系统，非常流行，尤其是在 Web 开发中。支持 SQL 标准，提供了高性能、可靠性和易于使用的特点。

2. **PostgreSQL** 也是一个开源的关系型数据库，支持更高级的 SQL 功能和更复杂的数据类型。它比 MySQL 具有更强的事务处理和数据完整性保障。

3. **Oracle Database** 是由 Oracle 公司开发的商用关系型数据库系统。它功能强大，常用于大型企业的数据库管理，提供了高度可扩展性和复杂的安全特性。

4. **Microsoft SQL Server** 由微软开发的关系型数据库管理系统，广泛应用于企业级应用中，尤其是在与微软其他技术（如.NET）配合使用时，具有非常高的兼容性。

### 1.3 关系型数据库的优缺点

**优点：**

1. **数据一致性与完整性：** 通过 ACID 特性，关系型数据库保证了数据的高一致性和高完整性，确保了事务的可靠执行。

2. **结构清晰：** 数据通过表格清晰地组织和管理，便于理解和维护。

3. **强大的查询能力：** 使用 SQL 进行数据查询，支持复杂的查询、聚合、联接等操作。

4. **成熟的技术与工具：** 关系型数据库技术已经非常成熟，拥有大量的社区支持和商业工具，开发和维护相对容易。

**缺点：**

1. **扩展性问题：** 关系型数据库通常在处理大规模分布式数据时面临性能瓶颈，尤其是在横向扩展（增加更多服务器）时，往往比非关系型数据库更具挑战。

2. **灵活性较差：** 关系型数据库的数据结构相对固定，变更数据结构（如表的列）可能会对应用程序产生较大影响。

3. **复杂的联接操作：** 当数据表之间存在大量关联时，复杂的联接查询可能会影响性能，尤其是在处理大量数据时。

## 二、什么是非关系型数据库（NoSQL）？

它并不使用结构化的表格（行和列）来存储数据，而是使用更加灵活和多样的数据模型，如键值对（Key-Value）、文档（Document）、列族（Column Family）和图（Graph）等。NoSQL 数据库被设计为支持大规模数据存储、分布式架构、高性能和高扩展性，尤其适用于海量数据、高并发请求和快速变化的数据结构。

### 2.1 非关系型数据库的特点

1. **灵活的数据模型** 非关系型数据库通常不需要预定义数据表的结构，它允许动态的添加字段。与关系型数据库的固定结构不同，NoSQL 数据库支持各种类型的数据模型，比如键值对、文档、列族和图形模型。

2. **高可扩展性** NoSQL 数据库通常是分布式的，可以横向扩展（通过增加更多的服务器来增加容量），这使得它们能处理大规模的数据量和高并发请求。

3. **最终一致性** 相较于关系型数据库中严格的 ACID 事务（原子性、一致性、隔离性、持久性），大部分 NoSQL 数据库采用的是 **最终一致性** 模型。这意味着，在某些情况下，数据可能会在不同节点之间短时间内不一致，但最终会达到一致状态。

4. **无模式结构** 非关系型数据库不要求事先定义数据表结构，可以灵活存储不同类型的数据。例如，可以在同一集合中存储具有不同字段的数据，这对快速发展的应用和迭代周期较短的场景非常有用。

5. **高性能** 由于 NoSQL 数据库大多针对特定的应用场景进行优化（例如高速读写、低延迟查询），它们在一些场景下的性能表现远超传统的关系型数据库。

### 2.2 非关系型数据库的类型

非关系型数据库根据其数据模型的不同，通常可以分为以下几种类型：

1. **键值数据库（Key-Value Store）** 键值数据库是一种最简单的 NoSQL 数据库，它将数据存储为键值对（Key-Value）。每个数据项都有一个唯一的键（Key）和对应的值（Value）。这种结构非常适合存储快速查找的简单数据，如缓存、会话数据等。

   - 例子：**Redis**、**Riak**

2. **文档数据库（Document Store）** 文档数据库将数据存储为文档，通常使用 JSON、BSON 或 XML 格式来表示。每个文档可以存储不同的数据字段，而无需事先定义模式，且文档之间可以有不同的结构。文档数据库非常适合存储半结构化数据，如用户配置文件、日志数据等。

   - 例子：**MongoDB**、**CouchDB**

3. **列族数据库（Column-Family Store）** 列族数据库将数据按列而不是行进行存储，适用于处理大规模的、需要按列查询的数据。它支持高效的读取操作和水平扩展，常用于处理数据仓库和大数据存储的应用。

   - 例子：**Cassandra**、**HBase**

4. **图数据库（Graph Database）** 图数据库用于存储和处理图形结构的数据，如社交网络、推荐系统等。数据以节点（Node）和边（Edge）的形式存储，节点表示实体，边表示实体之间的关系。图数据库可以高效地处理复杂的关系数据。

   - 例子：**Neo4j**、**Amazon Neptune**

### 2.3 非关系型数据库的优缺点

**优点：**

1. **高扩展性** NoSQL 数据库设计时便考虑到大规模数据存储和高并发请求，因此它们通常能够水平扩展。随着数据量增加，可以通过增加更多服务器来分担负载，而不必升级单台机器的硬件。

2. **灵活性** 不需要固定的模式定义，数据可以灵活地存储和修改。这对开发快速迭代的应用程序非常有利，因为你不需要每次都改变数据库模式。

3. **高性能** 在许多应用场景下，NoSQL 数据库通过减少复杂的联接操作、优化写入和读取性能，提供了非常高的响应速度，适合处理大量并发请求。

4. **适应大数据应用** NoSQL 数据库特别适合大数据处理和实时数据分析。它们能够处理 PB 级别的数据，支持分布式存储和并行计算，非常适用于大数据分析、物联网（IoT）、日志收集等场景。

**缺点：**

1. **数据一致性问题** 大多数 NoSQL 数据库采用最终一致性模型，这可能导致在某些情况下数据不一致。虽然这种模型在很多场景下可以满足需求，但对于需要强一致性的应用来说，可能会产生问题。

2. **缺乏标准化** 每种 NoSQL 数据库都有不同的数据模型和查询语言，缺乏统一的标准。这意味着开发人员需要学习多种不同的 NoSQL 数据库技术，并且每个数据库的功能和性能也有所不同。

3. **事务支持较弱** 与关系型数据库相比，许多 NoSQL 数据库不支持复杂的事务操作，或者即使支持也没有 ACID 特性。因此，对于需要复杂事务处理的应用，NoSQL 可能不是最佳选择。

4. **适用场景限制** 非关系型数据库更适合存储非结构化或半结构化数据，对于严格结构化的表格数据，关系型数据库仍然是更好的选择。

### 2.4 非关系型数据库的应用场景

1. **社交网络** 社交网络应用需要存储大量的用户数据、关系图谱以及动态内容。图数据库（如 Neo4j）可以高效地管理和查询复杂的社交关系。

2. **实时推荐系统** 如 Netflix、Amazon 和 YouTube 的推荐系统，通常使用非关系型数据库来存储用户行为数据和推荐结果，以便快速进行数据读取和实时更新。

3. **物联网（IoT）** 物联网设备生成的传感器数据通常是高频次且结构不固定的，适合使用 NoSQL 数据库进行存储和处理。

4. **日志分析** 大型网站和应用生成的日志数据可以通过 NoSQL 数据库高效存储，并进行快速查询和分析，实时发现问题。

## 三、怎么理解主键和外键

### 3.1 主键（Primary Key）

**主键**是用来唯一标识表中每一行记录的字段。每个表只能有一个主键，主键值必须是唯一的且不能为 `NULL`。它确保表中的每一条记录都有唯一标识。

**例子**：在学生表中，`Student_ID` 可以作为主键，因为每个学生的学号都是唯一的。

### 3.2 外键（Foreign Key）

**外键**是一个表中的字段，它指向另一个表的主键，用来建立两个表之间的联系。外键确保数据的完整性和一致性，外键列的值必须在目标表的主键列中存在。

**例子**：在成绩表中，`Student_ID` 可以作为外键，指向学生表中的 `Student_ID`，表示成绩记录属于哪个学生。

### 3.3 例子：

假设我们有两个表：

1. **学生表**（`students`）：

| 学号（Student_ID） | 姓名（Name） | 年龄（Age） |
| ------------------ | ------------ | ----------- |
| 1001               | 张三         | 20          |
| 1002               | 李四         | 22          |
| 1003               | 王五         | 21          |

2. **成绩表**（`grades`）：

| 学号（Student_ID） | 课程（Course） | 成绩（Grade） |
| ------------------ | -------------- | ------------- |
| 1001               | 数学           | 90            |
| 1002               | 英语           | 85            |
| 1001               | 物理           | 88            |

在这个例子中，`grades` 表中的 `Student_ID` 是外键，它引用了 `students` 表中的 `Student_ID` 主键。这样，我们就能知道每一条成绩记录对应的是哪个学生。外键确保了成绩表中每个学生的学号必须存在于学生表中，从而保证数据的关联性和完整性。

## 四、实体，属性，关系简述

在数据库建模中，实体（Entity）属性（Attribute）和关系（Relationship）是三个基本概念，它们用来描述现实世界中的数据和数据之间的关系。

### 4.1 实体（Entity）

**实体**表示现实世界中的一个对象或事物，它可以是具体的也可以是抽象的，通常指的是我们需要存储数据的对象。

- **例子**：学生、课程、员工、订单等。
- 实体通常被表示为表格中的一行。

### 4.2 属性（Attribute）

**属性**是描述实体特征的字段或数据项。每个实体通常有多个属性，用于详细描述该实体的特征。

- **例子**：对于一个“学生”实体，属性可以是 `Student_ID`（学号）、`Name`（姓名）、`Age`（年龄）等。

### 4.3 关系（Relationship）

**关系**表示不同实体之间的联系或互动。在数据库中，关系通常表示表与表之间的关联。

- **例子**：学生与课程之间的关系，可以是“选修”关系，表示哪个学生选了哪些课程。
- 关系在数据库中通过外键来实现。

::: tip 总结：

- **实体**：表示现实世界中的事物（例如：学生、课程）。
- **属性**：描述实体的特征（例如：学生的姓名、年龄）。
- **关系**：描述不同实体之间的联系（例如：学生选修课程）。

:::
