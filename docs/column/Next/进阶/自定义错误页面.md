# Next.js ä¸­è‡ªå®šä¹‰é”™è¯¯é¡µé¢

[[toc]]

::: tip

åœ¨ **Next.js 15 App Router** ä¸‹ï¼Œè‡ªå®šä¹‰é”™è¯¯é¡µé¢æœ‰ä¸¤ç§ä¸»è¦æƒ…å†µéœ€è¦å¤„ç†ï¼š**è·¯ç”±æ‰¾ä¸åˆ°ï¼ˆ404ï¼‰** å’Œ **é¡µé¢æ¸²æŸ“æŠ¥é”™ï¼ˆErrorï¼‰**ã€‚

:::

## 1. è‡ªå®šä¹‰ 404 é¡µé¢ï¼ˆè·¯ç”±ä¸å­˜åœ¨ï¼‰

### App Router

åœ¨` App Router` ä¸‹ï¼Œä½ å¯ä»¥åœ¨ `app` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„ **`not-found.js`** æ–‡ä»¶ï¼Œç”¨äºå¤„ç†è·¯ç”±ä¸å­˜åœ¨çš„æƒ…å†µã€‚

```bash
app/
  not-found.js
```

ç¤ºä¾‹ï¼š

```jsx
// app/not-found.js
"use client"; // å¦‚æœéœ€è¦äº¤äº’åŠŸèƒ½

import Link from "next/link";

export default function NotFound() {
  return (
    <div style={{ textAlign: "center", padding: "50px" }}>
      <h1>404 - é¡µé¢ä¸å­˜åœ¨</h1>
      <p>æŠ±æ­‰ï¼Œä½ è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨ã€‚</p>
      <Link href="/">è¿”å›é¦–é¡µ</Link>
    </div>
  );
}
```

**æ³¨æ„äº‹é¡¹**ï¼š

- æ–‡ä»¶åå¿…é¡»æ˜¯ `not-found.js`
- å¯ä»¥ä½¿ç”¨ `"use client"` å£°æ˜ä¸ºå®¢æˆ·ç«¯ç»„ä»¶ï¼Œä»¥å®ç°äº¤äº’åŠŸèƒ½
- æ‰€æœ‰æœªåŒ¹é…åˆ°çš„è·¯ç”±éƒ½ä¼šæ¸²æŸ“è¿™ä¸ªç»„ä»¶

è®¿é—®äº†ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯ç”±ï¼ŒNext.js ä¼šè‡ªåŠ¨æ¸²æŸ“ `not-found.js` é¡µé¢ã€‚

**å¦‚å›¾æ‰€ç¤ºï¼š**

![404 é¡µé¢ç¤ºä¾‹](../images/error-1.png)

## 2. è‡ªå®šä¹‰å…¨å±€é”™è¯¯é¡µé¢ï¼ˆé¡µé¢æŠ¥é”™ï¼‰

å½“é¡µé¢æ¸²æŸ“è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼ˆJS é”™è¯¯ã€fetch æŠ¥é”™ç­‰ï¼‰ï¼Œå¯ä»¥é€šè¿‡ `error.js` å®ç° **å±€éƒ¨æˆ–å…¨å±€é”™è¯¯è¾¹ç•Œ**ã€‚

### 2.1 å…¨å±€é”™è¯¯è¾¹ç•Œ

åœ¨ `app` æ ¹ç›®å½•ä¸‹åˆ›å»º `error.js`ï¼š

```bash
app/
  error.js
```

ç¤ºä¾‹ï¼š

```jsx
// app/error.js
"use client"; // é”™è¯¯é¡µé¢é€šå¸¸æ˜¯å®¢æˆ·ç«¯ç»„ä»¶

import { useEffect } from "react";

export default function GlobalError({ error, reset }) {
  useEffect(() => {
    console.error(error);
  }, [error]);

  return (
    <div style={{ textAlign: "center", padding: "50px" }}>
      <h1>é¡µé¢å‡ºé”™äº† ğŸ˜¢</h1>
      <p>{error.message}</p>
      <button onClick={() => reset()}>é‡è¯•</button>
    </div>
  );
}
```

**è¯´æ˜**ï¼š

- `error`ï¼šæ•è·åˆ°çš„é”™è¯¯å¯¹è±¡
- `reset`ï¼šè§¦å‘é‡æ–°æ¸²æŸ“æˆ–é‡æ–°è¯·æ±‚æ•°æ®çš„æ–¹æ³•
- æ”¯æŒå®¢æˆ·ç«¯äº¤äº’ï¼ˆæŒ‰é’®ã€è¡¨å•ç­‰ï¼‰
- å…¨å±€ `error.js` æ•è·æ•´ä¸ª App Router ä¸‹çš„æ¸²æŸ“é”™è¯¯

**å¦‚å›¾æ‰€ç¤ºï¼š**

![å…¨å±€é”™è¯¯é¡µé¢ç¤ºä¾‹](../images/error-2.png)

### 2.2 å±€éƒ¨é”™è¯¯è¾¹ç•Œ

å¦‚æœåªæƒ³æ•è·æŸä¸ª layout æˆ– page çš„é”™è¯¯ï¼š

```bash
app/
  dashboard/
    layout.js
    error.js
```

```jsx
// app/dashboard/error.js
"use client";

export default function DashboardError({ error, reset }) {
  return (
    <div>
      <h2>Dashboard åŠ è½½å¤±è´¥</h2>
      <p>{error.message}</p>
      <button onClick={() => reset()}>é‡è¯•</button>
    </div>
  );
}
```

> å±€éƒ¨ error.js åªä¼šæ•è· **å¯¹åº” layout ä¸‹çš„å­é¡µé¢é”™è¯¯**ï¼Œä¸å½±å“å…¶ä»–é¡µé¢ã€‚

ä»¥åœ¨ä¸åŒ layout ä¸‹ç»„åˆä½¿ç”¨ï¼Œå®ç°å…¨å±€æˆ–å±€éƒ¨çš„ç”¨æˆ·å‹å¥½é”™è¯¯æç¤ºã€‚

## 3. æ€»ç»“

| æ–‡ä»¶å         | åŠŸèƒ½                      | ä½ç½®          | ä½œç”¨èŒƒå›´               |
| -------------- | ------------------------- | ------------- | ---------------------- |
| `not-found.js` | è·¯ç”±ä¸å­˜åœ¨ï¼ˆ404ï¼‰         | app/ æˆ–å­ç›®å½• | å¯¹åº”ç›®å½•ä¸‹æœªåŒ¹é…è·¯ç”±   |
| `error.js`     | é¡µé¢æŠ¥é”™ï¼ˆ500 / JS é”™è¯¯ï¼‰ | app/ æˆ–å­ç›®å½• | å¯¹åº”ç›®å½•ä¸‹é¡µé¢æ¸²æŸ“å¼‚å¸¸ |

> Tipï¼šæç¤º
>
> - å»ºè®®å…¨å±€ layout ä¸‹éƒ½æœ‰ `error.js` + `not-found.js`ï¼Œä¿è¯æ•´ä¸ªç½‘ç«™ç”¨æˆ·ä½“éªŒç»Ÿä¸€
> - å±€éƒ¨ error.js ç”¨äºå¤æ‚æ¨¡å—æˆ–å­ç³»ç»Ÿï¼Œå•ç‹¬æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯æˆ–æä¾›é‡è¯•é€»è¾‘
